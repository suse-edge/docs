# Japanese translations for PACKAGE package
# PACKAGE パッケージに対する英訳
# Copyright (C) 2024 Free Software Foundation, Inc.
# This file is distributed under the same license as the PACKAGE package.
# Automatically generated, 2024.
#
msgid ""
msgstr ""
"Project-Id-Version: PACKAGE VERSION\n"
"POT-Creation-Date: 2024-07-23 11:17+0100\n"
"PO-Revision-Date: 2024-07-23 11:17+0100\n"
"Last-Translator: Automatically generated\n"
"Language-Team: none\n"
"Language: ja\n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"
"Plural-Forms: nplurals=1; plural=0;\n"

#. type: Title ==
#: asciidoc/product/atip-architecture.adoc:1
#, no-wrap
msgid "Concept & Architecture"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-architecture.adoc:2
msgid ""
"SUSE ATIP is a platform designed for hosting modern, cloud native, Telco "
"applications at scale from core to edge."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-architecture.adoc:3
msgid ""
"This page explains the architecture and components used in ATIP. Knowledge "
"of this helps deploy and use ATIP."
msgstr ""

#. type: Title ===
#: asciidoc/product/atip-architecture.adoc:4
#, no-wrap
msgid "ATIP Architecture"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-architecture.adoc:5
msgid "The following diagram shows the high-level architecture of ATIP:"
msgstr ""

#. type: Target for macro image
#: asciidoc/product/atip-architecture.adoc:6
#, no-wrap
msgid "product-atip-architecture1.png"
msgstr ""

#. type: Title ===
#: asciidoc/product/atip-architecture.adoc:7
#, no-wrap
msgid "Components"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-architecture.adoc:8
msgid ""
"There are two different blocks, the management stack and the runtime stack:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-architecture.adoc:9
msgid ""
"*Management stack*: This is the part of ATIP that is used to manage the "
"provision and lifecycle of the runtime stacks. It includes the following "
"components:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-architecture.adoc:10
msgid ""
"Multi-cluster management in public and private cloud environments with "
"<<components-rancher,Rancher>>"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-architecture.adoc:11
msgid ""
"Bare-metal support with <<components-metal3,Metal^3^>>, <<components-metallb,"
"MetalLB>> and `CAPI` (Cluster API) infrastructure providers"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-architecture.adoc:12
msgid ""
"Comprehensive tenant isolation and `IDP` (Identity Provider) integrations"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-architecture.adoc:13
msgid "Large marketplace of third-party integrations and extensions"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-architecture.adoc:14
msgid "Vendor-neutral API and rich ecosystem of providers"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-architecture.adoc:15
msgid "Control the SLE Micro transactional updates"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-architecture.adoc:16
msgid ""
"GitOps Engine for managing the lifecycle of the clusters using Git "
"repositories with <<components-fleet,Fleet>>"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-architecture.adoc:17
msgid ""
"*Runtime stack*: This is the part of ATIP that is used to run the workloads."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-architecture.adoc:18
msgid ""
"Kubernetes with secure and lightweight distributions like <<components-k3s,"
"K3s>> and <<components-rke2,RKE2>> (`RKE2` is hardened, certified and "
"optimized for government use and regulated industries)."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-architecture.adoc:19
msgid ""
"<<components-neuvector,NeuVector>> to enable security features like image "
"vulnerability scanning, deep packet inspection and automatic intra-cluster "
"traffic control."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-architecture.adoc:20
msgid ""
"Block Storage with <<components-longhorn,Longhorn>> to enable a simple and "
"easy way to use a cloud native storage solution."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-architecture.adoc:21
msgid ""
"Optimized Operating System with <<components-slmicro,SLE Micro>> to enable a "
"secure, lightweight and immutable (transactional file system) OS for running "
"containers. SLE Micro is available on `aarch64` and `x86_64` architectures, "
"and it also supports `Real-Time Kernel` for Telco and edge use cases."
msgstr ""

#. type: Title ===
#: asciidoc/product/atip-architecture.adoc:22
#, no-wrap
msgid "Example deployment flows"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-architecture.adoc:23
msgid ""
"The following are high-level examples of workflows to understand the "
"relationship between the management and the runtime components."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-architecture.adoc:24
msgid ""
"Direct network provisioning is the workflow that enables the deployment of a "
"new downstream cluster with all the components preconfigured and ready to "
"run workloads with no manual intervention."
msgstr ""

#. type: Title ====
#: asciidoc/product/atip-architecture.adoc:25
#, no-wrap
msgid "Example 1: Deploying a new management cluster with all components installed"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-architecture.adoc:26
msgid ""
"Using the <<components-eib,Edge Image Builder>> to create a new `ISO` image "
"with the management stack included. You can then use this `ISO` image to "
"install a new management cluster on VMs or bare metal."
msgstr ""

#. type: Target for macro image
#: asciidoc/product/atip-architecture.adoc:27
#, no-wrap
msgid "product-atip-architecture2.png"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-architecture.adoc:28
msgid ""
"For more information about how to deploy a new management cluster, see the "
"<<atip-management-cluster,ATIP Management Cluster guide>>."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-architecture.adoc:29
msgid ""
"For more information about how to use the Edge Image Builder, see the "
"<<quickstart-eib,Edge Image Builder guide>>."
msgstr ""

#. type: Title ====
#: asciidoc/product/atip-architecture.adoc:30
#, no-wrap
msgid "Example 2: Deploying a single-node downstream cluster with Telco profiles to enable it to run Telco workloads"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-architecture.adoc:31
msgid ""
"Once we have the management cluster up and running, we can use it to deploy "
"a single-node downstream cluster with all Telco capabilities enabled and "
"configured using the directed network provisioning workflow."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-architecture.adoc:32
#: asciidoc/product/atip-architecture.adoc:38
msgid "The following diagram shows the high-level workflow to deploy it:"
msgstr ""

#. type: Target for macro image
#: asciidoc/product/atip-architecture.adoc:33
#, no-wrap
msgid "product-atip-architecture3.png"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-architecture.adoc:34
#: asciidoc/product/atip-architecture.adoc:40
msgid ""
"For more information about how to deploy a downstream cluster, see the "
"<<atip-automated-provisioning,ATIP Automated Provisioning guide.>>"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-architecture.adoc:35
msgid ""
"For more information about Telco features, see the <<atip-features,ATIP "
"Telco Features guide.>>"
msgstr ""

#. type: Title ====
#: asciidoc/product/atip-architecture.adoc:36
#, no-wrap
msgid "Example 3: Deploying a high availability downstream cluster using MetalLB as a Load Balancer"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-architecture.adoc:37
msgid ""
"Once we have the management cluster up and running, we can use it to deploy "
"a high availability downstream cluster with `MetalLB` as a load balancer "
"using the directed network provisioning workflow."
msgstr ""

#. type: Target for macro image
#: asciidoc/product/atip-architecture.adoc:39
#, no-wrap
msgid "product-atip-architecture4.png"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-architecture.adoc:41
msgid "For more information about `MetalLB`, see <<components-metallb,here:>>"
msgstr ""

#. type: Title ==
#: asciidoc/product/atip-automated-provision.adoc:1
#, no-wrap
msgid "Fully automated directed network provisioning"
msgstr ""

#. type: Title ===
#: asciidoc/product/atip-automated-provision.adoc:2
#: asciidoc/product/atip-management-cluster.adoc:2
#, no-wrap
msgid "Introduction"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:3
msgid ""
"Direct network provisioning is a feature that allows you to automate the "
"provisioning of downstream clusters. This feature is useful when you have "
"many downstream clusters to provision, and you want to automate the process."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:4
msgid ""
"A <<atip-management-cluster,management cluster>> automates deployment of the "
"following components:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:5
msgid ""
"`SUSE Linux Enterprise Micro RT` as the OS. Depending on the use case, "
"configurations like networking, storage, users and kernel arguments can be "
"customized."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:6
msgid ""
"`RKE2` as the Kubernetes cluster. The default `CNI` plug-in is `Cilium`. "
"Depending on the use case, certain `CNI` plug-ins can be used, such as "
"`Cilium+Multus`."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:7
msgid "`Longhorn` as the storage solution."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:8
msgid "`NeuVector` as the security solution."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:9
msgid ""
"`MetalLB` can be used as the load balancer for highly available multi-node "
"clusters."
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-automated-provision.adoc:10
msgid ""
"For more information about `SUSE Linux Enterprise Micro`, see <<components-"
"slmicro>> For more information about `RKE2`, see <<components-rke2>> For "
"more information about `Longhorn`, see <<components-longhorn>> For more "
"information about `NeuVector`, see <<components-neuvector>>"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:11
msgid ""
"The following sections describe the different directed network provisioning "
"workflows and some additional features that can be added to the provisioning "
"process:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:12
msgid "xref:eib-edge-image-connected[]"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:13
msgid "xref:eib-edge-image-airgap[]"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:14
msgid "xref:single-node[]"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:15
msgid "xref:multi-node[]"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:16
msgid "xref:advanced-network-configuration[]"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:17
msgid "xref:add-telco[]"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:18
msgid "xref:atip-private-registry[]"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:19
msgid "xref:airgap-deployment[]"
msgstr ""

#. type: Title ===
#: asciidoc/product/atip-automated-provision.adoc:20
#, no-wrap
msgid "Prepare downstream cluster image for connected scenarios"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:21
#: asciidoc/product/atip-automated-provision.adoc:69
msgid ""
"<<components-eib, Edge Image Builder>> is used to prepare a modified "
"SLEMicro base image which is provisioned on downstream cluster hosts."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:22
msgid ""
"Much of the configuration via Edge Image Builder is possible, but in this "
"guide, we cover the minimal configurations necessary to set up the "
"downstream cluster."
msgstr ""

#. type: Title ====
#: asciidoc/product/atip-automated-provision.adoc:23
#, no-wrap
msgid "Prerequisites for connected scenarios"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:24
#: asciidoc/product/atip-automated-provision.adoc:72
msgid ""
"A container runtime such as https://podman.io[Podman] or https://"
"rancherdesktop.io[Rancher Desktop] is required to run Edge Image Builder."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:25
#: asciidoc/product/atip-automated-provision.adoc:73
msgid ""
"The base image `SLE-Micro.x86_64-5.5.0-Default-RT-GM.raw` must be downloaded "
"from the https://scc.suse.com/[SUSE Customer Center] or the https://www.suse."
"com/download/sle-micro/[SUSE Download page]."
msgstr ""

#. type: Title ====
#: asciidoc/product/atip-automated-provision.adoc:26
#, no-wrap
msgid "Image configuration for connected scenarios"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:27
#: asciidoc/product/atip-automated-provision.adoc:76
msgid ""
"When running Edge Image Builder, a directory is mounted from the host, so it "
"is necessary to create a directory structure to store the configuration "
"files used to define the target image."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:28
msgid ""
"`downstream-cluster-config.yaml` is the image definition file, see "
"<<quickstart-eib>> for more details."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:29
#: asciidoc/product/atip-automated-provision.adoc:78
msgid ""
"The base image when downloaded is `xz` compressed, which must be "
"uncompressed with `unxz` and copied/moved under the `base-images` folder."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:30
#: asciidoc/product/atip-automated-provision.adoc:79
msgid ""
"The `network` folder is optional, see <<add-network-eib>> for more details."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:31
msgid ""
"The custom/scripts directory contains scripts to be run on first-boot; "
"currently a `01-fix-growfs.sh` script is required to resize the OS root "
"partition on deployment"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:32
#, no-wrap
msgid ""
"├── downstream-cluster-config.yaml\n"
"├── base-images/\n"
"│   └ SLE-Micro.x86_64-5.5.0-Default-RT-GM.raw\n"
"├── network/\n"
"|   └ configure-network.sh\n"
"└── custom/\n"
"    └ scripts/\n"
"        └ 01-fix-growfs.sh\n"
msgstr ""

#. type: Title =====
#: asciidoc/product/atip-automated-provision.adoc:33
#: asciidoc/product/atip-automated-provision.adoc:83
#, no-wrap
msgid "Downstream cluster image definition file"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:34
msgid ""
"The `downstream-cluster-config.yaml` file is the main configuration file for "
"the downstream cluster image. The following is a minimal example for "
"deployment via Metal^3^:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:35
#, no-wrap
msgid ""
"apiVersion: 1.0\n"
"image:\n"
"  imageType: RAW\n"
"  arch: x86_64\n"
"  baseImage: SLE-Micro.x86_64-5.5.0-Default-RT-GM.raw\n"
"  outputImageName: eibimage-slemicro55rt-telco.raw\n"
"operatingSystem:\n"
"  kernelArgs:\n"
"    - ignition.platform.id=openstack\n"
"    - net.ifnames=1\n"
"  systemd:\n"
"    disable:\n"
"      - rebootmgr\n"
"  users:\n"
"    - username: root\n"
"      encryptedPassword: ${ROOT_PASSWORD}\n"
"      sshKeys:\n"
"      - ${USERKEY1}\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:36
msgid ""
"`$\\{ROOT_PASSWORD\\}` is the encrypted password for the root user, which "
"can be useful for test/debugging.  It can be generated with the `openssl "
"passwd -6 PASSWORD` command"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:37
msgid ""
"For the production environments, it is recommended to use the SSH keys that "
"can be added to the users block replacing the `$\\{USERKEY1\\}` with the "
"real SSH keys."
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-automated-provision.adoc:38
msgid ""
"`net.ifnames=1` enables https://documentation.suse.com/smart/network/html/"
"network-interface-predictable-naming/index.html[Predictable Network "
"Interface Naming]"
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-automated-provision.adoc:39
msgid ""
"This matches the default configuration for the metal3 chart, but the setting "
"must match the configured chart `predictableNicNames` value."
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-automated-provision.adoc:40
msgid ""
"Also note `ignition.platform.id=openstack` is mandatory, without this "
"argument SLEMicro configuration via ignition will fail in the Metal^3^ "
"automated flow."
msgstr ""

#. type: Title =====
#: asciidoc/product/atip-automated-provision.adoc:41
#: asciidoc/product/atip-automated-provision.adoc:85
#, no-wrap
msgid "Growfs script"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:42
#: asciidoc/product/atip-automated-provision.adoc:86
msgid ""
"Currently, a custom script (`custom/scripts/01-fix-growfs.sh`) is required "
"to grow the file system to match the disk size on first-boot after "
"provisioning. The `01-fix-growfs.sh` script contains the following "
"information:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:43
#: asciidoc/product/atip-automated-provision.adoc:87
#, no-wrap
msgid ""
"#!/bin/bash\n"
"growfs() {\n"
"  mnt=\"$1\"\n"
"  dev=\"$(findmnt --fstab --target ${mnt} --evaluate --real --output SOURCE --noheadings)\"\n"
"  # /dev/sda3 -> /dev/sda, /dev/nvme0n1p3 -> /dev/nvme0n1\n"
"  parent_dev=\"/dev/$(lsblk --nodeps -rno PKNAME \"${dev}\")\"\n"
"  # Last number in the device name: /dev/nvme0n1p42 -> 42\n"
"  partnum=\"$(echo \"${dev}\" | sed 's/^.*[^0-9]\\([0-9]\\+\\)$/\\1/')\"\n"
"  ret=0\n"
"  growpart \"$parent_dev\" \"$partnum\" || ret=$?\n"
"  [ $ret -eq 0 ] || [ $ret -eq 1 ] || exit 1\n"
"  /usr/lib/systemd/systemd-growfs \"$mnt\"\n"
"}\n"
"growfs /\n"
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-automated-provision.adoc:44
msgid ""
"Add your own custom scripts to be executed during the provisioning process "
"using the same approach.  For more information, see <<quickstart-eib>>."
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-automated-provision.adoc:45
msgid ""
"The bug related to this workaround is https://bugzilla.suse.com/show_bug.cgi?"
"id=1217430"
msgstr ""

#. type: Title =====
#: asciidoc/product/atip-automated-provision.adoc:46
#, no-wrap
msgid "Additional configuration for Telco workloads"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:47
msgid ""
"To enable Telco features like `dpdk`, `sr-iov` or `FEC`, additional packages "
"may be required as shown in the following example."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:48
#, no-wrap
msgid ""
"apiVersion: 1.0\n"
"image:\n"
"  imageType: RAW\n"
"  arch: x86_64\n"
"  baseImage: SLE-Micro.x86_64-5.5.0-Default-RT-GM.raw\n"
"  outputImageName: eibimage-slemicro55rt-telco.raw\n"
"operatingSystem:\n"
"  kernelArgs:\n"
"    - ignition.platform.id=openstack\n"
"    - net.ifnames=1\n"
"  systemd:\n"
"    disable:\n"
"      - rebootmgr\n"
"  users:\n"
"    - username: root\n"
"      encryptedPassword: ${ROOT_PASSWORD}\n"
"      sshKeys:\n"
"      - ${user1Key1}\n"
"  packages:\n"
"    packageList:\n"
"      - jq\n"
"      - dpdk22\n"
"      - dpdk22-tools\n"
"      - libdpdk-23\n"
"      - pf-bb-config\n"
"    additionalRepos:\n"
"      - url: https://download.opensuse.org/repositories/isv:/SUSE:/Edge:/Telco/SLEMicro5.5/\n"
"    sccRegistrationCode: ${SCC_REGISTRATION_CODE}\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:49
msgid ""
"Where `$\\{SCC_REGISTRATION_CODE\\}` is the registration code copied from "
"https://scc.suse.com/[SUSE Customer Center], and the package list contains "
"the minimum packages to be used for the Telco profiles.  To use the `pf-bb-"
"config` package (to enable the `FEC` feature and binding with drivers), the "
"`additionalRepos` block must be included to add the `SUSE Edge Telco` "
"repository."
msgstr ""

#. type: Title =====
#: asciidoc/product/atip-automated-provision.adoc:50
#, no-wrap
msgid "Additional script for Advanced Network Configuration"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:51
msgid ""
"If you need to configure static IPs or more advanced networking scenarios as "
"described in <<advanced-network-configuration>>, the following additional "
"configuration is required."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:52
msgid ""
"In the `network` folder, create the following `configure-network.sh` file - "
"this consumes configuration drive data on first-boot, and configures the "
"host networking using the https://github.com/suse-edge/nm-configurator[NM "
"Configurator tool]."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:53
#: asciidoc/product/atip-automated-provision.adoc:90
#: asciidoc/product/atip-management-cluster.adoc:136
#: asciidoc/product/atip-management-cluster.adoc:209
#, no-wrap
msgid "#!/bin/bash\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:54
#, no-wrap
msgid "set -eux\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:55
#, no-wrap
msgid ""
"# Attempt to statically configure a NIC in the case where we find a network_data.json\n"
"# In a configuration drive\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:56
#, no-wrap
msgid ""
"CONFIG_DRIVE=$(blkid --label config-2 || true)\n"
"if [ -z \"${CONFIG_DRIVE}\" ]; then\n"
"  echo \"No config-2 device found, skipping network configuration\"\n"
"  exit 0\n"
"fi\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:57
#, no-wrap
msgid "mount -o ro $CONFIG_DRIVE /mnt\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:58
#, no-wrap
msgid "NETWORK_DATA_FILE=\"/mnt/openstack/latest/network_data.json\"\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:59
#, no-wrap
msgid ""
"if [ ! -f \"${NETWORK_DATA_FILE}\" ]; then\n"
"  umount /mnt\n"
"  echo \"No network_data.json found, skipping network configuration\"\n"
"  exit 0\n"
"fi\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:60
#, no-wrap
msgid "DESIRED_HOSTNAME=$(cat /mnt/openstack/latest/meta_data.json | tr ',{}' '\\n' | grep '\\\"metal3-name\\\"' | sed 's/.*\\\"metal3-name\\\": \\\"\\(.*\\)\\\"/\\1/')\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:61
#, no-wrap
msgid ""
"mkdir -p /tmp/nmc/{desired,generated}\n"
"cp ${NETWORK_DATA_FILE} /tmp/nmc/desired/${DESIRED_HOSTNAME}.yaml\n"
"umount /mnt\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:62
#, no-wrap
msgid ""
"./nmc generate --config-dir /tmp/nmc/desired --output-dir /tmp/nmc/generated\n"
"./nmc apply --config-dir /tmp/nmc/generated\n"
msgstr ""

#. type: Title ===
#: asciidoc/product/atip-automated-provision.adoc:63
#: asciidoc/product/atip-management-cluster.adoc:247
#, no-wrap
msgid "Image creation"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:64
#: asciidoc/product/atip-automated-provision.adoc:118
msgid ""
"Once the directory structure is prepared following the previous sections, "
"run the following command to build the image:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:65
#, no-wrap
msgid ""
"podman run --rm --privileged -it -v $PWD:/eib \\\n"
" registry.suse.com/edge/edge-image-builder:1.0.2 \\\n"
" build --definition-file downstream-cluster-config.yaml\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:66
#: asciidoc/product/atip-automated-provision.adoc:120
msgid ""
"This creates the output ISO image file named `eibimage-slemicro55rt-telco."
"raw`, based on the definition described above."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:67
msgid ""
"The output image must then be made available via a webserver, either the "
"media-server container enabled via the <<metal3-media-server,Management "
"Cluster Documentation>> or some other locally accessible server.  In the "
"examples below, we refer to this server as `imagecache.local:8080`"
msgstr ""

#. type: Title ===
#: asciidoc/product/atip-automated-provision.adoc:68
#, no-wrap
msgid "Prepare downstream cluster image for air-gap scenarios"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:70
msgid ""
"Much of the configuration is possible with Edge Image Builder, but in this "
"guide, we cover the minimal configurations necessary to set up the "
"downstream cluster for air-gap scenarios."
msgstr ""

#. type: Title ====
#: asciidoc/product/atip-automated-provision.adoc:71
#, no-wrap
msgid "Prerequisites for air-gap scenarios"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:74
msgid ""
"If you want to use SR-IOV or any other workload which require a container "
"image, a local private registry must be deployed and already configured "
"(with/without TLS and/or authentication). This registry will be used to "
"store the images and the helm chart OCI images."
msgstr ""

#. type: Title ====
#: asciidoc/product/atip-automated-provision.adoc:75
#, no-wrap
msgid "Image configuration for air-gap scenarios"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:77
msgid ""
"`downstream-cluster-airgap-config.yaml` is the image definition file, see "
"<<quickstart-eib>> for more details."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:80
msgid ""
"The `custom/scripts` directory contains scripts to be run on first-boot; "
"currently a `01-fix-growfs.sh` script is required to resize the OS root "
"partition on deployment. For air-gap scenarios, a script `02-airgap.sh` is "
"required to copy the images to the right place during the image creation "
"process."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:81
msgid ""
"The `custom/files` directory contains the `rke2` and the `cni` images to be "
"copied to the image during the image creation process."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:82
#, no-wrap
msgid ""
"├── downstream-cluster-airgap-config.yaml\n"
"├── base-images/\n"
"│   └ SLE-Micro.x86_64-5.5.0-Default-RT-GM.raw\n"
"├── network/\n"
"|   └ configure-network.sh\n"
"└── custom/\n"
"    └ files/\n"
"    |   └ install.sh\n"
"    |   └ rke2-images-cilium.linux-amd64.tar.zst\n"
"    |   └ rke2-images-core.linux-amd64.tar.zst\n"
"    |   └ rke2-images-multus.linux-amd64.tar.zst\n"
"    |   └ rke2-images.linux-amd64.tar.zst\n"
"    |   └ rke2.linux-amd64.tar.zst\n"
"    |   └ sha256sum-amd64.txt\n"
"    └ scripts/\n"
"        └ 01-fix-growfs.sh\n"
"        └ 02-airgap.sh\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:84
msgid ""
"The `downstream-cluster-airgap-config.yaml` file is the main configuration "
"file for the downstream cluster image and the content has been described in "
"the previous xref:add-telco-feature-eib[section]."
msgstr ""

#. type: Title =====
#: asciidoc/product/atip-automated-provision.adoc:88
#, no-wrap
msgid "Air-gap script"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:89
msgid ""
"The following script (`custom/scripts/02-airgap.sh`) is required to copy the "
"images to the right place during the image creation process:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:91
#, no-wrap
msgid ""
"# create the folder to extract the artifacts there\n"
"mkdir -p /opt/rke2-artifacts\n"
"mkdir -p /var/lib/rancher/rke2/agent/images\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:92
#, no-wrap
msgid ""
"# copy the artifacts\n"
"cp install.sh /opt/\n"
"cp rke2-images*.tar.zst rke2.linux-amd64.tar.gz sha256sum-amd64.txt /opt/rke2-artifacts/\n"
msgstr ""

#. type: Title =====
#: asciidoc/product/atip-automated-provision.adoc:93
#, no-wrap
msgid "Custom files for air-gap scenarios"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:94
msgid ""
"The `custom/files` directory contains the `rke2` and the `cni` images to be "
"copied to the image during the image creation process.  To easily generate "
"the images, prepare them locally using following https://github.com/suse-"
"edge/fleet-examples/blob/release-3.0/scripts/day2/edge-save-rke2-images."
"sh[script] and the list of images https://github.com/suse-edge/fleet-"
"examples/blob/release-3.0/scripts/day2/edge-release-rke2-images.txt[here] to "
"generate the artifacts required to be included in `custom/files`.  Also, you "
"can download the latest `rke2-install` script from https://get.rke2.io/"
"[here]."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:95
#, no-wrap
msgid "$ ./edge-save-rke2-images.sh -o custom/files -l ~/edge-release-rke2-images.txt\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:96
msgid ""
"After downloading the images, the directory structure should look like this:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:97
#, no-wrap
msgid ""
"└── custom/\n"
"    └ files/\n"
"        └ install.sh\n"
"        └ rke2-images-cilium.linux-amd64.tar.zst\n"
"        └ rke2-images-core.linux-amd64.tar.zst\n"
"        └ rke2-images-multus.linux-amd64.tar.zst\n"
"        └ rke2-images.linux-amd64.tar.zst\n"
"        └ rke2.linux-amd64.tar.zst\n"
"        └ sha256sum-amd64.txt\n"
msgstr ""

#. type: Title =====
#: asciidoc/product/atip-automated-provision.adoc:98
#, no-wrap
msgid "Preload your private registry with images required for air-gap scenarios and SR-IOV (optional)"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:99
msgid ""
"If you want to use SR-IOV in your air-gap scenario or any other workload "
"images, you must preload your local private registry with the images "
"following the next steps:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:100
msgid ""
"Download, extract, and push the helm-chart OCI images to the private registry"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:101
msgid ""
"Download, extract, and push the rest of images required to the private "
"registry"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:102
msgid ""
"The following scripts can be used to download, extract, and push the images "
"to the private registry. We will show an example to preload the SR-IOV "
"images, but you can also use the same approach to preload any other custom "
"images:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:103
msgid "Preload with helm-chart OCI images for SR-IOV:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:104
msgid "You must create a list with the helm-chart OCI images required:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:105
#, no-wrap
msgid ""
"$ cat > edge-release-helm-oci-artifacts.txt <<EOF\n"
"edge/sriov-network-operator-chart:1.2.2\n"
"edge/sriov-crd-chart:1.2.2\n"
"EOF\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:106
msgid ""
"Generate a local tarball file using the following https://github.com/suse-"
"edge/fleet-examples/blob/release-3.0/scripts/day2/edge-save-oci-artefacts."
"sh[script] and the list created above:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:107
#, no-wrap
msgid ""
"$ ./edge-save-oci-artefacts.sh -al ./edge-release-helm-oci-artifacts.txt -s registry.suse.com\n"
"Pulled: registry.suse.com/edge/sriov-network-operator-chart:1.2.2\n"
"Pulled: registry.suse.com/edge/sriov-crd-chart:1.2.2\n"
"a edge-release-oci-tgz-20240705\n"
"a edge-release-oci-tgz-20240705/sriov-network-operator-chart-1.2.2.tgz\n"
"a edge-release-oci-tgz-20240705/sriov-crd-chart-1.2.2.tgz\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:108
msgid ""
"Upload your tarball file to your private registry (e.g. `myregistry:5000`) "
"using the following https://github.com/suse-edge/fleet-examples/blob/"
"release-3.0/scripts/day2/edge-load-oci-artefacts.sh[script] to preload your "
"registry with the helm chart OCI images downloaded in the previous step:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:109
#, no-wrap
msgid ""
"$ tar zxvf edge-release-oci-tgz-20240705.tgz\n"
"$ ./edge-load-oci-artefacts.sh -ad edge-release-oci-tgz-20240705 -r myregistry:5000\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:110
msgid "Preload with the rest of the images required for SR-IOV:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:111
msgid ""
"In this case, we must include the `sr-iov container images for telco "
"workloads (e.g. as a reference, you could get them from https://github.com/"
"suse-edge/charts/blob/release-3.0/charts/sriov-network-"
"operator/1.2.2%2Bup0.1.0/values.yaml[helm-chart values])"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:112
#, no-wrap
msgid ""
"$ cat > edge-release-images.txt <<EOF\n"
"rancher/hardened-sriov-network-operator:v1.2.0-build20240327\n"
"rancher/rancher/hardened-sriov-network-config-daemon:v1.2.0-build20240327\n"
"rancher/hardened-sriov-cni:v1.2.0-build20240327\n"
"rancher/hardened-ib-sriov-cni:v1.2.0-build20240327\n"
"rancher/hardened-sriov-network-device-plugin:v1.2.0-build20240327\n"
"rancher/hardened-sriov-network-resources-injector:v1.2.0-build20240327\n"
"rancher/hardened-sriov-network-webhook:v1.2.0-build20240327\n"
"EOF\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:113
msgid ""
"Using the following https://github.com/suse-edge/fleet-examples/blob/"
"release-3.0/scripts/day2/edge-save-images.sh[script] and the list created "
"above, you must generate locally the tarball file with the images required:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:114
#, no-wrap
msgid ""
"$ ./edge-save-images.sh -al ./edge-release-images.txt -s registry.suse.com\n"
"Pulled: registry.suse.com/rancher/hardened-sriov-network-operator:v1.2.0-build20240327\n"
"Pulled: registry.suse.com/rancher/rancher/hardened-sriov-network-config-daemon:v1.2.0-build20240327\n"
"Pulled: registry.suse.com/rancher/hardened-sriov-cni:v1.2.0-build20240327\n"
"Pulled: registry.suse.com/rancher/hardened-ib-sriov-cni:v1.2.0-build20240327\n"
"Pulled: registry.suse.com/rancher/hardened-sriov-network-device-plugin:v1.2.0-build20240327\n"
"Pulled: registry.suse.com/rancher/hardened-sriov-network-resources-injector:v1.2.0-build20240327\n"
"Pulled: registry.suse.com/rancher/hardened-sriov-network-webhook:v1.2.0-build20240327\n"
"a edge-release-images-tgz-20240705\n"
"a edge-release-images-tgz-20240705/hardened-sriov-network-operator-v1.2.0-build20240327.tar.gz\n"
"a edge-release-images-tgz-20240705/hardened-sriov-network-config-daemon-v1.2.0-build20240327.tar.gz\n"
"a edge-release-images-tgz-20240705/hardened-sriov-cni-v1.2.0-build20240327.tar.gz\n"
"a edge-release-images-tgz-20240705/hardened-ib-sriov-cni-v1.2.0-build20240327.tar.gz\n"
"a edge-release-images-tgz-20240705/hardened-sriov-network-device-plugin-v1.2.0-build20240327.tar.gz\n"
"a edge-release-images-tgz-20240705/hardened-sriov-network-resources-injector-v1.2.0-build20240327.tar.gz\n"
"a edge-release-images-tgz-20240705/hardened-sriov-network-webhook-v1.2.0-build20240327.tar.gz\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:115
msgid ""
"Upload your tarball file to your private registry (e.g. `myregistry:5000`) "
"using the following https://github.com/suse-edge/fleet-examples/blob/"
"release-3.0/scripts/day2/edge-load-images.sh[script] to preload your private "
"registry with the images downloaded in the previous step:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:116
#, no-wrap
msgid ""
"$ tar zxvf edge-release-images-tgz-20240705.tgz\n"
"$ ./edge-load-images.sh -ad edge-release-images-tgz-20240705 -r myregistry:5000\n"
msgstr ""

#. type: Title ====
#: asciidoc/product/atip-automated-provision.adoc:117
#, no-wrap
msgid "Image creation for air-gap scenarios"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:119
#, no-wrap
msgid ""
"podman run --rm --privileged -it -v $PWD:/eib \\\n"
" registry.suse.com/edge/edge-image-builder:1.0.2 \\\n"
" build --definition-file downstream-cluster-airgap-config.yaml\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:121
msgid ""
"The output image must then be made available via a webserver, either the "
"media-server container enabled via the <<metal3-media-server,Management "
"Cluster Documentation>> or some other locally accessible server.  In the "
"examples below, we refer to this server as `imagecache.local:8080`."
msgstr ""

#. type: Title ===
#: asciidoc/product/atip-automated-provision.adoc:122
#, no-wrap
msgid "Downstream cluster provisioning with Direct network provisioning (single-node)"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:123
msgid ""
"This section describes the workflow used to automate the provisioning of a "
"single-node downstream cluster using directed network provisioning.  This is "
"the simplest way to automate the provisioning of a downstream cluster."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:124
#: asciidoc/product/atip-automated-provision.adoc:167
#: asciidoc/product/atip-automated-provision.adoc:223
#: asciidoc/product/atip-automated-provision.adoc:249
msgid "*Requirements*"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:125
#: asciidoc/product/atip-automated-provision.adoc:168
msgid ""
"The image generated using `EIB`, as described in the xref:eib-edge-image-"
"connected[previous section], with the minimal configuration to set up the "
"downstream cluster has to be located in the management cluster exactly on "
"the path you configured on xref:metal3-media-server[this section]."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:126
msgid ""
"The management server created and available to be used on the following "
"sections. For more information, refer to the Management Cluster section "
"<<atip-management-cluster>>."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:127
#: asciidoc/product/atip-automated-provision.adoc:170
msgid "*Workflow*"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:128
msgid ""
"The following diagram shows the workflow used to automate the provisioning "
"of a single-node downstream cluster using directed network provisioning:"
msgstr ""

#. type: Target for macro image
#: asciidoc/product/atip-automated-provision.adoc:129
#, no-wrap
msgid "atip-automated-singlenode1.png"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:130
msgid ""
"There are two different steps to automate the provisioning of a single-node "
"downstream cluster using directed network provisioning:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:131
msgid ""
"Enroll the bare-metal host to make it available for the provisioning process."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:132
msgid ""
"Provision the bare-metal host to install and configure the operating system "
"and the Kubernetes cluster."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:133
msgid "*Enroll the bare-metal host*"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:134
msgid ""
"The first step is to enroll the new bare-metal host in the management "
"cluster to make it available to be provisioned.  To do that, the following "
"file (`bmh-example.yaml`) has to be created in the management cluster, to "
"specify the `BMC` credentials to be used and the `BaremetalHost` object to "
"be enrolled:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:135
#: asciidoc/product/atip-automated-provision.adoc:241
#, no-wrap
msgid ""
"apiVersion: v1\n"
"kind: Secret\n"
"metadata:\n"
"  name: example-demo-credentials\n"
"type: Opaque\n"
"data:\n"
"  username: ${BMC_USERNAME}\n"
"  password: ${BMC_PASSWORD}\n"
"---\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:136
#, no-wrap
msgid ""
"apiVersion: metal3.io/v1alpha1\n"
"kind: BareMetalHost\n"
"metadata:\n"
"  name: flexran-demo\n"
"  labels:\n"
"    cluster-role: control-plane\n"
"spec:\n"
"  online: true\n"
"  bootMACAddress: ${BMC_MAC}\n"
"  rootDeviceHints:\n"
"    deviceName: /dev/nvme0n1\n"
"  bmc:\n"
"    address: ${BMC_ADDRESS}\n"
"    disableCertificateVerification: true\n"
"    credentialsName: example-demo-credentials\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:137
msgid "where:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:138
msgid ""
"`$\\{BMC_USERNAME\\}` — The user name for the `BMC` of the new bare-metal "
"host."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:139
msgid ""
"`$\\{BMC_PASSWORD\\}` — The password for the `BMC` of the new bare-metal "
"host."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:140
msgid ""
"`$\\{BMC_MAC\\}` — The `MAC` address of the new bare-metal host to be used."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:141
msgid ""
"`$\\{BMC_ADDRESS\\}` — The `URL` for the bare-metal host `BMC` (for example, "
"`redfish-virtualmedia://192.168.200.75/redfish/v1/Systems/1/`). To learn "
"more about the different options available depending on your hardware "
"provider, check the following https://github.com/metal3-io/baremetal-"
"operator/blob/main/docs/api.md[link]."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:142
msgid ""
"Once the file is created, the following command has to be executed in the "
"management cluster to start enrolling the new bare-metal host in the "
"management cluster:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:143
#, no-wrap
msgid "$ kubectl apply -f bmh-example.yaml\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:144
msgid ""
"The new bare-metal host object will be enrolled, changing its state from "
"registering to inspecting and available. The changes can be checked using "
"the following command:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:145
#, no-wrap
msgid "$ kubectl get bmh\n"
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-automated-provision.adoc:146
#: asciidoc/product/atip-automated-provision.adoc:190
msgid ""
"The `BaremetalHost` object is in the `registering` state until the `BMC` "
"credentials are validated. Once the credentials are validated, the "
"`BaremetalHost` object changes its state to `inspecting`, and this step "
"could take some time depending on the hardware (up to 20 minutes). During "
"the inspecting phase, the hardware information is retrieved and the "
"Kubernetes object is updated. Check the information using the following "
"command: `kubectl get bmh -o yaml`."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:147
#: asciidoc/product/atip-automated-provision.adoc:191
msgid "*Provision step*"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:148
msgid ""
"Once the bare-metal host is enrolled and available, the next step is to "
"provision the bare-metal host to install and configure the operating system "
"and the Kubernetes cluster.  To do that, the following file (`capi-"
"provisioning-example.yaml`) has to be created in the management-cluster with "
"the following information (the `capi-provisioning-example.yaml` can be "
"generated by joining the following blocks)."
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-automated-provision.adoc:149
#: asciidoc/product/atip-automated-provision.adoc:193
msgid "Only values between `$\\{...\\}` must be replaced with the real values."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:150
msgid ""
"The following block is the cluster definition, where the networking can be "
"configured using the `pods` and the `services` blocks. Also, it contains the "
"references to the control plane and the infrastructure (using the `Metal^3^` "
"provider) objects to be used."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:151
#, no-wrap
msgid ""
"apiVersion: cluster.x-k8s.io/v1beta1\n"
"kind: Cluster\n"
"metadata:\n"
"  name: single-node-cluster\n"
"  namespace: default\n"
"spec:\n"
"  clusterNetwork:\n"
"    pods:\n"
"      cidrBlocks:\n"
"        - 192.168.0.0/18\n"
"    services:\n"
"      cidrBlocks:\n"
"        - 10.96.0.0/12\n"
"  controlPlaneRef:\n"
"    apiVersion: controlplane.cluster.x-k8s.io/v1alpha1\n"
"    kind: RKE2ControlPlane\n"
"    name: single-node-cluster\n"
"  infrastructureRef:\n"
"    apiVersion: infrastructure.cluster.x-k8s.io/v1beta1\n"
"    kind: Metal3Cluster\n"
"    name: single-node-cluster\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:152
msgid ""
"The `Metal3Cluster` object specifies the control-plane endpoint (replacing "
"the `$\\{DOWNSTREAM_CONTROL_PLANE_IP\\}`) to be configured and the "
"`noCloudProvider` because a bare-metal node is used."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:153
#, no-wrap
msgid ""
"apiVersion: infrastructure.cluster.x-k8s.io/v1beta1\n"
"kind: Metal3Cluster\n"
"metadata:\n"
"  name: single-node-cluster\n"
"  namespace: default\n"
"spec:\n"
"  controlPlaneEndpoint:\n"
"    host: ${DOWNSTREAM_CONTROL_PLANE_IP}\n"
"    port: 6443\n"
"  noCloudProvider: true\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:154
msgid ""
"The `RKE2ControlPlane` object specifies the control-plane configuration to "
"be used and the `Metal3MachineTemplate` object specifies the control-plane "
"image to be used.  Also, it contains the information about the number of "
"replicas to be used (in this case, one) and the `CNI` plug-in to be used (in "
"this case, `Cilium`).  The agentConfig block contains the `Ignition` format "
"to be used and the `additionalUserData` to be used to configure the `RKE2` "
"node with information like a systemd named `rke2-preinstall.service` to "
"replace automatically the `BAREMETALHOST_UUID` and `node-name` during the "
"provisioning process using the Ironic information.  The last block of "
"information contains the Kubernetes version to be used. `$\\{RKE2_VERSION\\}"
"` is the version of `RKE2` to be used replacing this value (for example, "
"`v1.28.9+rke2r1`)."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:155
#, no-wrap
msgid ""
"apiVersion: controlplane.cluster.x-k8s.io/v1alpha1\n"
"kind: RKE2ControlPlane\n"
"metadata:\n"
"  name: single-node-cluster\n"
"  namespace: default\n"
"spec:\n"
"  infrastructureRef:\n"
"    apiVersion: infrastructure.cluster.x-k8s.io/v1beta1\n"
"    kind: Metal3MachineTemplate\n"
"    name: single-node-cluster-controlplane\n"
"  replicas: 1\n"
"  serverConfig:\n"
"    cni: cilium\n"
"  agentConfig:\n"
"    format: ignition\n"
"    additionalUserData:\n"
"      config: |\n"
"        variant: fcos\n"
"        version: 1.4.0\n"
"        systemd:\n"
"          units:\n"
"            - name: rke2-preinstall.service\n"
"              enabled: true\n"
"              contents: |\n"
"                [Unit]\n"
"                Description=rke2-preinstall\n"
"                Wants=network-online.target\n"
"                Before=rke2-install.service\n"
"                ConditionPathExists=!/run/cluster-api/bootstrap-success.complete\n"
"                [Service]\n"
"                Type=oneshot\n"
"                User=root\n"
"                ExecStartPre=/bin/sh -c \"mount -L config-2 /mnt\"\n"
"                ExecStart=/bin/sh -c \"sed -i \\\"s/BAREMETALHOST_UUID/$(jq -r .uuid /mnt/openstack/latest/meta_data.json)/\\\" /etc/rancher/rke2/config.yaml\"\n"
"                ExecStart=/bin/sh -c \"echo \\\"node-name: $(jq -r .name /mnt/openstack/latest/meta_data.json)\\\" >> /etc/rancher/rke2/config.yaml\"\n"
"                ExecStartPost=/bin/sh -c \"umount /mnt\"\n"
"                [Install]\n"
"                WantedBy=multi-user.target\n"
"    kubelet:\n"
"      extraArgs:\n"
"        - provider-id=metal3://BAREMETALHOST_UUID\n"
"    version: ${RKE2_VERSION}\n"
"    nodeName: \"localhost.localdomain\"\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:156
#: asciidoc/product/atip-automated-provision.adoc:211
msgid "The `Metal3MachineTemplate` object specifies the following information:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:157
#: asciidoc/product/atip-automated-provision.adoc:212
msgid "The `dataTemplate` to be used as a reference to the template."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:158
#: asciidoc/product/atip-automated-provision.adoc:213
msgid ""
"The `hostSelector` to be used matching with the label created during the "
"enrollment process."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:159
msgid ""
"The `image` to be used as a reference to the image generated using `EIB` on "
"the previous xref:eib-edge-image-connected[section], and the `checksum` and "
"`checksumType` to be used to validate the image."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:160
#, no-wrap
msgid ""
"apiVersion: infrastructure.cluster.x-k8s.io/v1beta1\n"
"kind: Metal3MachineTemplate\n"
"metadata:\n"
"  name: single-node-cluster-controlplane\n"
"  namespace: default\n"
"spec:\n"
"  template:\n"
"    spec:\n"
"      dataTemplate:\n"
"        name: single-node-cluster-controlplane-template\n"
"      hostSelector:\n"
"        matchLabels:\n"
"          cluster-role: control-plane\n"
"      image:\n"
"        checksum: http://imagecache.local:8080/eibimage-slemicro55rt-telco.raw.sha256\n"
"        checksumType: sha256\n"
"        format: raw\n"
"        url: http://imagecache.local:8080/eibimage-slemicro55rt-telco.raw\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:161
#: asciidoc/product/atip-automated-provision.adoc:216
msgid ""
"The `Metal3DataTemplate` object specifies the `metaData` for the downstream "
"cluster."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:162
#: asciidoc/product/atip-automated-provision.adoc:217
#, no-wrap
msgid ""
"apiVersion: infrastructure.cluster.x-k8s.io/v1beta1\n"
"kind: Metal3DataTemplate\n"
"metadata:\n"
"  name: single-node-cluster-controlplane-template\n"
"  namespace: default\n"
"spec:\n"
"  clusterName: single-node-cluster\n"
"  metaData:\n"
"    objectNames:\n"
"      - key: name\n"
"        object: machine\n"
"      - key: local-hostname\n"
"        object: machine\n"
"      - key: local_hostname\n"
"        object: machine\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:163
msgid ""
"Once the file is created by joining the previous blocks, the following "
"command must be executed in the management cluster to start provisioning the "
"new bare-metal host:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:164
#: asciidoc/product/atip-automated-provision.adoc:219
#: asciidoc/product/atip-automated-provision.adoc:287
#, no-wrap
msgid "$ kubectl apply -f capi-provisioning-example.yaml\n"
msgstr ""

#. type: Title ===
#: asciidoc/product/atip-automated-provision.adoc:165
#, no-wrap
msgid "Downstream cluster provisioning with Direct network provisioning (multi-node)"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:166
msgid ""
"This section describes the workflow used to automate the provisioning of a "
"multi-node downstream cluster using directed network provisioning and "
"`MetalLB` as a load-balancer strategy.  This is the simplest way to automate "
"the provisioning of a downstream cluster. The following diagram shows the "
"workflow used to automate the provisioning of a multi-node downstream "
"cluster using directed network provisioning and `MetalLB`."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:169
#: asciidoc/product/atip-automated-provision.adoc:252
msgid ""
"The management server created and available to be used on the following "
"sections. For more information, refer to the Management Cluster section: "
"<<atip-management-cluster>>."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:171
msgid ""
"The following diagram shows the workflow used to automate the provisioning "
"of a multi-node downstream cluster using directed network provisioning:"
msgstr ""

#. type: Target for macro image
#: asciidoc/product/atip-automated-provision.adoc:172
#, no-wrap
msgid "atip-automate-multinode1.png"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:173
msgid ""
"Enroll the three bare-metal hosts to make them available for the "
"provisioning process."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:174
msgid ""
"Provision the three bare-metal hosts to install and configure the operating "
"system and the Kubernetes cluster using `MetalLB`."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:175
msgid "*Enroll the bare-metal hosts*"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:176
msgid ""
"The first step is to enroll the three bare-metal hosts in the management "
"cluster to make them available to be provisioned.  To do that, the following "
"files (`bmh-example-node1.yaml`, `bmh-example-node2.yaml` and `bmh-example-"
"node3.yaml`) must be created in the management cluster, to specify the `BMC` "
"credentials to be used and the `BaremetalHost` object to be enrolled in the "
"management cluster."
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-automated-provision.adoc:177
msgid ""
"Only the values between `$\\{...\\}` have to be replaced with the real "
"values."
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-automated-provision.adoc:178
msgid ""
"We will walk you through the process for only one host. The same steps apply "
"to the other two nodes."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:179
#, no-wrap
msgid ""
"apiVersion: v1\n"
"kind: Secret\n"
"metadata:\n"
"  name: node1-example-credentials\n"
"type: Opaque\n"
"data:\n"
"  username: ${BMC_NODE1_USERNAME}\n"
"  password: ${BMC_NODE1_PASSWORD}\n"
"---\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:180
#, no-wrap
msgid ""
"apiVersion: metal3.io/v1alpha1\n"
"kind: BareMetalHost\n"
"metadata:\n"
"  name: node1-example\n"
"  labels:\n"
"    cluster-role: control-plane\n"
"spec:\n"
"  online: true\n"
"  bootMACAddress: ${BMC_NODE1_MAC}\n"
"  bmc:\n"
"    address: ${BMC_NODE1_ADDRESS}\n"
"    disableCertificateVerification: true\n"
"    credentialsName: node1-example-credentials\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:181
msgid "Where:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:182
msgid ""
"`$\\{BMC_NODE1_USERNAME\\}` — The username for the BMC of the first bare-"
"metal host."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:183
msgid ""
"`$\\{BMC_NODE1_PASSWORD\\}` — The password for the BMC of the first bare-"
"metal host."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:184
msgid ""
"`$\\{BMC_NODE1_MAC\\}` — The MAC address of the first bare-metal host to be "
"used."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:185
msgid ""
"`$\\{BMC_NODE1_ADDRESS\\}` — The URL for the first bare-metal host BMC (for "
"example, `redfish-virtualmedia://192.168.200.75/redfish/v1/Systems/1/`). To "
"learn more about the different options available depending on your hardware "
"provider, check the following https://github.com/metal3-io/baremetal-"
"operator/blob/main/docs/api.md[link]."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:186
msgid ""
"Once the file is created, the following command must be executed in the "
"management cluster to start enrolling the bare-metal hosts in the management "
"cluster:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:187
#, no-wrap
msgid ""
"$ kubectl apply -f bmh-example-node1.yaml\n"
"$ kubectl apply -f bmh-example-node2.yaml\n"
"$ kubectl apply -f bmh-example-node3.yaml\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:188
msgid ""
"The new bare-metal host objects are enrolled, changing their state from "
"registering to inspecting and available. The changes can be checked using "
"the following command:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:189
#, no-wrap
msgid "$ kubectl get bmh -o wide\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:192
msgid ""
"Once the three bar metal hosts are enrolled and available, the next step is "
"to provision the bare-metal hosts to install and configure the operating "
"system and the Kubernetes cluster, creating a load balancer to manage them.  "
"To do that, the following file (`capi-provisioning-example.yaml`) must be "
"created in the management cluster with the following information (the `capi-"
"provisioning-example.yaml can be generated by joining the following blocks)."
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-automated-provision.adoc:194
msgid ""
"The `VIP` address is a reserved IP address that is not assigned to any node "
"and is used to configure the load balancer."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:195
msgid ""
"Below is the cluster definition, where the cluster network can be configured "
"using the `pods` and the `services` blocks. Also, it contains the references "
"to the control plane and the infrastructure (using the `Metal^3^` provider) "
"objects to be used."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:196
#, no-wrap
msgid ""
"apiVersion: cluster.x-k8s.io/v1beta1\n"
"kind: Cluster\n"
"metadata:\n"
"  name: multinode-cluster\n"
"  namespace: default\n"
"spec:\n"
"  clusterNetwork:\n"
"    pods:\n"
"      cidrBlocks:\n"
"        - 192.168.0.0/18\n"
"    services:\n"
"      cidrBlocks:\n"
"        - 10.96.0.0/12\n"
"  controlPlaneRef:\n"
"    apiVersion: controlplane.cluster.x-k8s.io/v1alpha1\n"
"    kind: RKE2ControlPlane\n"
"    name: multinode-cluster\n"
"  infrastructureRef:\n"
"    apiVersion: infrastructure.cluster.x-k8s.io/v1beta1\n"
"    kind: Metal3Cluster\n"
"    name: multinode-cluster\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:197
msgid ""
"The `Metal3Cluster` object specifies the control-plane endpoint that uses "
"the `VIP` address already reserved (replacing the `$"
"\\{DOWNSTREAM_VIP_ADDRESS\\}`) to be configured and the `noCloudProvider` "
"because the three bare-metal nodes are used."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:198
#, no-wrap
msgid ""
"apiVersion: infrastructure.cluster.x-k8s.io/v1beta1\n"
"kind: Metal3Cluster\n"
"metadata:\n"
"  name: multinode-cluster\n"
"  namespace: default\n"
"spec:\n"
"  controlPlaneEndpoint:\n"
"    host: ${EDGE_VIP_ADDRESS}\n"
"    port: 6443\n"
"  noCloudProvider: true\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:199
msgid ""
"The `RKE2ControlPlane` object specifies the control-plane configuration to "
"be used, and the `Metal3MachineTemplate` object specifies the control-plane "
"image to be used."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:200
msgid "The number of replicas to be used (in this case, three)."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:201
msgid ""
"The advertisement mode to be used by the Load Balancer (`address` uses the "
"L2 implementation), as well as the address to be used (replacing the `$"
"\\{EDGE_VIP_ADDRESS\\}` with the `VIP` address)."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:202
msgid ""
"The `serverConfig` with the `CNI` plug-in to be used (in this case, "
"`Cilium`), and the `tlsSan` to be used to configure the `VIP` address."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:203
msgid ""
"The agentConfig block contains the `Ignition` format to be used and the "
"`additionalUserData` to be used to configure the `RKE2` node with "
"information like:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:204
msgid ""
"The systemd service named `rke2-preinstall.service` to replace automatically "
"the `BAREMETALHOST_UUID` and `node-name` during the provisioning process "
"using the Ironic information."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:205
msgid ""
"The `storage` block which contains the Helm charts to be used to install the "
"`MetalLB` and the `endpoint-copier-operator`."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:206
msgid ""
"The `metalLB` custom resource file with the `IPaddressPool` and the "
"`L2Advertisement` to be used (replacing `$\\{EDGE_VIP_ADDRESS\\}` with the "
"`VIP` address)."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:207
msgid ""
"The `endpoint-svc.yaml` file to be used to configure the `kubernetes-vip` "
"service to be used by the `MetalLB` to manage the `VIP` address."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:208
msgid ""
"The last block of information contains the Kubernetes version to be used. "
"The `$\\{RKE2_VERSION\\}` is the version of `RKE2` to be used replacing this "
"value (for example, `v1.28.9+rke2r1`)."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:209
#, no-wrap
msgid ""
"apiVersion: controlplane.cluster.x-k8s.io/v1alpha1\n"
"kind: RKE2ControlPlane\n"
"metadata:\n"
"  name: multinode-cluster\n"
"  namespace: default\n"
"spec:\n"
"  infrastructureRef:\n"
"    apiVersion: infrastructure.cluster.x-k8s.io/v1beta1\n"
"    kind: Metal3MachineTemplate\n"
"    name: multinode-cluster-controlplane\n"
"  replicas: 3\n"
"  registrationMethod: \"address\"\n"
"  registrationAddress: ${EDGE_VIP_ADDRESS}\n"
"  serverConfig:\n"
"    cni: cilium\n"
"    tlsSan:\n"
"      - ${EDGE_VIP_ADDRESS}\n"
"      - https://${EDGE_VIP_ADDRESS}.sslip.io\n"
"  agentConfig:\n"
"    format: ignition\n"
"    additionalUserData:\n"
"      config: |\n"
"        variant: fcos\n"
"        version: 1.4.0\n"
"        systemd:\n"
"          units:\n"
"            - name: rke2-preinstall.service\n"
"              enabled: true\n"
"              contents: |\n"
"                [Unit]\n"
"                Description=rke2-preinstall\n"
"                Wants=network-online.target\n"
"                Before=rke2-install.service\n"
"                ConditionPathExists=!/run/cluster-api/bootstrap-success.complete\n"
"                [Service]\n"
"                Type=oneshot\n"
"                User=root\n"
"                ExecStartPre=/bin/sh -c \"mount -L config-2 /mnt\"\n"
"                ExecStart=/bin/sh -c \"sed -i \\\"s/BAREMETALHOST_UUID/$(jq -r .uuid /mnt/openstack/latest/meta_data.json)/\\\" /etc/rancher/rke2/config.yaml\"\n"
"                ExecStart=/bin/sh -c \"echo \\\"node-name: $(jq -r .name /mnt/openstack/latest/meta_data.json)\\\" >> /etc/rancher/rke2/config.yaml\"\n"
"                ExecStartPost=/bin/sh -c \"umount /mnt\"\n"
"                [Install]\n"
"                WantedBy=multi-user.target\n"
"        storage:\n"
"          files:\n"
"            - path: /var/lib/rancher/rke2/server/manifests/endpoint-copier-operator.yaml\n"
"              overwrite: true\n"
"              contents:\n"
"                inline: |\n"
"                  apiVersion: helm.cattle.io/v1\n"
"                  kind: HelmChart\n"
"                  metadata:\n"
"                    name: endpoint-copier-operator\n"
"                    namespace: kube-system\n"
"                  spec:\n"
"                    chart: oci://registry.suse.com/edge/endpoint-copier-operator-chart\n"
"                    targetNamespace: endpoint-copier-operator\n"
"                    version: 0.2.0\n"
"                    createNamespace: true\n"
"            - path: /var/lib/rancher/rke2/server/manifests/metallb.yaml\n"
"              overwrite: true\n"
"              contents:\n"
"                inline: |\n"
"                  apiVersion: helm.cattle.io/v1\n"
"                  kind: HelmChart\n"
"                  metadata:\n"
"                    name: metallb\n"
"                    namespace: kube-system\n"
"                  spec:\n"
"                    chart: oci://registry.suse.com/edge/metallb-chart\n"
"                    targetNamespace: metallb-system\n"
"                    version: 0.14.3\n"
"                    createNamespace: true\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:210
#, no-wrap
msgid ""
"            - path: /var/lib/rancher/rke2/server/manifests/metallb-cr.yaml\n"
"              overwrite: true\n"
"              contents:\n"
"                inline: |\n"
"                  apiVersion: metallb.io/v1beta1\n"
"                  kind: IPAddressPool\n"
"                  metadata:\n"
"                    name: kubernetes-vip-ip-pool\n"
"                    namespace: metallb-system\n"
"                  spec:\n"
"                    addresses:\n"
"                      - ${EDGE_VIP_ADDRESS}/32\n"
"                    serviceAllocation:\n"
"                      priority: 100\n"
"                      namespaces:\n"
"                        - default\n"
"                      serviceSelectors:\n"
"                        - matchExpressions:\n"
"                          - {key: \"serviceType\", operator: In, values: [kubernetes-vip]}\n"
"                  ---\n"
"                  apiVersion: metallb.io/v1beta1\n"
"                  kind: L2Advertisement\n"
"                  metadata:\n"
"                    name: ip-pool-l2-adv\n"
"                    namespace: metallb-system\n"
"                  spec:\n"
"                    ipAddressPools:\n"
"                      - kubernetes-vip-ip-pool\n"
"            - path: /var/lib/rancher/rke2/server/manifests/endpoint-svc.yaml\n"
"              overwrite: true\n"
"              contents:\n"
"                inline: |\n"
"                  apiVersion: v1\n"
"                  kind: Service\n"
"                  metadata:\n"
"                    name: kubernetes-vip\n"
"                    namespace: default\n"
"                    labels:\n"
"                      serviceType: kubernetes-vip\n"
"                  spec:\n"
"                    ports:\n"
"                    - name: rke2-api\n"
"                      port: 9345\n"
"                      protocol: TCP\n"
"                      targetPort: 9345\n"
"                    - name: k8s-api\n"
"                      port: 6443\n"
"                      protocol: TCP\n"
"                      targetPort: 6443\n"
"                    type: LoadBalancer\n"
"    kubelet:\n"
"      extraArgs:\n"
"        - provider-id=metal3://BAREMETALHOST_UUID\n"
"    version: ${RKE2_VERSION}\n"
"    nodeName: \"Node-multinode-cluster\"\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:214
msgid ""
"The `image` to be used as a reference to the image generated using `EIB` on "
"the previous xref:eib-edge-image-connected[section], and `checksum` and "
"`checksumType` to be used to validate the image."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:215
#, no-wrap
msgid ""
"apiVersion: infrastructure.cluster.x-k8s.io/v1beta1\n"
"kind: Metal3MachineTemplate\n"
"metadata:\n"
"  name: multinode-cluster-controlplane\n"
"  namespace: default\n"
"spec:\n"
"  template:\n"
"    spec:\n"
"      dataTemplate:\n"
"        name: multinode-cluster-controlplane-template\n"
"      hostSelector:\n"
"        matchLabels:\n"
"          cluster-role: control-plane\n"
"      image:\n"
"        checksum: http://imagecache.local:8080/eibimage-slemicro55rt-telco.raw.sha256\n"
"        checksumType: sha256\n"
"        format: raw\n"
"        url: http://imagecache.local:8080/eibimage-slemicro55rt-telco.raw\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:218
msgid ""
"Once the file is created by joining the previous blocks, the following "
"command has to be executed in the management cluster to start provisioning "
"the new three bar metal hosts:"
msgstr ""

#. type: Title ===
#: asciidoc/product/atip-automated-provision.adoc:220
#, no-wrap
msgid "Advanced Network Configuration"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:221
msgid ""
"The directed network provisioning workflow allows downstream clusters "
"network configurations such as static IPs, bonding, VLAN's, etc."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:222
msgid ""
"The following sections describe the additional steps required to enable "
"provisioning downstream clusters using advanced network configuration."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:224
msgid ""
"The image generated using `EIB` has to include the network folder and the "
"script following <<add-network-eib,this section>>."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:225
#: asciidoc/product/atip-automated-provision.adoc:253
msgid "*Configuration*"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:226
#: asciidoc/product/atip-automated-provision.adoc:254
msgid ""
"Use the following two sections as the base to enroll and provision the hosts:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:227
#: asciidoc/product/atip-automated-provision.adoc:255
msgid ""
"xref:single-node[Downstream cluster provisioning with Direct network "
"provisioning (single-node)]"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:228
#: asciidoc/product/atip-automated-provision.adoc:256
msgid ""
"xref:multi-node[Downstream cluster provisioning with Direct network "
"provisioning (multi-node)]"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:229
msgid ""
"The changes required to enable the advanced network configuration are the "
"following:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:230
msgid ""
"Enrollment step: The following new example file with a secret containing the "
"information about the `networkData` to be used to configure, for example, "
"the static `IPs` and `VLAN` for the downstream cluster"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:231
#, no-wrap
msgid ""
"apiVersion: v1\n"
"kind: Secret\n"
"metadata:\n"
"  name: controlplane-0-networkdata\n"
"type: Opaque\n"
"stringData:\n"
"  networkData: |\n"
"    interfaces:\n"
"    - name: ${CONTROLPLANE_INTERFACE}\n"
"      type: ethernet\n"
"      state: up\n"
"      mtu: 1500\n"
"      mac-address: \"${CONTROLPLANE_MAC}\"\n"
"      ipv4:\n"
"        address:\n"
"        - ip:  \"${CONTROLPLANE_IP}\"\n"
"          prefix-length: \"${CONTROLPLANE_PREFIX}\"\n"
"        enabled: true\n"
"        dhcp: false\n"
"    - name: floating\n"
"      type: vlan\n"
"      state: up\n"
"      vlan:\n"
"        base-iface: ${CONTROLPLANE_INTERFACE}\n"
"        id: ${VLAN_ID}\n"
"    dns-resolver:\n"
"      config:\n"
"        server:\n"
"        - \"${DNS_SERVER}\"\n"
"    routes:\n"
"      config:\n"
"      - destination: 0.0.0.0/0\n"
"        next-hop-address: \"${CONTROLPLANE_GATEWAY}\"\n"
"        next-hop-interface: ${CONTROLPLANE_INTERFACE}\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:232
msgid ""
"This file contains the `networkData` in a `nmstate` format to be used to "
"configure the advance network configuration (for example, `static IPs` and "
"`VLAN`) for the downstream cluster.  As you can see, the example shows the "
"configuration to enable the interface with static IPs, as well as the "
"configuration to enable the VLAN using the base interface.  Any other "
"`nmstate` example could be defined to be used to configure the network for "
"the downstream cluster to adapt to the specific requirements, where the "
"following variables have to be replaced with real values:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:233
msgid ""
"`$\\{CONTROLPLANE1_INTERFACE\\}` — The control-plane interface to be used "
"for the edge cluster (for example, `eth0`)."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:234
msgid ""
"`$\\{CONTROLPLANE1_IP\\}` — The IP address to be used as an endpoint for the "
"edge cluster (must match with the kubeapi-server endpoint)."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:235
msgid ""
"`$\\{CONTROLPLANE1_PREFIX\\}` — The CIDR to be used for the edge cluster "
"(for example, `24` if you want `/24` or `255.255.255.0`)."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:236
msgid ""
"`$\\{CONTROLPLANE1_GATEWAY\\}` — The gateway to be used for the edge cluster "
"(for example, `192.168.100.1`)."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:237
msgid ""
"`$\\{CONTROLPLANE1_MAC\\}` — The MAC address to be used for the control-"
"plane interface (for example, `00:0c:29:3e:3e:3e`)."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:238
msgid ""
"`$\\{DNS_SERVER\\}` — The DNS to be used for the edge cluster (for example, "
"`192.168.100.2`)."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:239
msgid ""
"`$\\{VLAN_ID\\}` — The VLAN ID to be used for the edge cluster (for example, "
"`100`)."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:240
msgid ""
"Also, the reference to that secret using `preprovisioningNetworkDataName` is "
"needed in the `BaremetalHost` object at the end of the file to be enrolled "
"in the management cluster."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:242
#, no-wrap
msgid ""
"apiVersion: metal3.io/v1alpha1\n"
"kind: BareMetalHost\n"
"metadata:\n"
"  name: flexran-demo\n"
"  labels:\n"
"    cluster-role: control-plane\n"
"spec:\n"
"  online: true\n"
"  bootMACAddress: ${BMC_MAC}\n"
"  rootDeviceHints:\n"
"    deviceName: /dev/nvme0n1\n"
"  bmc:\n"
"    address: ${BMC_ADDRESS}\n"
"    disableCertificateVerification: true\n"
"    credentialsName: example-demo-credentials\n"
"  preprovisioningNetworkDataName: controlplane-0-networkdata\n"
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-automated-provision.adoc:243
msgid ""
"If you need to deploy a multi-node cluster, the same process must be done "
"for the other nodes."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:244
msgid ""
"Provision step: The block of information related to the network data has to "
"be removed because the platform includes the network data configuration into "
"the secret `controlplane-0-networkdata`."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:245
#, no-wrap
msgid ""
"apiVersion: infrastructure.cluster.x-k8s.io/v1beta1\n"
"kind: Metal3DataTemplate\n"
"metadata:\n"
"  name: multinode-cluster-controlplane-template\n"
"  namespace: default\n"
"spec:\n"
"  clusterName: multinode-cluster\n"
"  metaData:\n"
"    objectNames:\n"
"      - key: name\n"
"        object: machine\n"
"      - key: local-hostname\n"
"        object: machine\n"
"      - key: local_hostname\n"
"        object: machine\n"
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-automated-provision.adoc:246
msgid ""
"The `Metal3DataTemplate`, `networkData` and `Metal3 IPAM` are currently not "
"supported; only the configuration via static secrets is fully supported."
msgstr ""

#. type: Title ===
#: asciidoc/product/atip-automated-provision.adoc:247
#, no-wrap
msgid "Telco features (DPDK, SR-IOV, CPU isolation, huge pages, NUMA, etc.)"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:248
msgid ""
"The directed network provisioning workflow allows to automate the Telco "
"features to be used in the downstream clusters to run Telco workloads on top "
"of those servers."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:250
msgid ""
"The image generated using `EIB` has to include the specific Telco packages "
"following xref:add-telco-feature-eib[this section]."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:251
msgid ""
"The image generated using `EIB`, as described in the xref:eib-edge-image-"
"connected[previous section], has to be located in the management cluster "
"exactly on the path you configured on xref:metal3-media-server[this section]."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:257
msgid "The Telco features covered in this section are the following:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:258
msgid "DPDK and VFs creation"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:259
msgid "SR-IOV and VFs allocation to be used by the workloads"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:260
msgid "CPU isolation and performance tuning"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:261
msgid "Huge pages configuration"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:262
msgid "Kernel parameters tuning"
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-automated-provision.adoc:263
msgid "For more information about the Telco features, see <<atip-features>>."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:264
msgid ""
"The changes required to enable the Telco features shown above are all inside "
"the `RKE2ControlPlane` block in the provision file `capi-provisioning-"
"example.yaml`. The rest of the information inside the file `capi-"
"provisioning-example.yaml` is the same as the information provided in the "
"xref:single-node-provision[provisioning section]."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:265
msgid ""
"To make the process clear, the changes required on that block "
"(`RKE2ControlPlane`) to enable the Telco features are the following:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:266
msgid ""
"The `preRKE2Commands` to be used to execute the commands before the `RKE2` "
"installation process. In this case, use the `modprobe` command to enable the "
"`vfio-pci` and the `SR-IOV` kernel modules."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:267
msgid ""
"The ignition file `/var/lib/rancher/rke2/server/manifests/configmap-sriov-"
"custom-auto.yaml` to be used to define the interfaces, drivers and the "
"number of `VFs` to be created and exposed to the workloads."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:268
msgid ""
"The values inside the config map `sriov-custom-auto-config` are the only "
"values to be replaced with real values."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:269
msgid ""
"`$\\{RESOURCE_NAME1\\}` — The resource name to be used for the first `PF` "
"interface (for example, `sriov-resource-du1`). It is added to the prefix "
"`rancher.io` to be used as a label to be used by the workloads (for example, "
"`rancher.io/sriov-resource-du1`)."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:270
msgid ""
"`$\\{SRIOV-NIC-NAME1\\}` — The name of the first `PF` interface to be used "
"(for example, `eth0`)."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:271
msgid ""
"`$\\{PF_NAME1\\}` — The name of the first physical function `PF` to be used. "
"Generate more complex filters using this (for example, `eth0#2-5`)."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:272
msgid ""
"`$\\{DRIVER_NAME1\\}` — The driver name to be used for the first `VF` "
"interface (for example, `vfio-pci`)."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:273
msgid ""
"`$\\{NUM_VFS1\\}` — The number of `VFs` to be created for the first `PF` "
"interface (for example, `8`)."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:274
msgid ""
"The `/var/sriov-auto-filler.sh` to be used as a translator between the high-"
"level config map `sriov-custom-auto-config` and the `sriovnetworknodepolicy` "
"which contains the low-level hardware information. This script has been "
"created to abstract the user from the complexity to know in advance the "
"hardware information. No changes are required in this file, but it should be "
"present if we need to enable `sr-iov` and create `VFs`."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:275
msgid "The kernel arguments to be used to enable the following features:"
msgstr ""

#. type: Table
#: asciidoc/product/atip-automated-provision.adoc:276
#, no-wrap
msgid ""
"| Parameter | Value | Description\n"
"| isolcpus| 1-30,33-62| Isolate the cores 1-30 and 33-62.\n"
"| skew_tick| 1 | Allows the kernel to skew the timer interrupts across the isolated CPUs.\n"
"| nohz| on | Allows the kernel to run the timer tick on a single CPU when the system is idle.\n"
"| nohz_full| 1-30,33-62 | kernel boot parameter is the current main interface to configure full dynticks along with CPU Isolation.\n"
"| rcu_nocbs| 1-30,33-62 | Allows the kernel to run the RCU callbacks on a single CPU when the system is idle.\n"
"| kthread_cpus| 0,31,32,63 | Allows the kernel to run the kthreads on a single CPU when the system is idle.\n"
"| irqaffinity| 0,31,32,63 | Allows the kernel to run the interrupts on a single CPU when the system is idle.\n"
"| processor.max_cstate| 1 | Prevents the CPU from dropping into a sleep state when idle.\n"
"| intel_idle.max_cstate| 0 | Disables the intel_idle driver and allows acpi_idle to be used.\n"
"| iommu       | pt         | Allows to use vfio for the dpdk interfaces.\n"
"| intel_iommu | on         | Enables the use of vfio for VFs.\n"
"| hugepagesz | 1G    | Allows to set the size of huge pages to 1 G.\n"
"| hugepages | 40    | Number of huge pages defined before.\n"
"| default_hugepagesz| 1G | Default value to enable huge pages.\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:277
msgid "The following systemd services are used to enable the following:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:278
msgid ""
"`rke2-preinstall.service` to replace automatically the `BAREMETALHOST_UUID` "
"and `node-name` during the provisioning process using the Ironic information."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:279
msgid ""
"`cpu-performance.service` to enable the CPU performance tuning. The `$"
"\\{CPU_FREQUENCY\\}` has to be replaced with the real values (for example, "
"`2500000` to set the CPU frequency to `2.5GHz`)."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:280
msgid ""
"`cpu-partitioning.service` to enable the isolation cores of the `CPU` (for "
"example, `1-30,33-62`)."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:281
msgid ""
"`sriov-custom-auto-vfs.service` to install the `sriov` Helm chart, wait "
"until custom resources are created and run the `/var/sriov-auto-filler.sh` "
"to replace the values in the config map `sriov-custom-auto-config` and "
"create the `sriovnetworknodepolicy` to be used by the workloads."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:282
msgid ""
"The `$\\{RKE2_VERSION\\}` is the version of `RKE2` to be used replacing this "
"value (for example, `v1.28.9+rke2r1`)."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:283
#: asciidoc/product/atip-automated-provision.adoc:295
msgid ""
"With all these changes mentioned, the `RKE2ControlPlane` block in the `capi-"
"provisioning-example.yaml` will look like the following:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:284
#, no-wrap
msgid ""
"apiVersion: controlplane.cluster.x-k8s.io/v1alpha1\n"
"kind: RKE2ControlPlane\n"
"metadata:\n"
"  name: single-node-cluster\n"
"  namespace: default\n"
"spec:\n"
"  infrastructureRef:\n"
"    apiVersion: infrastructure.cluster.x-k8s.io/v1beta1\n"
"    kind: Metal3MachineTemplate\n"
"    name: single-node-cluster-controlplane\n"
"  replicas: 1\n"
"  serverConfig:\n"
"    cni: cilium\n"
"    cniMultusEnable: true\n"
"  preRKE2Commands:\n"
"    - modprobe vfio-pci enable_sriov=1 disable_idle_d3=1\n"
"  agentConfig:\n"
"    format: ignition\n"
"    additionalUserData:\n"
"      config: |\n"
"        variant: fcos\n"
"        version: 1.4.0\n"
"        storage:\n"
"          files:\n"
"            - path: /var/lib/rancher/rke2/server/manifests/configmap-sriov-custom-auto.yaml\n"
"              overwrite: true\n"
"              contents:\n"
"                inline: |\n"
"                  apiVersion: v1\n"
"                  kind: ConfigMap\n"
"                  metadata:\n"
"                    name: sriov-custom-auto-config\n"
"                    namespace: kube-system\n"
"                  data:\n"
"                    config.json: |\n"
"                      [\n"
"                         {\n"
"                           \"resourceName\": \"${RESOURCE_NAME1}\",\n"
"                           \"interface\": \"${SRIOV-NIC-NAME1}\",\n"
"                           \"pfname\": \"${PF_NAME1}\",\n"
"                           \"driver\": \"${DRIVER_NAME1}\",\n"
"                           \"numVFsToCreate\": ${NUM_VFS1}\n"
"                         },\n"
"                         {\n"
"                           \"resourceName\": \"${RESOURCE_NAME2}\",\n"
"                           \"interface\": \"${SRIOV-NIC-NAME2}\",\n"
"                           \"pfname\": \"${PF_NAME2}\",\n"
"                           \"driver\": \"${DRIVER_NAME2}\",\n"
"                           \"numVFsToCreate\": ${NUM_VFS2}\n"
"                         }\n"
"                      ]\n"
"              mode: 0644\n"
"              user:\n"
"                name: root\n"
"              group:\n"
"                name: root\n"
"            - path: /var/lib/rancher/rke2/server/manifests/sriov-crd.yaml\n"
"              overwrite: true\n"
"              contents:\n"
"                inline: |\n"
"                  apiVersion: helm.cattle.io/v1\n"
"                  kind: HelmChart\n"
"                  metadata:\n"
"                    name: sriov-crd\n"
"                    namespace: kube-system\n"
"                  spec:\n"
"                    chart: oci://registry.suse.com/edge/sriov-crd-chart\n"
"                    targetNamespace: sriov-network-operator\n"
"                    version: 1.2.2\n"
"                    createNamespace: true\n"
"            - path: /var/lib/rancher/rke2/server/manifests/sriov-network-operator.yaml\n"
"              overwrite: true\n"
"              contents:\n"
"                inline: |\n"
"                  apiVersion: helm.cattle.io/v1\n"
"                  kind: HelmChart\n"
"                  metadata:\n"
"                    name: sriov-network-operator\n"
"                    namespace: kube-system\n"
"                  spec:\n"
"                    chart: oci://registry.suse.com/edge/sriov-network-operator-chart\n"
"                    targetNamespace: sriov-network-operator\n"
"                    version: 1.2.2\n"
"                    createNamespace: true\n"
"            - path: /var/sriov-auto-filler.sh\n"
"              overwrite: true\n"
"              contents:\n"
"                inline: |\n"
"                  #!/bin/bash\n"
"                  cat <<- EOF > /var/sriov-networkpolicy-template.yaml\n"
"                  apiVersion: sriovnetwork.openshift.io/v1\n"
"                  kind: SriovNetworkNodePolicy\n"
"                  metadata:\n"
"                    name: atip-RESOURCENAME\n"
"                    namespace: sriov-network-operator\n"
"                  spec:\n"
"                    nodeSelector:\n"
"                      feature.node.kubernetes.io/network-sriov.capable: \"true\"\n"
"                    resourceName: RESOURCENAME\n"
"                    deviceType: DRIVER\n"
"                    numVfs: NUMVF\n"
"                    mtu: 1500\n"
"                    nicSelector:\n"
"                      pfNames: [\"PFNAMES\"]\n"
"                      deviceID: \"DEVICEID\"\n"
"                      vendor: \"VENDOR\"\n"
"                      rootDevices:\n"
"                        - PCIADDRESS\n"
"                  EOF\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:285
#, no-wrap
msgid ""
"                  export KUBECONFIG=/etc/rancher/rke2/rke2.yaml; export KUBECTL=/var/lib/rancher/rke2/bin/kubectl\n"
"                  while [ $(${KUBECTL} --kubeconfig=${KUBECONFIG} get sriovnetworknodestates.sriovnetwork.openshift.io -n sriov-network-operator -ojson | jq -r '.items[].status.syncStatus') != \"Succeeded\" ]; do sleep 1; done\n"
"                  input=$(${KUBECTL} --kubeconfig=${KUBECONFIG} get cm sriov-custom-auto-config -n kube-system -ojson | jq -r '.data.\"config.json\"')\n"
"                  jq -c '.[]' <<< $input | while read i; do\n"
"                    interface=$(echo $i | jq -r '.interface')\n"
"                    pfname=$(echo $i | jq -r '.pfname')\n"
"                    pciaddress=$(${KUBECTL} --kubeconfig=${KUBECONFIG} get sriovnetworknodestates.sriovnetwork.openshift.io -n sriov-network-operator -ojson | jq -r \".items[].status.interfaces[]|select(.name==\\\"$interface\\\")|.pciAddress\")\n"
"                    vendor=$(${KUBECTL} --kubeconfig=${KUBECONFIG} get sriovnetworknodestates.sriovnetwork.openshift.io -n sriov-network-operator -ojson | jq -r \".items[].status.interfaces[]|select(.name==\\\"$interface\\\")|.vendor\")\n"
"                    deviceid=$(${KUBECTL} --kubeconfig=${KUBECONFIG} get sriovnetworknodestates.sriovnetwork.openshift.io -n sriov-network-operator -ojson | jq -r \".items[].status.interfaces[]|select(.name==\\\"$interface\\\")|.deviceID\")\n"
"                    resourceName=$(echo $i | jq -r '.resourceName')\n"
"                    driver=$(echo $i | jq -r '.driver')\n"
"                    sed -e \"s/RESOURCENAME/$resourceName/g\" \\\n"
"                        -e \"s/DRIVER/$driver/g\" \\\n"
"                        -e \"s/PFNAMES/$pfname/g\" \\\n"
"                        -e \"s/VENDOR/$vendor/g\" \\\n"
"                        -e \"s/DEVICEID/$deviceid/g\" \\\n"
"                        -e \"s/PCIADDRESS/$pciaddress/g\" \\\n"
"                        -e \"s/NUMVF/$(echo $i | jq -r '.numVFsToCreate')/g\" /var/sriov-networkpolicy-template.yaml > /var/lib/rancher/rke2/server/manifests/$resourceName.yaml\n"
"                  done\n"
"              mode: 0755\n"
"              user:\n"
"                name: root\n"
"              group:\n"
"                name: root\n"
"        kernel_arguments:\n"
"          should_exist:\n"
"            - intel_iommu=on\n"
"            - intel_pstate=passive\n"
"            - processor.max_cstate=1\n"
"            - intel_idle.max_cstate=0\n"
"            - iommu=pt\n"
"            - mce=off\n"
"            - hugepagesz=1G hugepages=40\n"
"            - hugepagesz=2M hugepages=0\n"
"            - default_hugepagesz=1G\n"
"            - kthread_cpus=${NON-ISOLATED_CPU_CORES}\n"
"            - irqaffinity=${NON-ISOLATED_CPU_CORES}\n"
"            - isolcpus=${ISOLATED_CPU_CORES}\n"
"            - nohz_full=${ISOLATED_CPU_CORES}\n"
"            - rcu_nocbs=${ISOLATED_CPU_CORES}\n"
"            - rcu_nocb_poll\n"
"            - nosoftlockup\n"
"            - nohz=on\n"
"        systemd:\n"
"          units:\n"
"            - name: rke2-preinstall.service\n"
"              enabled: true\n"
"              contents: |\n"
"                [Unit]\n"
"                Description=rke2-preinstall\n"
"                Wants=network-online.target\n"
"                Before=rke2-install.service\n"
"                ConditionPathExists=!/run/cluster-api/bootstrap-success.complete\n"
"                [Service]\n"
"                Type=oneshot\n"
"                User=root\n"
"                ExecStartPre=/bin/sh -c \"mount -L config-2 /mnt\"\n"
"                ExecStart=/bin/sh -c \"sed -i \\\"s/BAREMETALHOST_UUID/$(jq -r .uuid /mnt/openstack/latest/meta_data.json)/\\\" /etc/rancher/rke2/config.yaml\"\n"
"                ExecStart=/bin/sh -c \"echo \\\"node-name: $(jq -r .name /mnt/openstack/latest/meta_data.json)\\\" >> /etc/rancher/rke2/config.yaml\"\n"
"                ExecStartPost=/bin/sh -c \"umount /mnt\"\n"
"                [Install]\n"
"                WantedBy=multi-user.target\n"
"            - name: cpu-performance.service\n"
"              enabled: true\n"
"              contents: |\n"
"                [Unit]\n"
"                Description=CPU perfomance\n"
"                Wants=network-online.target\n"
"                After=network.target network-online.target\n"
"                [Service]\n"
"                User=root\n"
"                Type=forking\n"
"                TimeoutStartSec=900\n"
"                ExecStart=/bin/sh -c \"cpupower frequency-set -g performance; cpupower frequency-set -u ${CPU_FREQUENCY}; cpupower frequency-set -d ${CPU_FREQUENCY}\"\n"
"                RemainAfterExit=yes\n"
"                KillMode=process\n"
"                [Install]\n"
"                WantedBy=multi-user.target\n"
"            - name: cpu-partitioning.service\n"
"              enabled: true\n"
"              contents: |\n"
"                [Unit]\n"
"                Description=cpu-partitioning\n"
"                Wants=network-online.target\n"
"                After=network.target network-online.target\n"
"                [Service]\n"
"                Type=oneshot\n"
"                User=root\n"
"                ExecStart=/bin/sh -c \"echo isolated_cores=${ISOLATED_CPU_CORES} > /etc/tuned/cpu-partitioning-variables.conf\"\n"
"                ExecStartPost=/bin/sh -c \"tuned-adm profile cpu-partitioning\"\n"
"                ExecStartPost=/bin/sh -c \"systemctl enable tuned.service\"\n"
"                [Install]\n"
"                WantedBy=multi-user.target\n"
"            - name: sriov-custom-auto-vfs.service\n"
"              enabled: true\n"
"              contents: |\n"
"                [Unit]\n"
"                Description=SRIOV Custom Auto VF Creation\n"
"                Wants=network-online.target  rke2-server.target\n"
"                After=network.target network-online.target rke2-server.target\n"
"                [Service]\n"
"                User=root\n"
"                Type=forking\n"
"                TimeoutStartSec=900\n"
"                ExecStart=/bin/sh -c \"while ! /var/lib/rancher/rke2/bin/kubectl --kubeconfig=/etc/rancher/rke2/rke2.yaml wait --for condition=ready nodes --all ; do sleep 2 ; done\"\n"
"                ExecStartPost=/bin/sh -c \"while [ $(/var/lib/rancher/rke2/bin/kubectl --kubeconfig=/etc/rancher/rke2/rke2.yaml get sriovnetworknodestates.sriovnetwork.openshift.io --ignore-not-found --no-headers -A | wc -l) -eq 0 ]; do sleep 1; done\"\n"
"                ExecStartPost=/bin/sh -c \"/var/sriov-auto-filler.sh\"\n"
"                RemainAfterExit=yes\n"
"                KillMode=process\n"
"                [Install]\n"
"                WantedBy=multi-user.target\n"
"    kubelet:\n"
"      extraArgs:\n"
"        - provider-id=metal3://BAREMETALHOST_UUID\n"
"    version: ${RKE2_VERSION}\n"
"    nodeName: \"localhost.localdomain\"\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:286
msgid ""
"Once the file is created by joining the previous blocks, the following "
"command must be executed in the management cluster to start provisioning the "
"new downstream cluster using the Telco features:"
msgstr ""

#. type: Title ===
#: asciidoc/product/atip-automated-provision.adoc:288
#, no-wrap
msgid "Private registry"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:289
msgid ""
"It is possible to configure a private registry as a mirror for images used "
"by workloads."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:290
msgid ""
"To do this we create the secret containing the information about the private "
"registry to be used by the downstream cluster."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:291
#, no-wrap
msgid ""
"apiVersion: v1\n"
"kind: Secret\n"
"metadata:\n"
"  name: private-registry-cert\n"
"  namespace: default\n"
"data:\n"
"  tls.crt: ${TLS_CERTIFICATE}\n"
"  tls.key: ${TLS_KEY}\n"
"  ca.crt: ${CA_CERTIFICATE}\n"
"type: kubernetes.io/tls\n"
"---\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:292
#, no-wrap
msgid ""
"apiVersion: v1\n"
"kind: Secret\n"
"metadata:\n"
"  name: private-registry-auth\n"
"  namespace: default\n"
"data:\n"
"  username: ${REGISTRY_USERNAME}\n"
"  password: ${REGISTRY_PASSWORD}\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:293
msgid ""
"The `tls.crt`, `tls.key` and `ca.crt` are the certificates to be used to "
"authenticate the private registry. The `username` and `password` are the "
"credentials to be used to authenticate the private registry."
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-automated-provision.adoc:294
msgid ""
"The `tls.crt`, `tls.key`, `ca.crt` , `username` and `password` have to be "
"encoded in base64 format before to be used in the secret."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:296
#, no-wrap
msgid ""
"apiVersion: controlplane.cluster.x-k8s.io/v1alpha1\n"
"kind: RKE2ControlPlane\n"
"metadata:\n"
"  name: single-node-cluster\n"
"  namespace: default\n"
"spec:\n"
"  infrastructureRef:\n"
"    apiVersion: infrastructure.cluster.x-k8s.io/v1beta1\n"
"    kind: Metal3MachineTemplate\n"
"    name: single-node-cluster-controlplane\n"
"  replicas: 1\n"
"  privateRegistriesConfig:\n"
"    mirrors:\n"
"      \"registry.example.com\":\n"
"        endpoint:\n"
"          - \"https://registry.example.com:5000\"\n"
"    configs:\n"
"      \"registry.example.com\":\n"
"        authSecret:\n"
"          apiVersion: v1\n"
"          kind: Secret\n"
"          namespace: default\n"
"          name: private-registry-auth\n"
"        tls:\n"
"          tlsConfigSecret:\n"
"            apiVersion: v1\n"
"            kind: Secret\n"
"            namespace: default\n"
"            name: private-registry-cert\n"
"  serverConfig:\n"
"    cni: cilium\n"
"  agentConfig:\n"
"    format: ignition\n"
"    additionalUserData:\n"
"      config: |\n"
"        variant: fcos\n"
"        version: 1.4.0\n"
"        systemd:\n"
"          units:\n"
"            - name: rke2-preinstall.service\n"
"              enabled: true\n"
"              contents: |\n"
"                [Unit]\n"
"                Description=rke2-preinstall\n"
"                Wants=network-online.target\n"
"                Before=rke2-install.service\n"
"                ConditionPathExists=!/run/cluster-api/bootstrap-success.complete\n"
"                [Service]\n"
"                Type=oneshot\n"
"                User=root\n"
"                ExecStartPre=/bin/sh -c \"mount -L config-2 /mnt\"\n"
"                ExecStart=/bin/sh -c \"sed -i \\\"s/BAREMETALHOST_UUID/$(jq -r .uuid /mnt/openstack/latest/meta_data.json)/\\\" /etc/rancher/rke2/config.yaml\"\n"
"                ExecStart=/bin/sh -c \"echo \\\"node-name: $(jq -r .name /mnt/openstack/latest/meta_data.json)\\\" >> /etc/rancher/rke2/config.yaml\"\n"
"                ExecStartPost=/bin/sh -c \"umount /mnt\"\n"
"                [Install]\n"
"                WantedBy=multi-user.target\n"
"    kubelet:\n"
"      extraArgs:\n"
"        - provider-id=metal3://BAREMETALHOST_UUID\n"
"    version: ${RKE2_VERSION}\n"
"    nodeName: \"localhost.localdomain\"\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:297
msgid ""
"Where the `registry.example.com` is the example name of the private registry "
"to be used by the downstream cluster, and it should be replaced with the "
"real values."
msgstr ""

#. type: Title ===
#: asciidoc/product/atip-automated-provision.adoc:298
#, no-wrap
msgid "Downstream cluster provisioning in air-gapped scenarios"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:299
msgid ""
"The directed network provisioning workflow allows to automate the "
"provisioning of downstream clusters in air-gapped scenarios."
msgstr ""

#. type: Title ====
#: asciidoc/product/atip-automated-provision.adoc:300
#, no-wrap
msgid "Requirements for air-gapped scenarios"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:301
msgid ""
"The `raw` image generated using `EIB` must include the specific container "
"images (helm-chart OCI and container images) required to run the downstream "
"cluster in an air-gapped scenario. For more information, refer to xref:eib-"
"edge-image-airgap[this section]."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:302
msgid ""
"In case of using SR-IOV or any other custom workload, the images required to "
"run the workloads must be preloaded in your private registry following the "
"xref:preload-private-registry[preload private registry section]."
msgstr ""

#. type: Title ====
#: asciidoc/product/atip-automated-provision.adoc:303
#, no-wrap
msgid "Enroll the bare metal hosts in air-gap scenarios"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:304
msgid ""
"The process to enroll the bare metal hosts in the management cluster is the "
"same as described in the xref:enroll-bare-metal-host[previous section]."
msgstr ""

#. type: Title ====
#: asciidoc/product/atip-automated-provision.adoc:305
#, no-wrap
msgid "Provision the downstream cluster in air-gap scenarios"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:306
msgid ""
"There are some important changes required to provision the downstream "
"cluster in air-gapped scenarios:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:307
msgid ""
"The `RKE2ControlPlane` block in the `capi-provisioning-example.yaml` file "
"must include the `spec.agentConfig.airGapped: true` directive."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:308
msgid ""
"The private registry configuration must be included in the "
"`RKE2ControlPlane` block in the `capi-provisioning-airgap-example.yaml` file "
"following the xref:atip-private-registry[private registry section]."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:309
msgid ""
"If you are using SR-IOV or any other `AdditionalUserData` configuration "
"(combustion script) which requires the helm-chart installation, you must "
"modify the content to reference the private registry instead of using the "
"public registry."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:310
msgid ""
"The following example shows the SR-IOV configuration in the "
"`AdditionalUserData` block in the `capi-provisioning-airgap-example.yaml` "
"file with the modifications required to reference the private registry"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:311
msgid "Private Registry secrets references"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-automated-provision.adoc:312
msgid ""
"Helm-Chart definition using the private registry instead of the public OCI "
"images."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:313
#, no-wrap
msgid ""
"# secret to include the private registry certificates\n"
"apiVersion: v1\n"
"kind: Secret\n"
"metadata:\n"
"  name: private-registry-cert\n"
"  namespace: default\n"
"data:\n"
"  tls.crt: ${TLS_BASE64_CERT}\n"
"  tls.key: ${TLS_BASE64_KEY}\n"
"  ca.crt: ${CA_BASE64_CERT}\n"
"type: kubernetes.io/tls\n"
"---\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:314
#, no-wrap
msgid ""
"# secret to include the private registry auth credentials\n"
"apiVersion: v1\n"
"kind: Secret\n"
"metadata:\n"
"  name: private-registry-auth\n"
"  namespace: default\n"
"data:\n"
"  username: ${REGISTRY_USERNAME}\n"
"  password: ${REGISTRY_PASSWORD}\n"
"---\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:315
#, no-wrap
msgid ""
"apiVersion: controlplane.cluster.x-k8s.io/v1alpha1\n"
"kind: RKE2ControlPlane\n"
"metadata:\n"
"  name: single-node-cluster\n"
"  namespace: default\n"
"spec:\n"
"  infrastructureRef:\n"
"    apiVersion: infrastructure.cluster.x-k8s.io/v1beta1\n"
"    kind: Metal3MachineTemplate\n"
"    name: single-node-cluster-controlplane\n"
"  replicas: 1\n"
"  privateRegistriesConfig:       # Private registry configuration to add your own mirror and credentials\n"
"    mirrors:\n"
"      docker.io:\n"
"        endpoint:\n"
"          - \"https://$(PRIVATE_REGISTRY_URL)\"\n"
"    configs:\n"
"      \"192.168.100.22:5000\":\n"
"        authSecret:\n"
"          apiVersion: v1\n"
"          kind: Secret\n"
"          namespace: default\n"
"          name: private-registry-auth\n"
"        tls:\n"
"          tlsConfigSecret:\n"
"            apiVersion: v1\n"
"            kind: Secret\n"
"            namespace: default\n"
"            name: private-registry-cert\n"
"          insecureSkipVerify: false\n"
"  serverConfig:\n"
"    cni: cilium\n"
"    cniMultusEnable: true\n"
"  preRKE2Commands:\n"
"    - modprobe vfio-pci enable_sriov=1 disable_idle_d3=1\n"
"  agentConfig:\n"
"    airGapped: true       # Airgap true to enable airgap mode\n"
"    format: ignition\n"
"    additionalUserData:\n"
"      config: |\n"
"        variant: fcos\n"
"        version: 1.4.0\n"
"        storage:\n"
"          files:\n"
"            - path: /var/lib/rancher/rke2/server/manifests/configmap-sriov-custom-auto.yaml\n"
"              overwrite: true\n"
"              contents:\n"
"                inline: |\n"
"                  apiVersion: v1\n"
"                  kind: ConfigMap\n"
"                  metadata:\n"
"                    name: sriov-custom-auto-config\n"
"                    namespace: sriov-network-operator\n"
"                  data:\n"
"                    config.json: |\n"
"                      [\n"
"                         {\n"
"                           \"resourceName\": \"${RESOURCE_NAME1}\",\n"
"                           \"interface\": \"${SRIOV-NIC-NAME1}\",\n"
"                           \"pfname\": \"${PF_NAME1}\",\n"
"                           \"driver\": \"${DRIVER_NAME1}\",\n"
"                           \"numVFsToCreate\": ${NUM_VFS1}\n"
"                         },\n"
"                         {\n"
"                           \"resourceName\": \"${RESOURCE_NAME2}\",\n"
"                           \"interface\": \"${SRIOV-NIC-NAME2}\",\n"
"                           \"pfname\": \"${PF_NAME2}\",\n"
"                           \"driver\": \"${DRIVER_NAME2}\",\n"
"                           \"numVFsToCreate\": ${NUM_VFS2}\n"
"                         }\n"
"                      ]\n"
"              mode: 0644\n"
"              user:\n"
"                name: root\n"
"              group:\n"
"                name: root\n"
"            - path: /var/lib/rancher/rke2/server/manifests/sriov.yaml\n"
"              overwrite: true\n"
"              contents:\n"
"                inline: |\n"
"                  apiVersion: v1\n"
"                  data:\n"
"                    .dockerconfigjson: ${REGISTRY_AUTH_DOCKERCONFIGJSON}\n"
"                  kind: Secret\n"
"                  metadata:\n"
"                    name: privregauth\n"
"                    namespace: kube-system\n"
"                  type: kubernetes.io/dockerconfigjson\n"
"                  ---\n"
"                  apiVersion: v1\n"
"                  kind: ConfigMap\n"
"                  metadata:\n"
"                    namespace: kube-system\n"
"                    name: example-repo-ca\n"
"                  data:\n"
"                    ca.crt: |-\n"
"                      -----BEGIN CERTIFICATE-----\n"
"                      ${CA_BASE64_CERT}\n"
"                      -----END CERTIFICATE-----\n"
"                  ---\n"
"                  apiVersion: helm.cattle.io/v1\n"
"                  kind: HelmChart\n"
"                  metadata:\n"
"                    name: sriov-crd\n"
"                    namespace: kube-system\n"
"                  spec:\n"
"                    chart: oci://${PRIVATE_REGISTRY_URL}/sriov-crd\n"
"                    dockerRegistrySecret:\n"
"                      name: privregauth\n"
"                    repoCAConfigMap:\n"
"                      name: example-repo-ca\n"
"                    createNamespace: true\n"
"                    set:\n"
"                      global.clusterCIDR: 192.168.0.0/18\n"
"                      global.clusterCIDRv4: 192.168.0.0/18\n"
"                      global.clusterDNS: 10.96.0.10\n"
"                      global.clusterDomain: cluster.local\n"
"                      global.rke2DataDir: /var/lib/rancher/rke2\n"
"                      global.serviceCIDR: 10.96.0.0/12\n"
"                    targetNamespace: sriov-network-operator\n"
"                    version: ${SRIOV_CRD_VERSION}\n"
"                  ---\n"
"                  apiVersion: helm.cattle.io/v1\n"
"                  kind: HelmChart\n"
"                  metadata:\n"
"                    name: sriov-network-operator\n"
"                    namespace: kube-system\n"
"                  spec:\n"
"                    chart: oci://${PRIVATE_REGISTRY_URL}/sriov-network-operator\n"
"                    dockerRegistrySecret:\n"
"                      name: privregauth\n"
"                    repoCAConfigMap:\n"
"                      name: example-repo-ca\n"
"                    createNamespace: true\n"
"                    set:\n"
"                      global.clusterCIDR: 192.168.0.0/18\n"
"                      global.clusterCIDRv4: 192.168.0.0/18\n"
"                      global.clusterDNS: 10.96.0.10\n"
"                      global.clusterDomain: cluster.local\n"
"                      global.rke2DataDir: /var/lib/rancher/rke2\n"
"                      global.serviceCIDR: 10.96.0.0/12\n"
"                    targetNamespace: sriov-network-operator\n"
"                    version: ${SRIOV_OPERATOR_VERSION}\n"
"              mode: 0644\n"
"              user:\n"
"                name: root\n"
"              group:\n"
"                name: root\n"
"            - path: /var/sriov-auto-filler.sh\n"
"              overwrite: true\n"
"              contents:\n"
"                inline: |\n"
"                  #!/bin/bash\n"
"                  cat <<- EOF > /var/sriov-networkpolicy-template.yaml\n"
"                  apiVersion: sriovnetwork.openshift.io/v1\n"
"                  kind: SriovNetworkNodePolicy\n"
"                  metadata:\n"
"                    name: atip-RESOURCENAME\n"
"                    namespace: sriov-network-operator\n"
"                  spec:\n"
"                    nodeSelector:\n"
"                      feature.node.kubernetes.io/network-sriov.capable: \"true\"\n"
"                    resourceName: RESOURCENAME\n"
"                    deviceType: DRIVER\n"
"                    numVfs: NUMVF\n"
"                    mtu: 1500\n"
"                    nicSelector:\n"
"                      pfNames: [\"PFNAMES\"]\n"
"                      deviceID: \"DEVICEID\"\n"
"                      vendor: \"VENDOR\"\n"
"                      rootDevices:\n"
"                        - PCIADDRESS\n"
"                  EOF\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-automated-provision.adoc:316
#, no-wrap
msgid ""
"                  export KUBECONFIG=/etc/rancher/rke2/rke2.yaml; export KUBECTL=/var/lib/rancher/rke2/bin/kubectl\n"
"                  while [ $(${KUBECTL} --kubeconfig=${KUBECONFIG} get sriovnetworknodestates.sriovnetwork.openshift.io -n sriov-network-operator -ojson | jq -r '.items[].status.syncStatus') != \"Succeeded\" ]; do sleep 1; done\n"
"                  input=$(${KUBECTL} --kubeconfig=${KUBECONFIG} get cm sriov-custom-auto-config -n sriov-network-operator -ojson | jq -r '.data.\"config.json\"')\n"
"                  jq -c '.[]' <<< $input | while read i; do\n"
"                    interface=$(echo $i | jq -r '.interface')\n"
"                    pfname=$(echo $i | jq -r '.pfname')\n"
"                    pciaddress=$(${KUBECTL} --kubeconfig=${KUBECONFIG} get sriovnetworknodestates.sriovnetwork.openshift.io -n sriov-network-operator -ojson | jq -r \".items[].status.interfaces[]|select(.name==\\\"$interface\\\")|.pciAddress\")\n"
"                    vendor=$(${KUBECTL} --kubeconfig=${KUBECONFIG} get sriovnetworknodestates.sriovnetwork.openshift.io -n sriov-network-operator -ojson | jq -r \".items[].status.interfaces[]|select(.name==\\\"$interface\\\")|.vendor\")\n"
"                    deviceid=$(${KUBECTL} --kubeconfig=${KUBECONFIG} get sriovnetworknodestates.sriovnetwork.openshift.io -n sriov-network-operator -ojson | jq -r \".items[].status.interfaces[]|select(.name==\\\"$interface\\\")|.deviceID\")\n"
"                    resourceName=$(echo $i | jq -r '.resourceName')\n"
"                    driver=$(echo $i | jq -r '.driver')\n"
"                    sed -e \"s/RESOURCENAME/$resourceName/g\" \\\n"
"                        -e \"s/DRIVER/$driver/g\" \\\n"
"                        -e \"s/PFNAMES/$pfname/g\" \\\n"
"                        -e \"s/VENDOR/$vendor/g\" \\\n"
"                        -e \"s/DEVICEID/$deviceid/g\" \\\n"
"                        -e \"s/PCIADDRESS/$pciaddress/g\" \\\n"
"                        -e \"s/NUMVF/$(echo $i | jq -r '.numVFsToCreate')/g\" /var/sriov-networkpolicy-template.yaml > /var/lib/rancher/rke2/server/manifests/$resourceName.yaml\n"
"                  done\n"
"              mode: 0755\n"
"              user:\n"
"                name: root\n"
"              group:\n"
"                name: root\n"
"        kernel_arguments:\n"
"          should_exist:\n"
"            - intel_iommu=on\n"
"            - intel_pstate=passive\n"
"            - processor.max_cstate=1\n"
"            - intel_idle.max_cstate=0\n"
"            - iommu=pt\n"
"            - mce=off\n"
"            - hugepagesz=1G hugepages=40\n"
"            - hugepagesz=2M hugepages=0\n"
"            - default_hugepagesz=1G\n"
"            - kthread_cpus=${NON-ISOLATED_CPU_CORES}\n"
"            - irqaffinity=${NON-ISOLATED_CPU_CORES}\n"
"            - isolcpus=${ISOLATED_CPU_CORES}\n"
"            - nohz_full=${ISOLATED_CPU_CORES}\n"
"            - rcu_nocbs=${ISOLATED_CPU_CORES}\n"
"            - rcu_nocb_poll\n"
"            - nosoftlockup\n"
"            - nohz=on\n"
"        systemd:\n"
"          units:\n"
"            - name: rke2-preinstall.service\n"
"              enabled: true\n"
"              contents: |\n"
"                [Unit]\n"
"                Description=rke2-preinstall\n"
"                Wants=network-online.target\n"
"                Before=rke2-install.service\n"
"                ConditionPathExists=!/run/cluster-api/bootstrap-success.complete\n"
"                [Service]\n"
"                Type=oneshot\n"
"                User=root\n"
"                ExecStartPre=/bin/sh -c \"mount -L config-2 /mnt\"\n"
"                ExecStart=/bin/sh -c \"sed -i \\\"s/BAREMETALHOST_UUID/$(jq -r .uuid /mnt/openstack/latest/meta_data.json)/\\\" /etc/rancher/rke2/config.yaml\"\n"
"                ExecStart=/bin/sh -c \"echo \\\"node-name: $(jq -r .name /mnt/openstack/latest/meta_data.json)\\\" >> /etc/rancher/rke2/config.yaml\"\n"
"                ExecStartPost=/bin/sh -c \"umount /mnt\"\n"
"                [Install]\n"
"                WantedBy=multi-user.target\n"
"            - name: cpu-partitioning.service\n"
"              enabled: true\n"
"              contents: |\n"
"                [Unit]\n"
"                Description=cpu-partitioning\n"
"                Wants=network-online.target\n"
"                After=network.target network-online.target\n"
"                [Service]\n"
"                Type=oneshot\n"
"                User=root\n"
"                ExecStart=/bin/sh -c \"echo isolated_cores=${ISOLATED_CPU_CORES} > /etc/tuned/cpu-partitioning-variables.conf\"\n"
"                ExecStartPost=/bin/sh -c \"tuned-adm profile cpu-partitioning\"\n"
"                ExecStartPost=/bin/sh -c \"systemctl enable tuned.service\"\n"
"                [Install]\n"
"                WantedBy=multi-user.target\n"
"            - name: sriov-custom-auto-vfs.service\n"
"              enabled: true\n"
"              contents: |\n"
"                [Unit]\n"
"                Description=SRIOV Custom Auto VF Creation\n"
"                Wants=network-online.target  rke2-server.target\n"
"                After=network.target network-online.target rke2-server.target\n"
"                [Service]\n"
"                User=root\n"
"                Type=forking\n"
"                TimeoutStartSec=900\n"
"                ExecStart=/bin/sh -c \"while ! /var/lib/rancher/rke2/bin/kubectl --kubeconfig=/etc/rancher/rke2/rke2.yaml wait --for condition=ready nodes --all ; do sleep 2 ; done\"\n"
"                ExecStartPost=/bin/sh -c \"while [ $(/var/lib/rancher/rke2/bin/kubectl --kubeconfig=/etc/rancher/rke2/rke2.yaml get sriovnetworknodestates.sriovnetwork.openshift.io --ignore-not-found --no-headers -A | wc -l) -eq 0 ]; do sleep 1; done\"\n"
"                ExecStartPost=/bin/sh -c \"/var/sriov-auto-filler.sh\"\n"
"                RemainAfterExit=yes\n"
"                KillMode=process\n"
"                [Install]\n"
"                WantedBy=multi-user.target\n"
"    kubelet:\n"
"      extraArgs:\n"
"        - provider-id=metal3://BAREMETALHOST_UUID\n"
"    version: ${RKE2_VERSION}\n"
"    nodeName: \"localhost.localdomain\"\n"
msgstr ""

#. type: Title ==
#: asciidoc/product/atip-features.adoc:1
#, no-wrap
msgid "Telco features configuration"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:2
msgid ""
"This section documents and explains the configuration of Telco-specific "
"features on ATIP-deployed clusters."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:3
msgid ""
"The directed network provisioning deployment method is used, as described in "
"the <<atip-automated-provisioning,ATIP Automated Provision>> section."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:4
msgid "The following topics are covered in this section:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:5
msgid ""
"<<kernel-image-for-real-time,Kernel image for real time>>: Kernel image to "
"be used by the real-time kernel."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:6
msgid ""
"<<cpu-tuned-configuration,CPU tuned configuration>>: Tuned configuration to "
"be used by the real-time kernel."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:7
msgid ""
"<<cni-configuration,CNI configuration>>: CNI configuration to be used by the "
"Kubernetes cluster."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:8
msgid ""
"<<sriov,SR-IOV configuration>>: SR-IOV configuration to be used by the "
"Kubernetes workloads."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:9
msgid ""
"<<dpdk,DPDK configuration>>: DPDK configuration to be used by the system."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:10
msgid ""
"<<acceleration,vRAN acceleration card>>: Acceleration card configuration to "
"be used by the Kubernetes workloads."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:11
msgid ""
"<<huge-pages,Huge pages>>: Huge pages configuration to be used by the "
"Kubernetes workloads."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:12
msgid ""
"<<cpu-pinning-configuration,CPU pinning configuration>>: CPU pinning "
"configuration to be used by the Kubernetes workloads."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:13
msgid ""
"<<numa-aware-scheduling,NUMA-aware scheduling configuration>>: NUMA-aware "
"scheduling configuration to be used by the Kubernetes workloads."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:14
msgid ""
"<<metal-lb-configuration,Metal LB configuration>>: Metal LB configuration to "
"be used by the Kubernetes workloads."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:15
msgid ""
"<<private-registry,Private registry configuration>>: Private registry "
"configuration to be used by the Kubernetes workloads."
msgstr ""

#. type: Title ===
#: asciidoc/product/atip-features.adoc:16
#, no-wrap
msgid "Kernel image for real time"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:17
msgid ""
"The real-time kernel image is not necessarily better than a standard "
"kernel.  It is a different kernel tuned to a specific use case. The real-"
"time kernel is tuned for lower latency at the cost of throughput. The real-"
"time kernel is not recommended for general purpose use, but in our case, "
"this is the recommended kernel for Telco Workloads where latency is a key "
"factor."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:18
msgid "There are four top features:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:19
msgid "Deterministic execution:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:20
msgid ""
"Get greater predictability — ensure critical business processes complete in "
"time, every time and deliver high-quality service, even under heavy system "
"loads. By shielding key system resources for high-priority processes, you "
"can ensure greater predictability for time-sensitive applications."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:21
msgid "Low jitter:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:22
msgid ""
"The low jitter built upon the highly deterministic technology helps to keep "
"applications synchronized with the real world. This helps services that need "
"ongoing and repeated calculation."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:23
msgid "Priority inheritance:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:24
msgid ""
"Priority inheritance refers to the ability of a lower priority process to "
"assume a higher priority when there is a higher priority process that "
"requires the lower priority process to finish before it can accomplish its "
"task. SUSE Linux Enterprise Real Time solves these priority inversion "
"problems for mission-critical processes."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:25
msgid "Thread interrupts:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:26
msgid ""
"Processes running in interrupt mode in a general-purpose operating system "
"are not preemptible. With SUSE Linux Enterprise Real Time, these interrupts "
"have been encapsulated by kernel threads, which are interruptible, and allow "
"the hard and soft interrupts to be preempted by user-defined higher priority "
"processes."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:27
msgid ""
"In our case, if you have installed a real-time image like `SLE Micro RT`, "
"kernel real time is already installed. From the https://scc.suse.com/[SUSE "
"Customer Center], you can download the real-time kernel image."
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-features.adoc:28
msgid ""
"For more information about the real-time kernel, visit https://www.suse.com/"
"products/realtime/[SUSE Real Time]."
msgstr ""

#. type: Title ===
#: asciidoc/product/atip-features.adoc:29
#, no-wrap
msgid "CPU tuned configuration"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:30
msgid ""
"The CPU Tuned configuration allows the possibility to isolate the CPU cores "
"to be used by the real-time kernel. It is important to prevent the OS from "
"using the same cores as the real-time kernel, because the OS could use the "
"cores and increase the latency in the real-time kernel."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:31
msgid ""
"To enable and configure this feature, the first thing is to create a profile "
"for the CPU cores we want to isolate. In this case, we are isolating the "
"cores `1-30` and `33-62`."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:32
#, no-wrap
msgid "$ echo \"export tuned_params\" >> /etc/grub.d/00_tuned\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:33
#, no-wrap
msgid "$ echo \"isolated_cores=1-30,33-62\" >> /etc/tuned/cpu-partitioning-variables.conf\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:34
#, no-wrap
msgid ""
"$ tuned-adm profile cpu-partitioning\n"
"Tuned (re)started, changes applied.\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:35
msgid ""
"Then we need to modify the GRUB option to isolate CPU cores and other "
"important parameters for CPU usage.  The following options are important to "
"be customized with your current hardware specifications:"
msgstr ""

#. type: Table
#: asciidoc/product/atip-features.adoc:36
#, no-wrap
msgid ""
"| parameter | value | description\n"
"\n"
"| isolcpus\n"
"| 1-30,33-62\n"
"| Isolate the cores 1-30 and 33-62\n"
"\n"
"| skew_tick\n"
"| 1\n"
"| This option allows the kernel to skew the timer interrupts across the isolated CPUs.\n"
"\n"
"| nohz\n"
"| on\n"
"| This option allows the kernel to run the timer tick on a single CPU when the system is idle.\n"
"\n"
"| nohz_full\n"
"| 1-30,33-62\n"
"| kernel boot parameter is the current main interface to configure full dynticks along with CPU Isolation.\n"
"\n"
"| rcu_nocbs\n"
"| 1-30,33-62\n"
"| This option allows the kernel to run the RCU callbacks on a single CPU when the system is idle.\n"
"\n"
"| kthread_cpus\n"
"| 0,31,32,63\n"
"| This option allows the kernel to run the kthreads on a single CPU when the system is idle.\n"
"\n"
"| irqaffinity\n"
"| 0,31,32,63\n"
"| This option allows the kernel to run the interrupts on a single CPU when the system is idle.\n"
"\n"
"| processor.max_cstate\n"
"| 1\n"
"| This option prevents the CPU from dropping into a sleep state when idle\n"
"\n"
"| intel_idle.max_cstate\n"
"| 0\n"
"| This option disables the intel_idle driver and allows acpi_idle to be used\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:37
msgid ""
"With the values shown above, we are isolating 60 cores, and we are using "
"four cores for the OS."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:38
msgid ""
"The following commands modify the GRUB configuration and apply the changes "
"mentioned above to be present on the next boot:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:39
msgid ""
"Edit the `/etc/default/grub` file and add the parameters mentioned above:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:40
#: asciidoc/product/atip-features.adoc:141
#: asciidoc/product/atip-features.adoc:162
#: asciidoc/product/atip-features.adoc:189
#, no-wrap
msgid "GRUB_CMDLINE_LINUX=\"intel_iommu=on intel_pstate=passive processor.max_cstate=1 intel_idle.max_cstate=0 iommu=pt usbcore.autosuspend=-1 selinux=0 enforcing=0 nmi_watchdog=0 crashkernel=auto softlockup_panic=0 audit=0 mce=off hugepagesz=1G hugepages=40 hugepagesz=2M hugepages=0 default_hugepagesz=1G kthread_cpus=0,31,32,63 irqaffinity=0,31,32,63 isolcpus=1-30,33-62 skew_tick=1 nohz_full=1-30,33-62 rcu_nocbs=1-30,33-62 rcu_nocb_poll\"\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:41
msgid "Update the GRUB configuration:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:42
#: asciidoc/product/atip-features.adoc:143
#: asciidoc/product/atip-features.adoc:164
#: asciidoc/product/atip-features.adoc:191
#, no-wrap
msgid ""
"$ transactional-update grub.cfg\n"
"$ reboot\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:43
msgid ""
"To validate that the parameters are applied after the reboot, the following "
"command can be used to check the kernel command line:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:44
#: asciidoc/product/atip-features.adoc:166
#: asciidoc/product/atip-features.adoc:193
#, no-wrap
msgid "$ cat /proc/cmdline\n"
msgstr ""

#. type: Title ===
#: asciidoc/product/atip-features.adoc:45
#, no-wrap
msgid "CNI Configuration"
msgstr ""

#. type: Title ====
#: asciidoc/product/atip-features.adoc:46
#, no-wrap
msgid "Cilium"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:47
msgid ""
"`Cilium` is the default CNI plug-in for ATIP.  To enable Cilium on RKE2 "
"cluster as the default plug-in, the following configurations are required in "
"the `/etc/rancher/rke2/config.yaml` file:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:48
#, no-wrap
msgid ""
"cni:\n"
"- cilium\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:49
msgid ""
"This can also be specified with command-line arguments, that is, `--"
"cni=cilium` into the server line in `/etc/systemd/system/rke2-server` file."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:50
msgid ""
"To use the `SR-IOV` network operator described in the xref:option2-sriov-"
"helm[next section], use `Multus` with another CNI plug-in, like `Cilium` or "
"`Calico`, as a secondary plug-in."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:51
#: asciidoc/product/atip-management-cluster.adoc:147
#, no-wrap
msgid ""
"cni:\n"
"- multus\n"
"- cilium\n"
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-features.adoc:52
msgid ""
"For more information about CNI plug-ins, visit https://docs.rke2.io/install/"
"network_options[Network Options]."
msgstr ""

#. type: Title ===
#: asciidoc/product/atip-features.adoc:53
#, no-wrap
msgid "SR-IOV"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:54
msgid ""
"SR-IOV allows a device, such as a network adapter, to separate access to its "
"resources among various `PCIe` hardware functions.  There are different ways "
"to deploy `SR-IOV`, and here, we show two different options:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:55
msgid ""
"Option 1: using the `SR-IOV` CNI device plug-ins and a config map to "
"configure it properly."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:56
msgid ""
"Option 2 (recommended): using the `SR-IOV` Helm chart from Rancher Prime to "
"make this deployment easy."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:57
msgid ""
"*Option 1 - Installation of SR-IOV CNI device plug-ins and a config map to "
"configure it properly*"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:58
msgid "Prepare the config map for the device plug-in"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:59
msgid "Get the information to fill the config map from the `lspci` command:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:60
#: asciidoc/product/atip-features.adoc:170
#, no-wrap
msgid ""
"$ lspci | grep -i acc\n"
"8a:00.0 Processing accelerators: Intel Corporation Device 0d5c\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:61
#, no-wrap
msgid ""
"$ lspci | grep -i net\n"
"19:00.0 Ethernet controller: Broadcom Inc. and subsidiaries BCM57504 NetXtreme-E 10Gb/25Gb/40Gb/50Gb/100Gb/200Gb Ethernet (rev 11)\n"
"19:00.1 Ethernet controller: Broadcom Inc. and subsidiaries BCM57504 NetXtreme-E 10Gb/25Gb/40Gb/50Gb/100Gb/200Gb Ethernet (rev 11)\n"
"19:00.2 Ethernet controller: Broadcom Inc. and subsidiaries BCM57504 NetXtreme-E 10Gb/25Gb/40Gb/50Gb/100Gb/200Gb Ethernet (rev 11)\n"
"19:00.3 Ethernet controller: Broadcom Inc. and subsidiaries BCM57504 NetXtreme-E 10Gb/25Gb/40Gb/50Gb/100Gb/200Gb Ethernet (rev 11)\n"
"51:00.0 Ethernet controller: Intel Corporation Ethernet Controller E810-C for QSFP (rev 02)\n"
"51:00.1 Ethernet controller: Intel Corporation Ethernet Controller E810-C for QSFP (rev 02)\n"
"51:01.0 Ethernet controller: Intel Corporation Ethernet Adaptive Virtual Function (rev 02)\n"
"51:01.1 Ethernet controller: Intel Corporation Ethernet Adaptive Virtual Function (rev 02)\n"
"51:01.2 Ethernet controller: Intel Corporation Ethernet Adaptive Virtual Function (rev 02)\n"
"51:01.3 Ethernet controller: Intel Corporation Ethernet Adaptive Virtual Function (rev 02)\n"
"51:11.0 Ethernet controller: Intel Corporation Ethernet Adaptive Virtual Function (rev 02)\n"
"51:11.1 Ethernet controller: Intel Corporation Ethernet Adaptive Virtual Function (rev 02)\n"
"51:11.2 Ethernet controller: Intel Corporation Ethernet Adaptive Virtual Function (rev 02)\n"
"51:11.3 Ethernet controller: Intel Corporation Ethernet Adaptive Virtual Function (rev 02)\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:62
msgid ""
"The config map consists of a `JSON` file that describes devices using "
"filters to discover, and creates groups for the interfaces.  The key is "
"understanding filters and groups. The filters are used to discover the "
"devices and the groups are used to create the interfaces."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:63
msgid "It could be possible to set filters:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:64
msgid "vendorID: `8086` (Intel)"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:65
msgid "deviceID: `0d5c` (Accelerator card)"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:66
msgid "driver: `vfio-pci` (driver)"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:67
msgid "pfNames: `p2p1` (physical interface name)"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:68
msgid ""
"It could be possible to also set filters to match more complex interface "
"syntax, for example:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:69
msgid ""
"pfNames: `[\"eth1#1,2,3,4,5,6\"]` or `[eth1#1-6]` (physical interface name)"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:70
msgid ""
"Related to the groups, we could create a group for the `FEC` card and "
"another group for the `Intel` card, even creating a prefix depending on our "
"use case:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:71
msgid "resourceName: `pci_sriov_net_bh_dpdk`"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:72
msgid "resourcePrefix: `Rancher.io`"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:73
msgid ""
"There are a lot of combinations to discover and create the resource group to "
"allocate some `VFs` to the pods."
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-features.adoc:74
msgid ""
"For more information about the filters and groups, visit https://github.com/"
"k8snetworkplumbingwg/sriov-network-device-plugin[sr-iov network device plug-"
"in]."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:75
msgid ""
"After setting the filters and groups to match the interfaces depending on "
"the hardware and the use case, the following config map shows an example to "
"be used:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:76
#, no-wrap
msgid ""
"apiVersion: v1\n"
"kind: ConfigMap\n"
"metadata:\n"
"  name: sriovdp-config\n"
"  namespace: kube-system\n"
"data:\n"
"  config.json: |\n"
"    {\n"
"        \"resourceList\": [\n"
"            {\n"
"                \"resourceName\": \"intel_fec_5g\",\n"
"                \"devicetype\": \"accelerator\",\n"
"                \"selectors\": {\n"
"                    \"vendors\": [\"8086\"],\n"
"                    \"devices\": [\"0d5d\"]\n"
"                }\n"
"            },\n"
"            {\n"
"                \"resourceName\": \"intel_sriov_odu\",\n"
"                \"selectors\": {\n"
"                    \"vendors\": [\"8086\"],\n"
"                    \"devices\": [\"1889\"],\n"
"                    \"drivers\": [\"vfio-pci\"],\n"
"                    \"pfNames\": [\"p2p1\"]\n"
"                }\n"
"            },\n"
"            {\n"
"                \"resourceName\": \"intel_sriov_oru\",\n"
"                \"selectors\": {\n"
"                    \"vendors\": [\"8086\"],\n"
"                    \"devices\": [\"1889\"],\n"
"                    \"drivers\": [\"vfio-pci\"],\n"
"                    \"pfNames\": [\"p2p2\"]\n"
"                }\n"
"            }\n"
"        ]\n"
"    }\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:77
msgid "Prepare the `daemonset` file to deploy the device plug-in."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:78
msgid ""
"The device plug-in supports several architectures (`arm`, `amd`, `ppc64le`), "
"so the same file can be used for different architectures deploying several "
"`daemonset` for each architecture."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:79
#, no-wrap
msgid ""
"apiVersion: v1\n"
"kind: ServiceAccount\n"
"metadata:\n"
"  name: sriov-device-plugin\n"
"  namespace: kube-system\n"
"---\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:80
#, no-wrap
msgid ""
"apiVersion: apps/v1\n"
"kind: DaemonSet\n"
"metadata:\n"
"  name: kube-sriov-device-plugin-amd64\n"
"  namespace: kube-system\n"
"  labels:\n"
"    tier: node\n"
"    app: sriovdp\n"
"spec:\n"
"  selector:\n"
"    matchLabels:\n"
"      name: sriov-device-plugin\n"
"  template:\n"
"    metadata:\n"
"      labels:\n"
"        name: sriov-device-plugin\n"
"        tier: node\n"
"        app: sriovdp\n"
"    spec:\n"
"      hostNetwork: true\n"
"      nodeSelector:\n"
"        kubernetes.io/arch: amd64\n"
"      tolerations:\n"
"      - key: node-role.kubernetes.io/master\n"
"        operator: Exists\n"
"        effect: NoSchedule\n"
"      serviceAccountName: sriov-device-plugin\n"
"      containers:\n"
"      - name: kube-sriovdp\n"
"        image: rancher/hardened-sriov-network-device-plugin:v3.5.1-build20231009-amd64\n"
"        imagePullPolicy: IfNotPresent\n"
"        args:\n"
"        - --log-dir=sriovdp\n"
"        - --log-level=10\n"
"        securityContext:\n"
"          privileged: true\n"
"        resources:\n"
"          requests:\n"
"            cpu: \"250m\"\n"
"            memory: \"40Mi\"\n"
"          limits:\n"
"            cpu: 1\n"
"            memory: \"200Mi\"\n"
"        volumeMounts:\n"
"        - name: devicesock\n"
"          mountPath: /var/lib/kubelet/\n"
"          readOnly: false\n"
"        - name: log\n"
"          mountPath: /var/log\n"
"        - name: config-volume\n"
"          mountPath: /etc/pcidp\n"
"        - name: device-info\n"
"          mountPath: /var/run/k8s.cni.cncf.io/devinfo/dp\n"
"      volumes:\n"
"        - name: devicesock\n"
"          hostPath:\n"
"            path: /var/lib/kubelet/\n"
"        - name: log\n"
"          hostPath:\n"
"            path: /var/log\n"
"        - name: device-info\n"
"          hostPath:\n"
"            path: /var/run/k8s.cni.cncf.io/devinfo/dp\n"
"            type: DirectoryOrCreate\n"
"        - name: config-volume\n"
"          configMap:\n"
"            name: sriovdp-config\n"
"            items:\n"
"            - key: config.json\n"
"              path: config.json\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:81
msgid ""
"After applying the config map and the `daemonset`, the device plug-in will "
"be deployed and the interfaces will be discovered and available for the pods."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:82
#, no-wrap
msgid ""
"$ kubectl get pods -n kube-system | grep sriov\n"
"kube-system  kube-sriov-device-plugin-amd64-twjfl  1/1  Running  0  2m\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:83
msgid ""
"Check the interfaces discovered and available in the nodes to be used by the "
"pods:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:84
#, no-wrap
msgid ""
"$ kubectl get $(kubectl get nodes -oname) -o jsonpath='{.status.allocatable}' | jq\n"
"{\n"
"  \"cpu\": \"64\",\n"
"  \"ephemeral-storage\": \"256196109726\",\n"
"  \"hugepages-1Gi\": \"40Gi\",\n"
"  \"hugepages-2Mi\": \"0\",\n"
"  \"intel.com/intel_fec_5g\": \"1\",\n"
"  \"intel.com/intel_sriov_odu\": \"4\",\n"
"  \"intel.com/intel_sriov_oru\": \"4\",\n"
"  \"memory\": \"221396384Ki\",\n"
"  \"pods\": \"110\"\n"
"}\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:85
msgid "The `FEC` is `intel.com/intel_fec_5g` and the value is 1."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:86
msgid ""
"The `VF` is `intel.com/intel_sriov_odu` or `intel.com/intel_sriov_oru` if "
"you deploy it with a device plug-in and the config map without Helm charts."
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-features.adoc:87
msgid ""
"If there are no interfaces here, it makes little sense to continue because "
"the interface will not be available for pods. Review the config map and "
"filters to solve the issue first."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:88
msgid ""
"*Option 2 (recommended) - Installation using Rancher using Helm chart for SR-"
"IOV CNI and device plug-ins*"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:89
msgid "Get Helm if not present:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:90
#, no-wrap
msgid "$ curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:91
msgid "Install SR-IOV."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:92
msgid ""
"This part could be done in two ways, using the `CLI` or using the `Rancher "
"UI`."
msgstr ""

#. type: Labeled list
#: asciidoc/product/atip-features.adoc:93
#, no-wrap
msgid "Install Operator from CLI"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:94
#, no-wrap
msgid ""
"helm repo add suse-edge https://suse-edge.github.io/charts\n"
"helm install sriov-crd suse-edge/sriov-crd -n sriov-network-operator\n"
"helm install install sriov-network-operator suse-edge/sriov-network-operator -n sriov-network-operator\n"
msgstr ""

#. type: Labeled list
#: asciidoc/product/atip-features.adoc:95
#, no-wrap
msgid "Install Operator from Rancher UI"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:96
msgid ""
"Once your cluster is installed, and you have access to the `Rancher UI`, you "
"can install the `SR-IOV Operator` from the `Rancher UI` from the apps tab:"
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-features.adoc:97
msgid ""
"Make sure you select the right namespace to install the operator, for "
"example, `sriov-network-operator`."
msgstr ""

#. type: Positional ($1) AttributeList argument for macro 'image'
#: asciidoc/product/atip-features.adoc:98
#, no-wrap
msgid "sriov.png"
msgstr ""

#. type: Target for macro image
#: asciidoc/product/atip-features.adoc:99
#, no-wrap
msgid "features_sriov.png"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:100
msgid "Check the deployed resources crd and pods:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:101
#, no-wrap
msgid ""
"$ kubectl get crd\n"
"$ kubectl -n sriov-network-operator get pods\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:102
msgid "Check the label in the nodes."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:103
msgid ""
"With all resources running, the label appears automatically in your node:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:104
#, no-wrap
msgid "$ kubectl get nodes -oyaml | grep feature.node.kubernetes.io/network-sriov.capable\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:105
#, no-wrap
msgid "feature.node.kubernetes.io/network-sriov.capable: \"true\"\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:106
msgid ""
"Review the `daemonset` to see the new `sriov-network-config-daemon` and "
"`sriov-rancher-nfd-worker` as active and ready:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:107
#, no-wrap
msgid ""
"$ kubectl get daemonset -A\n"
"NAMESPACE             NAME                            DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR                                           AGE\n"
"calico-system            calico-node                     1         1         1       1            1           kubernetes.io/os=linux                                  15h\n"
"sriov-network-operator   sriov-network-config-daemon     1         1         1       1            1           feature.node.kubernetes.io/network-sriov.capable=true   45m\n"
"sriov-network-operator   sriov-rancher-nfd-worker        1         1         1       1            1           <none>                                                  45m\n"
"kube-system              rke2-ingress-nginx-controller   1         1         1       1            1           kubernetes.io/os=linux                                  15h\n"
"kube-system              rke2-multus-ds                  1         1         1       1            1           kubernetes.io/arch=amd64,kubernetes.io/os=linux         15h\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:108
msgid ""
"In a few minutes (can take up to 10 min to be updated), the nodes are "
"detected and configured with the `SR-IOV` capabilities:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:109
#, no-wrap
msgid ""
"$ kubectl get sriovnetworknodestates.sriovnetwork.openshift.io -A\n"
"NAMESPACE             NAME     AGE\n"
"sriov-network-operator   xr11-2   83s\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:110
msgid "Check the interfaces detected."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:111
msgid ""
"The interfaces discovered should be the PCI address of the network device. "
"Check this information with the `lspci` command in the host."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:112
#, no-wrap
msgid ""
"$ kubectl get sriovnetworknodestates.sriovnetwork.openshift.io -n kube-system -oyaml\n"
"apiVersion: v1\n"
"items:\n"
"- apiVersion: sriovnetwork.openshift.io/v1\n"
"  kind: SriovNetworkNodeState\n"
"  metadata:\n"
"    creationTimestamp: \"2023-06-07T09:52:37Z\"\n"
"    generation: 1\n"
"    name: xr11-2\n"
"    namespace: sriov-network-operator\n"
"    ownerReferences:\n"
"    - apiVersion: sriovnetwork.openshift.io/v1\n"
"      blockOwnerDeletion: true\n"
"      controller: true\n"
"      kind: SriovNetworkNodePolicy\n"
"      name: default\n"
"      uid: 80b72499-e26b-4072-a75c-f9a6218ec357\n"
"    resourceVersion: \"356603\"\n"
"    uid: e1f1654b-92b3-44d9-9f87-2571792cc1ad\n"
"  spec:\n"
"    dpConfigVersion: \"356507\"\n"
"  status:\n"
"    interfaces:\n"
"    - deviceID: \"1592\"\n"
"      driver: ice\n"
"      eSwitchMode: legacy\n"
"      linkType: ETH\n"
"      mac: 40:a6:b7:9b:35:f0\n"
"      mtu: 1500\n"
"      name: p2p1\n"
"      pciAddress: \"0000:51:00.0\"\n"
"      totalvfs: 128\n"
"      vendor: \"8086\"\n"
"    - deviceID: \"1592\"\n"
"      driver: ice\n"
"      eSwitchMode: legacy\n"
"      linkType: ETH\n"
"      mac: 40:a6:b7:9b:35:f1\n"
"      mtu: 1500\n"
"      name: p2p2\n"
"      pciAddress: \"0000:51:00.1\"\n"
"      totalvfs: 128\n"
"      vendor: \"8086\"\n"
"    syncStatus: Succeeded\n"
"kind: List\n"
"metadata:\n"
"  resourceVersion: \"\"\n"
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-features.adoc:113
msgid ""
"If your interface is not detected here, ensure that it is present in the "
"next config map:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:114
#, no-wrap
msgid "$ kubectl get cm supported-nic-ids -oyaml -n sriov-network-operator\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:115
msgid ""
"If your device is not there, edit the config map, adding the right values to "
"be discovered (should be necessary to restart the `sriov-network-config-"
"daemon` daemonset)."
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-features.adoc:116
msgid "Create the `NetworkNode Policy` to configure the `VFs`."
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-features.adoc:117
msgid ""
"Some `VFs` (`numVfs`) from the device (`rootDevices`) will be created, and "
"it will be configured with the driver `deviceType` and the `MTU`:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:118
msgid ""
"The `resourceName` field must not contain any special characters and must be "
"unique across the cluster.  The example uses the `deviceType: vfio-pci` "
"because `dpdk` will be used in combination with `sr-iov`. If you don't use "
"`dpdk`, the deviceType should be `deviceType: netdevice` (default value)."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:119
#, no-wrap
msgid ""
"apiVersion: sriovnetwork.openshift.io/v1\n"
"kind: SriovNetworkNodePolicy\n"
"metadata:\n"
"  name: policy-dpdk\n"
"  namespace: sriov-network-operator\n"
"spec:\n"
"  nodeSelector:\n"
"    feature.node.kubernetes.io/network-sriov.capable: \"true\"\n"
"  resourceName: intelnicsDpdk\n"
"  deviceType: vfio-pci\n"
"  numVfs: 8\n"
"  mtu: 1500\n"
"  nicSelector:\n"
"    deviceID: \"1592\"\n"
"    vendor: \"8086\"\n"
"    rootDevices:\n"
"    - 0000:51:00.0\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:120
msgid "Validate configurations:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:121
#, no-wrap
msgid ""
"$ kubectl get $(kubectl get nodes -oname) -o jsonpath='{.status.allocatable}' | jq\n"
"{\n"
"  \"cpu\": \"64\",\n"
"  \"ephemeral-storage\": \"256196109726\",\n"
"  \"hugepages-1Gi\": \"60Gi\",\n"
"  \"hugepages-2Mi\": \"0\",\n"
"  \"intel.com/intel_fec_5g\": \"1\",\n"
"  \"memory\": \"200424836Ki\",\n"
"  \"pods\": \"110\",\n"
"  \"rancher.io/intelnicsDpdk\": \"8\"\n"
"}\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:122
msgid ""
"Create the sr-iov network (optional, just in case a different network is "
"needed):"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:123
#, no-wrap
msgid ""
"apiVersion: sriovnetwork.openshift.io/v1\n"
"kind: SriovNetwork\n"
"metadata:\n"
"  name: network-dpdk\n"
"  namespace: sriov-network-operator\n"
"spec:\n"
"  ipam: |\n"
"    {\n"
"      \"type\": \"host-local\",\n"
"      \"subnet\": \"192.168.0.0/24\",\n"
"      \"rangeStart\": \"192.168.0.20\",\n"
"      \"rangeEnd\": \"192.168.0.60\",\n"
"      \"routes\": [{\n"
"        \"dst\": \"0.0.0.0/0\"\n"
"      }],\n"
"      \"gateway\": \"192.168.0.1\"\n"
"    }\n"
"  vlan: 500\n"
"  resourceName: intelnicsDpdk\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:124
msgid "Check the network created:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:125
#, no-wrap
msgid "$ kubectl get network-attachment-definitions.k8s.cni.cncf.io -A -oyaml\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:126
#, no-wrap
msgid ""
"apiVersion: v1\n"
"items:\n"
"- apiVersion: k8s.cni.cncf.io/v1\n"
"  kind: NetworkAttachmentDefinition\n"
"  metadata:\n"
"    annotations:\n"
"      k8s.v1.cni.cncf.io/resourceName: rancher.io/intelnicsDpdk\n"
"    creationTimestamp: \"2023-06-08T11:22:27Z\"\n"
"    generation: 1\n"
"    name: network-dpdk\n"
"    namespace: sriov-network-operator\n"
"    resourceVersion: \"13124\"\n"
"    uid: df7c89f5-177c-4f30-ae72-7aef3294fb15\n"
"  spec:\n"
"    config: '{ \"cniVersion\":\"0.3.1\", \"name\":\"network-dpdk\",\"type\":\"sriov\",\"vlan\":500,\"vlanQoS\":0,\"ipam\":{\"type\":\"host-local\",\"subnet\":\"192.168.0.0/24\",\"rangeStart\":\"192.168.0.10\",\"rangeEnd\":\"192.168.0.60\",\"routes\":[{\"dst\":\"0.0.0.0/0\"}],\"gateway\":\"192.168.0.1\"}\n"
"      }'\n"
"kind: List\n"
"metadata:\n"
"  resourceVersion: \"\"\n"
msgstr ""

#. type: Title ===
#: asciidoc/product/atip-features.adoc:127
#, no-wrap
msgid "DPDK"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:128
msgid ""
"`DPDK` (Data Plane Development Kit) is a set of libraries and drivers for "
"fast packet processing. It is used to accelerate packet processing workloads "
"running on a wide variety of CPU architectures.  The DPDK includes data "
"plane libraries and optimized network interface controller (`NIC`) drivers "
"for the following:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:129
msgid "A queue manager implements lockless queues."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:130
msgid "A buffer manager pre-allocates fixed size buffers."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:131
msgid ""
"A memory manager allocates pools of objects in memory and uses a ring to "
"store free objects; ensures that objects are spread equally on all `DRAM` "
"channels."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:132
msgid ""
"Poll mode drivers (`PMD`) are designed to work without asynchronous "
"notifications, reducing overhead."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:133
msgid ""
"A packet framework as a set of libraries that are helpers to develop packet "
"processing."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:134
msgid ""
"The following steps will show how to enable `DPDK` and how to create `VFs` "
"from the `NICs` to be used by the `DPDK` interfaces:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:135
msgid "Install the `DPDK` package:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:136
#, no-wrap
msgid ""
"$ transactional-update pkg install dpdk22 dpdk22-tools libdpdk-23\n"
"$ reboot\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:137
msgid "Kernel parameters:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:138
msgid ""
"To use DPDK, employ some drivers to enable certain parameters in the kernel:"
msgstr ""

#. type: Table
#: asciidoc/product/atip-features.adoc:139
#, no-wrap
msgid ""
"| parameter | value | description\n"
"\n"
"| iommu\n"
"| pt\n"
"| This option enables the use  of the `vfio` driver for the DPDK interfaces.\n"
"\n"
"| intel_iommu\n"
"| on\n"
"| This option enables the use of `vfio` for `VFs`.\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:140
msgid "To enable the parameters, add them to the `/etc/default/grub` file:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:142
#: asciidoc/product/atip-features.adoc:163
#: asciidoc/product/atip-features.adoc:190
msgid ""
"Update the GRUB configuration and reboot the system to apply the changes:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:144
msgid "Load `vfio-pci` kernel module and enable `SR-IOV` on the `NICs`:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:145
#: asciidoc/product/atip-features.adoc:168
#, no-wrap
msgid "$ modprobe vfio-pci enable_sriov=1 disable_idle_d3=1\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:146
msgid "Create some virtual functions (`VFs`) from the `NICs`."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:147
msgid ""
"To create for `VFs`, for example, for two different `NICs`, the following "
"commands are required:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:148
#, no-wrap
msgid ""
"$ echo 4 > /sys/bus/pci/devices/0000:51:00.0/sriov_numvfs\n"
"$ echo 4 > /sys/bus/pci/devices/0000:51:00.1/sriov_numvfs\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:149
msgid "Bind the new VFs with the `vfio-pci` driver:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:150
#, no-wrap
msgid ""
"$ dpdk-devbind.py -b vfio-pci 0000:51:01.0 0000:51:01.1 0000:51:01.2 0000:51:01.3 \\\n"
"                              0000:51:11.0 0000:51:11.1 0000:51:11.2 0000:51:11.3\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:151
msgid "Review the configuration is correctly applied:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:152
#, no-wrap
msgid "$ dpdk-devbind.py -s\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:153
#, no-wrap
msgid ""
"Network devices using DPDK-compatible driver\n"
"============================================\n"
"0000:51:01.0 'Ethernet Adaptive Virtual Function 1889' drv=vfio-pci unused=iavf,igb_uio\n"
"0000:51:01.1 'Ethernet Adaptive Virtual Function 1889' drv=vfio-pci unused=iavf,igb_uio\n"
"0000:51:01.2 'Ethernet Adaptive Virtual Function 1889' drv=vfio-pci unused=iavf,igb_uio\n"
"0000:51:01.3 'Ethernet Adaptive Virtual Function 1889' drv=vfio-pci unused=iavf,igb_uio\n"
"0000:51:01.0 'Ethernet Adaptive Virtual Function 1889' drv=vfio-pci unused=iavf,igb_uio\n"
"0000:51:11.1 'Ethernet Adaptive Virtual Function 1889' drv=vfio-pci unused=iavf,igb_uio\n"
"0000:51:21.2 'Ethernet Adaptive Virtual Function 1889' drv=vfio-pci unused=iavf,igb_uio\n"
"0000:51:31.3 'Ethernet Adaptive Virtual Function 1889' drv=vfio-pci unused=iavf,igb_uio\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:154
#, no-wrap
msgid ""
"Network devices using kernel driver\n"
"===================================\n"
"0000:19:00.0 'BCM57504 NetXtreme-E 10Gb/25Gb/40Gb/50Gb/100Gb/200Gb Ethernet 1751' if=em1 drv=bnxt_en unused=igb_uio,vfio-pci *Active*\n"
"0000:19:00.1 'BCM57504 NetXtreme-E 10Gb/25Gb/40Gb/50Gb/100Gb/200Gb Ethernet 1751' if=em2 drv=bnxt_en unused=igb_uio,vfio-pci\n"
"0000:19:00.2 'BCM57504 NetXtreme-E 10Gb/25Gb/40Gb/50Gb/100Gb/200Gb Ethernet 1751' if=em3 drv=bnxt_en unused=igb_uio,vfio-pci\n"
"0000:19:00.3 'BCM57504 NetXtreme-E 10Gb/25Gb/40Gb/50Gb/100Gb/200Gb Ethernet 1751' if=em4 drv=bnxt_en unused=igb_uio,vfio-pci\n"
"0000:51:00.0 'Ethernet Controller E810-C for QSFP 1592' if=eth13 drv=ice unused=igb_uio,vfio-pci\n"
"0000:51:00.1 'Ethernet Controller E810-C for QSFP 1592' if=rename8 drv=ice unused=igb_uio,vfio-pci\n"
msgstr ""

#. type: Title ===
#: asciidoc/product/atip-features.adoc:155
#, no-wrap
msgid "vRAN acceleration (`Intel ACC100/ACC200`)"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:156
msgid ""
"As communications service providers move from 4 G to 5 G networks, many are "
"adopting virtualized radio access network (`vRAN`) architectures for higher "
"channel capacity and easier deployment of edge-based services and "
"applications. vRAN solutions are ideally located to deliver low-latency "
"services with the flexibility to increase or decrease capacity based on the "
"volume of real-time traffic and demand on the network."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:157
msgid ""
"One of the most compute-intensive 4 G and 5 G workloads is RAN layer 1 "
"(`L1`) `FEC`, which resolves data transmission errors over unreliable or "
"noisy communication channels. `FEC` technology detects and corrects a "
"limited number of errors in 4 G or 5 G data, eliminating the need for "
"retransmission. Since the `FEC` acceleration transaction does not contain "
"cell state information, it can be easily virtualized, enabling pooling "
"benefits and easy cell migration."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:158
#: asciidoc/product/atip-features.adoc:185
msgid "Kernel parameters"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:159
msgid ""
"To enable the `vRAN` acceleration, we need to enable the following kernel "
"parameters (if not present yet):"
msgstr ""

#. type: Table
#: asciidoc/product/atip-features.adoc:160
#, no-wrap
msgid ""
"| parameter | value | description\n"
"\n"
"| iommu\n"
"| pt\n"
"| This option enables the use of vfio for the DPDK interfaces.\n"
"\n"
"| intel_iommu\n"
"| on\n"
"| This option enables the use of vfio for VFs.\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:161
#: asciidoc/product/atip-features.adoc:188
msgid ""
"Modify the GRUB file `/etc/default/grub` to add them to the kernel command "
"line:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:165
msgid ""
"To verify that the parameters are applied after the reboot, check the "
"command line:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:167
msgid "Load vfio-pci kernel modules to enable the `vRAN` acceleration:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:169
msgid "Get interface information Acc100:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:171
msgid "Bind the physical interface (`PF`) with `vfio-pci` driver:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:172
#, no-wrap
msgid "$ dpdk-devbind.py -b vfio-pci 0000:8a:00.0\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:173
msgid ""
"Create the virtual functions (`VFs`) from the physical interface (`PF`)."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:174
msgid ""
"Create 2 `VFs` from the `PF` and bind with `vfio-pci` following the next "
"steps:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:175
#, no-wrap
msgid ""
"$ echo 2 > /sys/bus/pci/devices/0000:8a:00.0/sriov_numvfs\n"
"$ dpdk-devbind.py -b vfio-pci 0000:8b:00.0\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:176
msgid "Configure acc100 with the proposed configuration file:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:177
#, no-wrap
msgid ""
"$ pf_bb_config ACC100 -c /opt/pf-bb-config/acc100_config_vf_5g.cfg\n"
"Tue Jun  6 10:49:20 2023:INFO:Queue Groups: 2 5GUL, 2 5GDL, 2 4GUL, 2 4GDL\n"
"Tue Jun  6 10:49:20 2023:INFO:Configuration in VF mode\n"
"Tue Jun  6 10:49:21 2023:INFO: ROM version MM 99AD92\n"
"Tue Jun  6 10:49:21 2023:WARN:* Note: Not on DDR PRQ version  1302020 != 10092020\n"
"Tue Jun  6 10:49:21 2023:INFO:PF ACC100 configuration complete\n"
"Tue Jun  6 10:49:21 2023:INFO:ACC100 PF [0000:8a:00.0] configuration complete!\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:178
msgid "Check the new VFs created from the FEC PF:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:179
#, no-wrap
msgid ""
"$ dpdk-devbind.py -s\n"
"Baseband devices using DPDK-compatible driver\n"
"=============================================\n"
"0000:8a:00.0 'Device 0d5c' drv=vfio-pci unused=\n"
"0000:8b:00.0 'Device 0d5d' drv=vfio-pci unused=\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:180
#, no-wrap
msgid ""
"Other Baseband devices\n"
"======================\n"
"0000:8b:00.1 'Device 0d5d' unused=\n"
msgstr ""

#. type: Title ===
#: asciidoc/product/atip-features.adoc:181
#, no-wrap
msgid "Huge pages"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:182
msgid ""
"When a process uses `RAM`, the `CPU` marks it as used by that process. For "
"efficiency, the `CPU` allocates `RAM` in chunks `4K` bytes is the default "
"value on many platforms. Those chunks are named pages. Pages can be swapped "
"to disk, etc."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:183
msgid ""
"Since the process address space is virtual, the `CPU` and the operating "
"system need to remember which pages belong to which process, and where each "
"page is stored. The greater the number of pages, the longer the search for "
"memory mapping. When a process uses `1 GB` of memory, that is 262144 entries "
"to look up (`1 GB` / `4 K`). If a page table entry consumes 8 bytes, that is "
"`2 MB` (262144 * 8) to look up."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:184
msgid ""
"Most current `CPU` architectures support larger-than-default pages, which "
"give the `CPU/OS` fewer entries to look up."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:186
msgid "To enable the huge pages, we should add the next kernel parameters:"
msgstr ""

#. type: Table
#: asciidoc/product/atip-features.adoc:187
#, no-wrap
msgid ""
"| parameter | value | description\n"
"\n"
"| hugepagesz\n"
"| 1G\n"
"| This option allows to set the size of huge pages to 1 G\n"
"\n"
"| hugepages\n"
"| 40\n"
"| This is the number of huge pages defined before\n"
"\n"
"| default_hugepagesz\n"
"| 1G\n"
"| This is the default value to get the huge pages\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:192
msgid ""
"To validate that the parameters are applied after the reboot, you can check "
"the command line:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:194
msgid "Using huge pages"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:195
msgid "To use the huge pages, we need to mount them:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:196
#, no-wrap
msgid ""
"$ mkdir -p /hugepages\n"
"$ mount -t hugetlbfs nodev /hugepages\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:197
msgid "Deploy a Kubernetes workload, creating the resources and the volumes:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:198
#, no-wrap
msgid ""
"...\n"
" resources:\n"
"   requests:\n"
"     memory: \"24Gi\"\n"
"     hugepages-1Gi: 16Gi\n"
"     intel.com/intel_sriov_oru: '4'\n"
"   limits:\n"
"     memory: \"24Gi\"\n"
"     hugepages-1Gi: 16Gi\n"
"     intel.com/intel_sriov_oru: '4'\n"
"...\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:199
#, no-wrap
msgid ""
"...\n"
"volumeMounts:\n"
"  - name: hugepage\n"
"    mountPath: /hugepages\n"
"...\n"
"volumes:\n"
"  - name: hugepage\n"
"    emptyDir:\n"
"      medium: HugePages\n"
"...\n"
msgstr ""

#. type: Title ===
#: asciidoc/product/atip-features.adoc:200
#, no-wrap
msgid "CPU pinning configuration"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:201
msgid "Requirements"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:202
msgid ""
"Must have the `CPU` tuned to the performance profile covered in this <<cpu-"
"tuned-configuration,section>>."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:203
msgid ""
"Must have the `RKE2` cluster kubelet configured with the CPU management "
"arguments adding the following block (as an example) to the `/etc/rancher/"
"rke2/config.yaml` file:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:204
#, no-wrap
msgid ""
"kubelet-arg:\n"
"- \"cpu-manager=true\"\n"
"- \"cpu-manager-policy=static\"\n"
"- \"cpu-manager-policy-options=full-pcpus-only=true\"\n"
"- \"cpu-manager-reconcile-period=0s\"\n"
"- \"kubelet-reserved=cpu=1\"\n"
"- \"system-reserved=cpu=1\"\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:205
msgid "Using CPU pinning on Kubernetes"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:206
msgid ""
"There are three ways to use that feature using the `Static Policy` defined "
"in kubelet depending on the requests and limits you define on your workload:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:207
msgid ""
"`BestEffort` QoS Class: If you do not define any request or limit for `CPU`, "
"the pod is scheduled on the first `CPU` available on the system."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:208
msgid "An example of using the `BestEffort` QoS Class could be:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:209
#, no-wrap
msgid ""
"spec:\n"
"  containers:\n"
"  - name: nginx\n"
"    image: nginx\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:210
msgid ""
"`Burstable` QoS Class: If you define a request for CPU, which is not equal "
"to the limits, or there is no CPU request."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:211
msgid "Examples of using the `Burstable` QoS Class could be:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:212
#, no-wrap
msgid ""
"spec:\n"
"  containers:\n"
"  - name: nginx\n"
"    image: nginx\n"
"    resources:\n"
"      limits:\n"
"        memory: \"200Mi\"\n"
"      requests:\n"
"        memory: \"100Mi\"\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:213
msgid "or"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:214
#, no-wrap
msgid ""
"spec:\n"
"  containers:\n"
"  - name: nginx\n"
"    image: nginx\n"
"    resources:\n"
"      limits:\n"
"        memory: \"200Mi\"\n"
"        cpu: \"2\"\n"
"      requests:\n"
"        memory: \"100Mi\"\n"
"        cpu: \"1\"\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:215
msgid ""
"`Guaranteed` QoS Class: If you define a request for CPU, which is equal to "
"the limits."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:216
msgid "An example of using the `Guaranteed` QoS Class could be:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:217
#, no-wrap
msgid ""
"spec:\n"
"  containers:\n"
"    - name: nginx\n"
"      image: nginx\n"
"      resources:\n"
"        limits:\n"
"          memory: \"200Mi\"\n"
"          cpu: \"2\"\n"
"        requests:\n"
"          memory: \"200Mi\"\n"
"          cpu: \"2\"\n"
msgstr ""

#. type: Title ===
#: asciidoc/product/atip-features.adoc:218
#, no-wrap
msgid "NUMA-aware scheduling"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:219
msgid ""
"Non-Uniform Memory Access or Non-Uniform Memory Architecture (`NUMA`) is a "
"physical memory design used in `SMP` (multiprocessors) architecture, where "
"the memory access time depends on the memory location relative to a "
"processor. Under `NUMA`, a processor can access its own local memory faster "
"than non-local memory, that is, memory local to another processor or memory "
"shared between processors."
msgstr ""

#. type: Title ====
#: asciidoc/product/atip-features.adoc:220
#, no-wrap
msgid "Identifying NUMA nodes"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:221
msgid "To identify the `NUMA` nodes, on your system use the following command:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:222
#, no-wrap
msgid ""
"$ lscpu | grep NUMA\n"
"NUMA node(s):                       1\n"
"NUMA node0 CPU(s):                  0-63\n"
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-features.adoc:223
msgid "For this example, we have only one `NUMA` node showing 64 `CPUs`."
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-features.adoc:224
msgid ""
"`NUMA` needs to be enabled in the `BIOS`. If `dmesg` does not have records "
"of NUMA initialization during the bootup, then `NUMA`-related messages in "
"the kernel ring buffer might have been overwritten."
msgstr ""

#. type: Title ===
#: asciidoc/product/atip-features.adoc:225
#, no-wrap
msgid "Metal LB"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:226
msgid ""
"`MetalLB` is a load-balancer implementation for bare-metal Kubernetes "
"clusters, using standard routing protocols like `L2` and `BGP` as "
"advertisement protocols. It is a network load balancer that can be used to "
"expose services in a Kubernetes cluster to the outside world due to the need "
"to use Kubernetes Services type `LoadBalancer` with bare metal."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:227
msgid ""
"To enable `MetalLB` in the `RKE2` cluster, the following steps are required:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:228
msgid "Install `MetalLB` using the following command:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:229
#, no-wrap
msgid ""
"$ kubectl apply <<EOF -f\n"
"apiVersion: helm.cattle.io/v1\n"
"kind: HelmChart\n"
"metadata:\n"
"  name: metallb\n"
"  namespace: kube-system\n"
"spec:\n"
"  repo: https://metallb.github.io/metallb/\n"
"  chart: metallb\n"
"  targetNamespace: metallb-system\n"
"---\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:230
#, no-wrap
msgid ""
"apiVersion: helm.cattle.io/v1\n"
"kind: HelmChart\n"
"metadata:\n"
"  name: endpoint-copier-operator\n"
"  namespace: kube-system\n"
"spec:\n"
"  repo: https://suse-edge.github.io/endpoint-copier-operator\n"
"  chart: endpoint-copier-operator\n"
"  targetNamespace: endpoint-copier-operator\n"
"EOF\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:231
msgid "Create the `IpAddressPool` and the `L2advertisement` configuration:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:232
#, no-wrap
msgid ""
"apiVersion: metallb.io/v1beta1\n"
"kind: IPAddressPool\n"
"metadata:\n"
"  name: kubernetes-vip-ip-pool\n"
"  namespace: metallb-system\n"
"spec:\n"
"  addresses:\n"
"    - 10.168.200.98/32\n"
"  serviceAllocation:\n"
"    priority: 100\n"
"    namespaces:\n"
"      - default\n"
"---\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:233
#, no-wrap
msgid ""
"apiVersion: metallb.io/v1beta1\n"
"kind: L2Advertisement\n"
"metadata:\n"
"  name: ip-pool-l2-adv\n"
"  namespace: metallb-system\n"
"spec:\n"
"  ipAddressPools:\n"
"    - kubernetes-vip-ip-pool\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:234
msgid "Create the endpoint service to expose the `VIP`:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:235
#, no-wrap
msgid ""
"apiVersion: v1\n"
"kind: Service\n"
"metadata:\n"
"  name: kubernetes-vip\n"
"  namespace: default\n"
"spec:\n"
"  internalTrafficPolicy: Cluster\n"
"  ipFamilies:\n"
"  - IPv4\n"
"  ipFamilyPolicy: SingleStack\n"
"  ports:\n"
"  - name: rke2-api\n"
"    port: 9345\n"
"    protocol: TCP\n"
"    targetPort: 9345\n"
"  - name: k8s-api\n"
"    port: 6443\n"
"    protocol: TCP\n"
"    targetPort: 6443\n"
"  sessionAffinity: None\n"
"  type: LoadBalancer\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:236
msgid "Check the `VIP` is created and the `MetalLB` pods are running:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:237
#, no-wrap
msgid ""
"$ kubectl get svc -n default\n"
"$ kubectl get pods -n default\n"
msgstr ""

#. type: Title ===
#: asciidoc/product/atip-features.adoc:238
#, no-wrap
msgid "Private registry configuration"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:239
msgid ""
"`Containerd` can be configured to connect to private registries and use them "
"to pull private images on each node."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:240
msgid ""
"Upon startup, `RKE2` checks if a `registries.yaml` file exists at `/etc/"
"rancher/rke2/` and instructs `containerd` to use any registries defined in "
"the file. If you wish to use a private registry, create this file as root on "
"each node that will use the registry."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:241
msgid ""
"To add the private registry, create the file `/etc/rancher/rke2/registries."
"yaml` with the following content:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:242
#, no-wrap
msgid ""
"mirrors:\n"
"  docker.io:\n"
"    endpoint:\n"
"      - \"https://registry.example.com:5000\"\n"
"configs:\n"
"  \"registry.example.com:5000\":\n"
"    auth:\n"
"      username: xxxxxx # this is the registry username\n"
"      password: xxxxxx # this is the registry password\n"
"    tls:\n"
"      cert_file:            # path to the cert file used to authenticate to the registry\n"
"      key_file:             # path to the key file for the certificate used to authenticate to the registry\n"
"      ca_file:              # path to the ca file used to verify the registry's certificate\n"
"      insecure_skip_verify: # may be set to true to skip verifying the registry's certificate\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:243
msgid "or without authentication:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-features.adoc:244
#, no-wrap
msgid ""
"mirrors:\n"
"  docker.io:\n"
"    endpoint:\n"
"      - \"https://registry.example.com:5000\"\n"
"configs:\n"
"  \"registry.example.com:5000\":\n"
"    tls:\n"
"      cert_file:            # path to the cert file used to authenticate to the registry\n"
"      key_file:             # path to the key file for the certificate used to authenticate to the registry\n"
"      ca_file:              # path to the ca file used to verify the registry's certificate\n"
"      insecure_skip_verify: # may be set to true to skip verifying the registry's certificate\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-features.adoc:245
msgid ""
"For the registry changes to take effect, you need to either configure this "
"file before starting RKE2 on the node, or restart RKE2 on each configured "
"node."
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-features.adoc:246
msgid ""
"For more information about this, please check https://docs.rke2.io/install/"
"containerd_registry_configuration#registries-configuration-file[containerd "
"registry configuration rke2]."
msgstr ""

#. type: Title ==
#: asciidoc/product/atip-lifecycle.adoc:1
#, no-wrap
msgid "Lifecycle actions"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-lifecycle.adoc:2
msgid ""
"This section covers the lifecycle management actions of deployed ATIP "
"clusters."
msgstr ""

#. type: Title ===
#: asciidoc/product/atip-lifecycle.adoc:3
#, no-wrap
msgid "Management cluster upgrades"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-lifecycle.adoc:4
msgid ""
"The upgrade of the management cluster involves several components. For a "
"list of the general components that require an upgrade, see the `Day 2` "
"<<day2-mgmt-cluster, management cluster>> documentation."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-lifecycle.adoc:5
msgid ""
"The upgrade procedure for comoponents specific to this setup can be seen "
"below."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-lifecycle.adoc:6
msgid "*Upgrading Metal^3^*"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-lifecycle.adoc:7
msgid ""
"To upgrade `Metal^3^`, use the following command to update the Helm "
"repository cache and fetch the latest chart to install `Metal^3^` from the "
"Helm chart repository:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-lifecycle.adoc:8
#, no-wrap
msgid ""
"helm repo update\n"
"helm fetch suse-edge/metal3\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-lifecycle.adoc:9
msgid ""
"After that, the easy way to upgrade is to export your current configurations "
"to a file, and then upgrade the `Metal^3^` version using that previous "
"file.  If any change is required in the new version, the file can be edited "
"before the upgrade."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-lifecycle.adoc:10
#, no-wrap
msgid ""
"helm get values metal3 -n metal3-system -o yaml > metal3-values.yaml\n"
"helm upgrade metal3 suse-edge/metal3 \\\n"
"  --namespace metal3-system \\\n"
"  -f metal3-values.yaml \\\n"
"  --version=0.7.1\n"
msgstr ""

#. type: Title ===
#: asciidoc/product/atip-lifecycle.adoc:11
#, no-wrap
msgid "Downstream cluster upgrades"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-lifecycle.adoc:12
msgid ""
"Upgrading downstream clusters involves updating several components. The "
"following sections cover the upgrade process for each of the components."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-lifecycle.adoc:13
msgid "*Upgrading the operating system*"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-lifecycle.adoc:14
msgid ""
"For this process, check the following <<atip-automated-provisioning#eib-edge-"
"image-connected,reference>> to build the new image with a new operating "
"system version.  With this new image generated by `EIB`, the next provision "
"phase uses the new operating version provided.  In the following step, the "
"new image is used to upgrade the nodes."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-lifecycle.adoc:15
msgid "*Upgrading the RKE2 cluster*"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-lifecycle.adoc:16
msgid ""
"The changes required to upgrade the `RKE2` cluster using the automated "
"workflow are the following:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-lifecycle.adoc:17
msgid ""
"Change the block `RKE2ControlPlane` in the `capi-provisioning-example.yaml` "
"shown in the following <<atip-automated-provisioning#single-node-provision,"
"section>>:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-lifecycle.adoc:18
msgid "Add the rollout strategy in the spec file."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-lifecycle.adoc:19
msgid ""
"Change the version of the `RKE2` cluster to the new version replacing `$"
"\\{RKE2_NEW_VERSION\\}`."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-lifecycle.adoc:20
#, no-wrap
msgid ""
"apiVersion: controlplane.cluster.x-k8s.io/v1alpha1\n"
"kind: RKE2ControlPlane\n"
"metadata:\n"
"  name: single-node-cluster\n"
"  namespace: default\n"
"spec:\n"
"  infrastructureRef:\n"
"    apiVersion: infrastructure.cluster.x-k8s.io/v1beta1\n"
"    kind: Metal3MachineTemplate\n"
"    name: single-node-cluster-controlplane\n"
"  replicas: 1\n"
"  serverConfig:\n"
"    cni: cilium\n"
"  rolloutStrategy:\n"
"    rollingUpdate:\n"
"      maxSurge: 0\n"
"  agentConfig:\n"
"    format: ignition\n"
"    additionalUserData:\n"
"      config: |\n"
"        variant: fcos\n"
"        version: 1.4.0\n"
"        systemd:\n"
"          units:\n"
"            - name: rke2-preinstall.service\n"
"              enabled: true\n"
"              contents: |\n"
"                [Unit]\n"
"                Description=rke2-preinstall\n"
"                Wants=network-online.target\n"
"                Before=rke2-install.service\n"
"                ConditionPathExists=!/run/cluster-api/bootstrap-success.complete\n"
"                [Service]\n"
"                Type=oneshot\n"
"                User=root\n"
"                ExecStartPre=/bin/sh -c \"mount -L config-2 /mnt\"\n"
"                ExecStart=/bin/sh -c \"sed -i \\\"s/BAREMETALHOST_UUID/$(jq -r .uuid /mnt/openstack/latest/meta_data.json)/\\\" /etc/rancher/rke2/config.yaml\"\n"
"                ExecStart=/bin/sh -c \"echo \\\"node-name: $(jq -r .name /mnt/openstack/latest/meta_data.json)\\\" >> /etc/rancher/rke2/config.yaml\"\n"
"                ExecStartPost=/bin/sh -c \"umount /mnt\"\n"
"                [Install]\n"
"                WantedBy=multi-user.target\n"
"    kubelet:\n"
"      extraArgs:\n"
"        - provider-id=metal3://BAREMETALHOST_UUID\n"
"    version: ${RKE2_NEW_VERSION}\n"
"    nodeName: \"localhost.localdomain\"\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-lifecycle.adoc:21
msgid ""
"Change the block `Metal3MachineTemplate` in the `capi-provisioning-example."
"yaml` shown in the following <<atip-automated-provisioning#single-node-"
"provision,section>>:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-lifecycle.adoc:22
msgid ""
"Change the image name and checksum to the new version generated in the "
"previous step."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-lifecycle.adoc:23
msgid "Add the directive `nodeReuse` to `true` to avoid creating a new node."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-lifecycle.adoc:24
msgid ""
"Add the directive `automatedCleaningMode` to `metadata` to enable the "
"automated cleaning for the node."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-lifecycle.adoc:25
#, no-wrap
msgid ""
"apiVersion: infrastructure.cluster.x-k8s.io/v1beta1\n"
"kind: Metal3MachineTemplate\n"
"metadata:\n"
"  name: single-node-cluster-controlplane\n"
"  namespace: default\n"
"spec:\n"
"  nodeReuse: True\n"
"  template:\n"
"    spec:\n"
"      automatedCleaningMode: metadata\n"
"      dataTemplate:\n"
"        name: single-node-cluster-controlplane-template\n"
"      hostSelector:\n"
"        matchLabels:\n"
"          cluster-role: control-plane\n"
"      image:\n"
"        checksum: http://imagecache.local:8080/${NEW_IMAGE_GENERATED}.sha256\n"
"        checksumType: sha256\n"
"        format: raw\n"
"        url: http://imagecache.local:8080/${NEW_IMAGE_GENERATED}.raw\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-lifecycle.adoc:26
msgid ""
"After making these changes, the `capi-provisioning-example.yaml` file can be "
"applied to the cluster using the following command:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-lifecycle.adoc:27
#, no-wrap
msgid "kubectl apply -f capi-provisioning-example.yaml\n"
msgstr ""

#. type: Title ==
#: asciidoc/product/atip-management-cluster.adoc:1
#, no-wrap
msgid "Setting up the management cluster"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:3
msgid ""
"The management cluster is the part of ATIP that is used to manage the "
"provision and lifecycle of the runtime stacks.  From a technical point of "
"view, the management cluster contains the following components:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:4
msgid ""
"`SUSE Linux Enterprise Micro` as the OS. Depending on the use case, some "
"configurations like networking, storage, users and kernel arguments can be "
"customized."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:5
msgid ""
"`RKE2` as the Kubernetes cluster. Depending on the use case, it can be "
"configured to use specific CNI plugins, such as `Multus`, `Cilium`, etc."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:6
msgid ""
"`Rancher` as the management platform to manage the lifecycle of the clusters."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:7
msgid ""
"`Metal^3^` as the component to manage the lifecycle of the bare metal nodes."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:8
msgid ""
"`CAPI` as the component to manage the lifecycle of the Kubernetes clusters "
"(downstream clusters). With ATIP, also the `RKE2 CAPI Provider` is used to "
"manage the lifecycle of the RKE2 clusters (downstream clusters)."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:9
msgid ""
"With all components mentioned above, the management cluster can manage the "
"lifecycle of downstream clusters, using a declarative approach to manage the "
"infrastructure and applications."
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-management-cluster.adoc:10
msgid ""
"For more information about `SUSE Linux Enterprise Micro`, see: <<components-"
"slmicro,SLE Micro>>"
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-management-cluster.adoc:11
msgid "For more information about `RKE2`, see: <<components-rke2,RKE2>>"
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-management-cluster.adoc:12
msgid ""
"For more information about `Rancher`, see: <<components-rancher,Rancher>>"
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-management-cluster.adoc:13
msgid ""
"For more information about `Metal^3^`, see: <<components-metal3,Metal^3^>>"
msgstr ""

#. type: Title ===
#: asciidoc/product/atip-management-cluster.adoc:14
#, no-wrap
msgid "Steps to set up the management cluster"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:15
msgid ""
"The following steps are necessary to set up the management cluster (using a "
"single node):"
msgstr ""

#. type: Target for macro image
#: asciidoc/product/atip-management-cluster.adoc:16
#, no-wrap
msgid "product-atip-mgmtcluster1.png"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:17
msgid ""
"There are three main steps to set up the management cluster using a "
"declarative approach:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:18
msgid ""
"**xref:mgmt-cluster-image-preparation-connected[Image preparation for "
"connected environments]**: The first step is to prepare the manifests and "
"files with all the necessary configurations to be used in connected "
"environments."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:19
msgid ""
"xref:mgmt-cluster-directory-structure[Directory structure for connected "
"environments]: This step creates a directory structure to be used by Edge "
"Image Builder to store the configuration files and the image itself."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:20
msgid ""
"xref:mgmt-cluster-image-definition-file[Management cluster definition file]: "
"The `mgmt-cluster.yaml` file is the main definition file for the management "
"cluster. It contains the following information about the image to be created:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:21
msgid ""
"Image Information: The information related to the image to be created using "
"the base image."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:22
msgid ""
"Operating system: The operating system configurations to be used in the "
"image."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:23
msgid ""
"Kubernetes: Helm charts and repositories, kubernetes version, network "
"configuration, and the nodes to be used in the cluster."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:24
msgid ""
"xref:mgmt-cluster-custom-folder[Custom folder]: The `custom` folder contains "
"the configuration files and scripts to be used by Edge Image Builder to "
"deploy a fully functional management cluster."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:25
msgid ""
"Files: Contains the configuration files to be used by the management cluster."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:26
msgid "Scripts: Contains the scripts to be used by the management cluster."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:27
msgid ""
"xref:mgmt-cluster-kubernetes-folder[Kubernetes folder]: The `kubernetes` "
"folder contains the configuration files to be used by the management cluster."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:28
msgid "Manifests: Contains the manifests to be used by the management cluster."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:29
msgid "Helm: Contains the Helm charts to be used by the management cluster."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:30
msgid ""
"Config: Contains the configuration files to be used by the management "
"cluster."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:31
msgid ""
"xref:mgmt-cluster-network-folder[Network folder]: The `network` folder "
"contains the network configuration files to be used by the management "
"cluster nodes."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:32
msgid ""
"**xref:mgmt-cluster-image-preparation-airgap[Image preparation for air-gap "
"environments]**: The step is to show the differences to prepare the "
"manifests and files to be used in an air-gap scenario."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:33
msgid ""
"xref:mgmt-cluster-directory-structure-airgap[Directory structure for air-gap "
"environments]: The directory structure must be modified to include the "
"resources needed to run the management cluster in an air-gap environment."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:34
msgid ""
"xref:mgmt-cluster-image-definition-file-airgap[Modifications in the "
"definition file]: The `mgmt-cluster.yaml` file must be modified to include "
"the `embeddedArtifactRegistry` section with the `images` field set to all "
"container images to be included into the EIB output image."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:35
msgid ""
"xref:mgmt-cluster-custom-folder-airgap[Modifications in the custom folder]: "
"The `custom` folder must be modified to include the resources needed to run "
"the management cluster in an air-gap environment."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:36
msgid ""
"Register script: The `custom/scripts/99-register.sh` script must be removed "
"when you use an air-gap environment."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:37
msgid ""
"Air-gap resources: The `custom/files/airgap-resources.tar.gz` file must be "
"included in the `custom/files` folder with all the resources needed to run "
"the management cluster in an air-gap environment."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:38
msgid ""
"Scripts: The `custom/scripts/99-mgmt-setup.sh` script must be modified to "
"extract and copy the `airgap-resources.tar.gz` file to the final location. "
"The `custom/files/metal3.sh` script must be modified to use the local "
"resources included in the `airgap-resources.tar.gz` file instead of "
"downloading them from the internet."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:39
msgid ""
"**xref:mgmt-cluster-image-creation[Image creation]**: This step covers the "
"creation of the image using the Edge Image Builder tool (for both, connected "
"and air-gap scenarios). Check the <<components-eib,prerequisites>> to run "
"the Edge Image Builder tool on your system."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:40
msgid ""
"**xref:mgmt-cluster-provision[Management Cluster Provision]**: This step "
"covers the provisioning of the management cluster using the image created in "
"the previous step (for both, connected and air-gap scenarios). This step can "
"be done using a laptop, server, VM or any other x86_64 system with a USB "
"port."
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-management-cluster.adoc:41
msgid ""
"For more information about Edge Image Builder, see <<components-eib,Edge "
"Image Builder>> and <<quickstart-eib,Edge Image Builder Quick Start>>."
msgstr ""

#. type: Title ===
#: asciidoc/product/atip-management-cluster.adoc:42
#, no-wrap
msgid "Image preparation for connected environments"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:43
msgid ""
"Using Edge Image Builder to create the image for the management cluster, a "
"lot of configurations can be customized, but in this document, we cover the "
"minimal configurations necessary to set up the management cluster.  Edge "
"Image Builder is typically run from inside a container so, if you do not "
"already have a way to run containers, we need to start by installing a "
"container runtime such as https://podman.io[Podman] or https://"
"rancherdesktop.io[Rancher Desktop]. For this guide, we assume you already "
"have a container runtime available."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:44
msgid ""
"Also, as a prerequisite to deploy a highly available management cluster, you "
"need to reserve three IPs in your network:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:45
msgid ""
"`apiVIP` for the API VIP Address (used to access the Kubernetes API server)."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:46
msgid ""
"`ingressVIP` for the Ingress VIP Address (consumed, for example, by the "
"Rancher UI)."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:47
msgid "`metal3VIP` for the Metal3 VIP Address."
msgstr ""

#. type: Title ====
#: asciidoc/product/atip-management-cluster.adoc:48
#, no-wrap
msgid "Directory structure"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:49
msgid ""
"When running EIB, a directory is mounted from the host, so the first thing "
"to do is to create a directory structure to be used by EIB to store the "
"configuration files and the image itself.  This directory has the following "
"structure:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:50
#, no-wrap
msgid ""
"eib\n"
"├── mgmt-cluster.yaml\n"
"├── network\n"
"│ └── mgmt-cluster-node1.yaml\n"
"├── kubernetes\n"
"│ ├── manifests\n"
"│ │ ├── rke2-ingress-config.yaml\n"
"│ │ ├── neuvector-namespace.yaml\n"
"│ │ ├── ingress-l2-adv.yaml\n"
"│ │ └── ingress-ippool.yaml\n"
"│ ├── helm\n"
"│ │ └── values\n"
"│ │     ├── rancher.yaml\n"
"│ │     ├── neuvector.yaml\n"
"│ │     ├── metal3.yaml\n"
"│ │     └── certmanager.yaml\n"
"│ └── config\n"
"│     └── server.yaml\n"
"├── custom\n"
"│ ├── scripts\n"
"│ │ ├── 99-register.sh\n"
"│ │ ├── 99-mgmt-setup.sh\n"
"│ │ └── 99-alias.sh\n"
"│ └── files\n"
"│     ├── rancher.sh\n"
"│     ├── mgmt-stack-setup.service\n"
"│     ├── metal3.sh\n"
"│     └── basic-setup.sh\n"
"└── base-images\n"
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-management-cluster.adoc:51
msgid ""
"The image `SLE-Micro.x86_64-5.5.0-Default-SelfInstall-GM2.install.iso` must "
"be downloaded from the https://scc.suse.com/[SUSE Customer Center] or the "
"https://www.suse.com/download/sle-micro/[SUSE Download page], and it must be "
"located under the `base-images` folder."
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-management-cluster.adoc:52
#: asciidoc/product/atip-management-cluster.adoc:201
msgid ""
"You should check the SHA256 checksum of the image to ensure it has not been "
"tampered with. The checksum can be found in the same location where the "
"image was downloaded."
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-management-cluster.adoc:53
#: asciidoc/product/atip-management-cluster.adoc:202
msgid ""
"An example of the directory structure can be found in the https://github.com/"
"suse-edge/atip[SUSE Edge GitHub repository under the \"telco-examples\" "
"folder]."
msgstr ""

#. type: Title ====
#: asciidoc/product/atip-management-cluster.adoc:54
#, no-wrap
msgid "Management cluster definition file"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:55
msgid ""
"The `mgmt-cluster.yaml` file is the main definition file for the management "
"cluster. It contains the following information:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:56
#, no-wrap
msgid ""
"apiVersion: 1.0\n"
"image:\n"
"  imageType: iso\n"
"  arch: x86_64\n"
"  baseImage: SLE-Micro.x86_64-5.5.0-Default-SelfInstall-GM2.install.iso\n"
"  outputImageName: eib-mgmt-cluster-image.iso\n"
"operatingSystem:\n"
"  isoConfiguration:\n"
"    installDevice: /dev/sda\n"
"  users:\n"
"  - username: root\n"
"    encryptedPassword: ${ROOT_PASSWORD}\n"
"  packages:\n"
"    packageList:\n"
"    - git\n"
"    - jq\n"
"    sccRegistrationCode: ${SCC_REGISTRATION_CODE}\n"
"kubernetes:\n"
"  version: ${KUBERNETES_VERSION}\n"
"  helm:\n"
"    charts:\n"
"      - name: cert-manager\n"
"        repositoryName: jetstack\n"
"        version: 1.14.2\n"
"        targetNamespace: cert-manager\n"
"        valuesFile: certmanager.yaml\n"
"        createNamespace: true\n"
"        installationNamespace: kube-system\n"
"      - name: longhorn-crd\n"
"        version: 103.3.0+up1.6.1\n"
"        repositoryName: rancher-charts\n"
"        targetNamespace: longhorn-system\n"
"        createNamespace: true\n"
"        installationNamespace: kube-system\n"
"      - name: longhorn\n"
"        version: 103.3.0+up1.6.1\n"
"        repositoryName: rancher-charts\n"
"        targetNamespace: longhorn-system\n"
"        createNamespace: true\n"
"        installationNamespace: kube-system\n"
"      - name: metal3-chart\n"
"        version: 0.7.1\n"
"        repositoryName: suse-edge-charts\n"
"        targetNamespace: metal3-system\n"
"        createNamespace: true\n"
"        installationNamespace: kube-system\n"
"        valuesFile: metal3.yaml\n"
"      - name: neuvector-crd\n"
"        version: 103.0.3+up2.7.6\n"
"        repositoryName: rancher-charts\n"
"        targetNamespace: neuvector\n"
"        createNamespace: true\n"
"        installationNamespace: kube-system\n"
"        valuesFile: neuvector.yaml\n"
"      - name: neuvector\n"
"        version: 103.0.3+up2.7.6\n"
"        repositoryName: rancher-charts\n"
"        targetNamespace: neuvector\n"
"        createNamespace: true\n"
"        installationNamespace: kube-system\n"
"        valuesFile: neuvector.yaml\n"
"      - name: rancher\n"
"        version: 2.8.4\n"
"        repositoryName: rancher-prime\n"
"        targetNamespace: cattle-system\n"
"        createNamespace: true\n"
"        installationNamespace: kube-system\n"
"        valuesFile: rancher.yaml\n"
"    repositories:\n"
"      - name: jetstack\n"
"        url: https://charts.jetstack.io\n"
"      - name: rancher-charts\n"
"        url: https://charts.rancher.io/\n"
"      - name: suse-edge-charts\n"
"        url: oci://registry.suse.com/edge\n"
"      - name: rancher-prime\n"
"        url: https://charts.rancher.com/server-charts/prime\n"
"    network:\n"
"      apiHost: ${API_HOST}\n"
"      apiVIP: ${API_VIP}\n"
"    nodes:\n"
"      - hostname: mgmt-cluster-node1\n"
"        initializer: true\n"
"        type: server\n"
"#     - hostname: mgmt-cluster-node2\n"
"#       initializer: true\n"
"#       type: server\n"
"#     - hostname: mgmt-cluster-node3\n"
"#       initializer: true\n"
"#       type: server\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:57
msgid ""
"To explain the fields and values in the `mgmt-cluster.yaml` definition file, "
"we have divided it into the following sections."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:58
msgid "Image section (definition file):"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:59
#, no-wrap
msgid ""
"image:\n"
"  imageType: iso\n"
"  arch: x86_64\n"
"  baseImage: SLE-Micro.x86_64-5.5.0-Default-SelfInstall-GM2.install.iso\n"
"  outputImageName: eib-mgmt-cluster-image.iso\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:60
msgid ""
"where the `baseImage` is the original image you downloaded from the SUSE "
"Customer Center or the SUSE Download page. `outputImageName` is the name of "
"the new image that will be used to provision the management cluster."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:61
msgid "Operating system section (definition file):"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:62
#, no-wrap
msgid ""
"operatingSystem:\n"
"  isoConfiguration:\n"
"    installDevice: /dev/sda\n"
"  users:\n"
"  - username: root\n"
"    encryptedPassword: ${ROOT_PASSWORD}\n"
"  packages:\n"
"    packageList:\n"
"    - jq\n"
"    sccRegistrationCode: ${SCC_REGISTRATION_CODE}\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:63
msgid ""
"where the `installDevice` is the device to be used to install the operating "
"system, the `username` and `encryptedPassword` are the credentials to be "
"used to access the system, the `packageList` is the list of packages to be "
"installed (`jq` is required internally during the installation process), and "
"the `sccRegistrationCode` is the registration code used to get the packages "
"and dependencies at build time and can be obtained from the SUSE Customer "
"Center.  The encrypted password can be generated using the `openssl` command "
"as follows:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:64
#, no-wrap
msgid "openssl passwd -6 MyPassword!123\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:65
msgid "This outputs something similar to:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:66
#, no-wrap
msgid "$6$UrXB1sAGs46DOiSq$HSwi9GFJLCorm0J53nF2Sq8YEoyINhHcObHzX2R8h13mswUIsMwzx4eUzn/rRx0QPV4JIb0eWCoNrxGiKH4R31\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:67
msgid "Kubernetes section (definition file):"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:68
#, no-wrap
msgid ""
"kubernetes:\n"
"  version: ${KUBERNETES_VERSION}\n"
"  helm:\n"
"    charts:\n"
"      - name: cert-manager\n"
"        repositoryName: jetstack\n"
"        version: 1.14.2\n"
"        targetNamespace: cert-manager\n"
"        valuesFile: certmanager.yaml\n"
"        createNamespace: true\n"
"        installationNamespace: kube-system\n"
"      - name: longhorn-crd\n"
"        version: 103.3.0+up1.6.1\n"
"        repositoryName: rancher-charts\n"
"        targetNamespace: longhorn-system\n"
"        createNamespace: true\n"
"        installationNamespace: kube-system\n"
"      - name: longhorn\n"
"        version: 103.3.0+up1.6.1\n"
"        repositoryName: rancher-charts\n"
"        targetNamespace: longhorn-system\n"
"        createNamespace: true\n"
"        installationNamespace: kube-system\n"
"      - name: metal3-chart\n"
"        version: 0.7.1\n"
"        repositoryName: suse-edge-charts\n"
"        targetNamespace: metal3-system\n"
"        createNamespace: true\n"
"        installationNamespace: kube-system\n"
"        valuesFile: metal3.yaml\n"
"      - name: neuvector-crd\n"
"        version: 103.0.3+up2.7.6\n"
"        repositoryName: rancher-charts\n"
"        targetNamespace: neuvector\n"
"        createNamespace: true\n"
"        installationNamespace: kube-system\n"
"        valuesFile: neuvector.yaml\n"
"      - name: neuvector\n"
"        version: 103.0.3+up2.7.6\n"
"        repositoryName: rancher-charts\n"
"        targetNamespace: neuvector\n"
"        createNamespace: true\n"
"        installationNamespace: kube-system\n"
"        valuesFile: neuvector.yaml\n"
"      - name: rancher\n"
"        version: 2.8.4\n"
"        repositoryName: rancher-prime\n"
"        targetNamespace: cattle-system\n"
"        createNamespace: true\n"
"        installationNamespace: kube-system\n"
"        valuesFile: rancher.yaml\n"
"    repositories:\n"
"      - name: jetstack\n"
"        url: https://charts.jetstack.io\n"
"      - name: rancher-charts\n"
"        url: https://charts.rancher.io/\n"
"      - name: suse-edge-charts\n"
"        url: oci://registry.suse.com/edge\n"
"      - name: rancher-prime\n"
"        url: https://charts.rancher.com/server-charts/prime\n"
"    network:\n"
"      apiHost: ${API_HOST}\n"
"      apiVIP: ${API_VIP}\n"
"    nodes:\n"
"      - hostname: mgmt-cluster1\n"
"        initializer: true\n"
"        type: server\n"
"#      - hostname: mgmt-cluster2\n"
"#        type: server\n"
"#      - hostname: mgmt-cluster3\n"
"#        type: server\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:69
msgid ""
"where `version` is the version of Kubernetes to be installed. In our case, "
"we are using an RKE2 cluster, so the version must be minor less than 1.29 to "
"be compatible with `Rancher` (for example, `v1.28.9+rke2r1`)."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:70
msgid ""
"The `helm` section contains the list of Helm charts to be installed, the "
"repositories to be used, and the version configuration for all of them."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:71
msgid ""
"The `network` section contains the configuration for the network, like the "
"`apiHost` and `apiVIP` to be used by the `RKE2` component.  The `apiVIP` "
"should be an IP address that is not used in the network and should not be "
"part of the DHCP pool (in case we use DHCP). Also, when we use the `apiVIP` "
"in a multi-node cluster, it is used to access the Kubernetes API server.  "
"The `apiHost` is the name resolution to `apiVIP` to be used by the `RKE2` "
"component."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:72
msgid ""
"The `nodes` section contains the list of nodes to be used in the cluster. "
"The `nodes` section contains the list of nodes to be used in the cluster. In "
"this example, a single-node cluster is being used, but it can be extended to "
"a multi-node cluster by adding more nodes to the list (by uncommenting the "
"lines)."
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-management-cluster.adoc:73
msgid ""
"The names of the nodes must be unique in the cluster, and the `initializer` "
"field mustbe set to `true` for the first node in the list.  The names of the "
"nodes must be the same as the host names defined in the `network` section "
"matching directly with the file name in the `network` section."
msgstr ""

#. type: Title ====
#: asciidoc/product/atip-management-cluster.adoc:74
#, no-wrap
msgid "Custom folder"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:75
msgid "The `custom` folder contains the following subfolders:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:76
#, no-wrap
msgid ""
"...\n"
"├── custom\n"
"│ ├── scripts\n"
"│ │ ├── 99-register.sh\n"
"│ │ ├── 99-mgmt-setup.sh\n"
"│ │ └── 99-alias.sh\n"
"│ └── files\n"
"│     ├── rancher.sh\n"
"│     ├── mgmt-stack-setup.service\n"
"│     ├── metal3.sh\n"
"│     └── basic-setup.sh\n"
"...\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:77
msgid ""
"The `custom/files` folder contains the configuration files to be used by the "
"management cluster."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:78
msgid ""
"The `custom/scripts` folder contains the scripts to be used by the "
"management cluster."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:79
msgid "The `custom/files` folder contains the following files:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:80
msgid ""
"`basic-setup.sh`: contains the configuration parameters about the `Metal^3^` "
"version to be used, as well as the `Rancher` and `MetalLB` basic parameters. "
"Only modify this file if you want to change the versions of the components "
"or the namespaces to be used."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:81
#, no-wrap
msgid ""
"#!/bin/bash\n"
"# Pre-requisites. Cluster already running\n"
"export KUBECTL=\"/var/lib/rancher/rke2/bin/kubectl\"\n"
"export KUBECONFIG=\"/etc/rancher/rke2/rke2.yaml\"\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:82
#, no-wrap
msgid ""
"##################\n"
"# METAL3 DETAILS #\n"
"##################\n"
"export METAL3_CHART_TARGETNAMESPACE=\"metal3-system\"\n"
"export METAL3_CLUSTERCTLVERSION=\"1.6.2\"\n"
"export METAL3_CAPICOREVERSION=\"1.6.2\"\n"
"export METAL3_CAPIMETAL3VERSION=\"1.6.0\"\n"
"export METAL3_CAPIRKE2VERSION=\"0.2.6\"\n"
"export METAL3_CAPIPROVIDER=\"rke2\"\n"
"export METAL3_CAPISYSTEMNAMESPACE=\"capi-system\"\n"
"export METAL3_RKE2BOOTSTRAPNAMESPACE=\"rke2-bootstrap-system\"\n"
"export METAL3_CAPM3NAMESPACE=\"capm3-system\"\n"
"export METAL3_RKE2CONTROLPLANENAMESPACE=\"rke2-control-plane-system\"\n"
"export METAL3_CAPI_IMAGES=\"registry.suse.com/edge\"\n"
"# Or registry.opensuse.org/isv/suse/edge/clusterapi/containerfile/suse for the upstream ones\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:83
#, no-wrap
msgid ""
"###########\n"
"# METALLB #\n"
"###########\n"
"export METALLBNAMESPACE=\"metallb-system\"\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:84
#, no-wrap
msgid ""
"###########\n"
"# RANCHER #\n"
"###########\n"
"export RANCHER_CHART_TARGETNAMESPACE=\"cattle-system\"\n"
"export RANCHER_FINALPASSWORD=\"adminadminadmin\"\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:85
#, no-wrap
msgid ""
"die(){\n"
"  echo ${1} 1>&2\n"
"  exit ${2}\n"
"}\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:86
msgid ""
"`metal3.sh`: contains the configuration for the `Metal^3^` component to be "
"used (no modifications needed). In future versions, this script will be "
"replaced to use instead `Rancher Turtles` to make it easy."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:87
#: asciidoc/product/atip-management-cluster.adoc:113
#: asciidoc/product/atip-management-cluster.adoc:140
#: asciidoc/product/atip-management-cluster.adoc:216
#, no-wrap
msgid ""
"#!/bin/bash\n"
"set -euo pipefail\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:88
#: asciidoc/product/atip-management-cluster.adoc:114
#: asciidoc/product/atip-management-cluster.adoc:217
#, no-wrap
msgid ""
"BASEDIR=\"$(dirname \"$0\")\"\n"
"source ${BASEDIR}/basic-setup.sh\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:89
#: asciidoc/product/atip-management-cluster.adoc:218
#, no-wrap
msgid ""
"METAL3LOCKNAMESPACE=\"default\"\n"
"METAL3LOCKCMNAME=\"metal3-lock\"\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:90
#: asciidoc/product/atip-management-cluster.adoc:117
#: asciidoc/product/atip-management-cluster.adoc:219
#, no-wrap
msgid "trap 'catch $? $LINENO' EXIT\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:91
#: asciidoc/product/atip-management-cluster.adoc:220
#, no-wrap
msgid ""
"catch() {\n"
"  if [ \"$1\" != \"0\" ]; then\n"
"    echo \"Error $1 occurred on $2\"\n"
"    ${KUBECTL} delete configmap ${METAL3LOCKCMNAME} -n ${METAL3LOCKNAMESPACE}\n"
"  fi\n"
"}\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:92
#: asciidoc/product/atip-management-cluster.adoc:221
#, no-wrap
msgid ""
"# Get or create the lock to run all those steps just in a single node\n"
"# As the first node is created WAY before the others, this should be enough\n"
"# TODO: Investigate if leases is better\n"
"if [ $(${KUBECTL} get cm -n ${METAL3LOCKNAMESPACE} ${METAL3LOCKCMNAME} -o name | wc -l) -lt 1 ]; then\n"
"  ${KUBECTL} create configmap ${METAL3LOCKCMNAME} -n ${METAL3LOCKNAMESPACE} --from-literal foo=bar\n"
"else\n"
"  exit 0\n"
"fi\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:93
#: asciidoc/product/atip-management-cluster.adoc:222
#, no-wrap
msgid ""
"# Wait for metal3\n"
"while ! ${KUBECTL} wait --for condition=ready -n ${METAL3_CHART_TARGETNAMESPACE} $(${KUBECTL} get pods -n ${METAL3_CHART_TARGETNAMESPACE} -l app.kubernetes.io/name=metal3-ironic -o name) --timeout=10s; do sleep 2 ; done\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:94
#, no-wrap
msgid ""
"# Get the ironic IP\n"
"IRONICIP=$(${KUBECTL} get cm -n ${METAL3_CHART_TARGETNAMESPACE} ironic-bmo -o jsonpath='{.data.IRONIC_IP}')\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:95
#, no-wrap
msgid ""
"# If LoadBalancer, use metallb, else it is NodePort\n"
"if [ $(${KUBECTL} get svc -n ${METAL3_CHART_TARGETNAMESPACE} metal3-metal3-ironic -o jsonpath='{.spec.type}') == \"LoadBalancer\" ]; then\n"
"  # Wait for metallb\n"
"  while ! ${KUBECTL} wait --for condition=ready -n ${METALLBNAMESPACE} $(${KUBECTL} get pods -n ${METALLBNAMESPACE} -l app.kubernetes.io/component=controller -o name) --timeout=10s; do sleep 2 ; done\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:96
#, no-wrap
msgid ""
"  # Do not create the ippool if already created\n"
"  ${KUBECTL} get ipaddresspool -n ${METALLBNAMESPACE} ironic-ip-pool -o name || cat <<-EOF | ${KUBECTL} apply -f -\n"
"  apiVersion: metallb.io/v1beta1\n"
"  kind: IPAddressPool\n"
"  metadata:\n"
"    name: ironic-ip-pool\n"
"    namespace: ${METALLBNAMESPACE}\n"
"  spec:\n"
"    addresses:\n"
"    - ${IRONICIP}/32\n"
"    serviceAllocation:\n"
"      priority: 100\n"
"      serviceSelectors:\n"
"      - matchExpressions:\n"
"        - {key: app.kubernetes.io/name, operator: In, values: [metal3-ironic]}\n"
"\tEOF\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:97
#, no-wrap
msgid ""
"  # Same for L2 Advs\n"
"  ${KUBECTL} get L2Advertisement -n ${METALLBNAMESPACE} ironic-ip-pool-l2-adv -o name || cat <<-EOF | ${KUBECTL} apply -f -\n"
"  apiVersion: metallb.io/v1beta1\n"
"  kind: L2Advertisement\n"
"  metadata:\n"
"    name: ironic-ip-pool-l2-adv\n"
"    namespace: ${METALLBNAMESPACE}\n"
"  spec:\n"
"    ipAddressPools:\n"
"    - ironic-ip-pool\n"
"\tEOF\n"
"fi\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:98
#, no-wrap
msgid ""
"# If clusterctl is not installed, install it\n"
"if ! command -v clusterctl > /dev/null 2>&1; then\n"
"  LINUXARCH=$(uname -m)\n"
"  case $(uname -m) in\n"
"    \"x86_64\")\n"
"      export GOARCH=\"amd64\" ;;\n"
"    \"aarch64\")\n"
"      export GOARCH=\"arm64\" ;;\n"
"    \"*\")\n"
"      echo \"Arch not found, asumming amd64\"\n"
"      export GOARCH=\"amd64\" ;;\n"
"  esac\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:99
#, no-wrap
msgid ""
"  # Clusterctl bin\n"
"  # Maybe just use the binary from hauler if available\n"
"  curl -L https://github.com/kubernetes-sigs/cluster-api/releases/download/v${METAL3_CLUSTERCTLVERSION}/clusterctl-linux-${GOARCH} -o /usr/local/bin/clusterctl\n"
"  chmod +x /usr/local/bin/clusterctl\n"
"fi\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:100
#: asciidoc/product/atip-management-cluster.adoc:223
#, no-wrap
msgid ""
"# If rancher is deployed\n"
"if [ $(${KUBECTL} get pods -n ${RANCHER_CHART_TARGETNAMESPACE} -l app=rancher -o name | wc -l) -ge 1 ]; then\n"
"  cat <<-EOF | ${KUBECTL} apply -f -\n"
"\tapiVersion: management.cattle.io/v3\n"
"\tkind: Feature\n"
"\tmetadata:\n"
"\t  name: embedded-cluster-api\n"
"\tspec:\n"
"\t  value: false\n"
"\tEOF\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:101
#: asciidoc/product/atip-management-cluster.adoc:224
#, no-wrap
msgid ""
"  # Disable Rancher webhooks for CAPI\n"
"  ${KUBECTL} delete mutatingwebhookconfiguration.admissionregistration.k8s.io mutating-webhook-configuration\n"
"  ${KUBECTL} delete validatingwebhookconfigurations.admissionregistration.k8s.io validating-webhook-configuration\n"
"  ${KUBECTL} wait --for=delete namespace/cattle-provisioning-capi-system --timeout=300s\n"
"fi\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:102
#: asciidoc/product/atip-management-cluster.adoc:225
#, no-wrap
msgid ""
"# Deploy CAPI\n"
"if [ $(${KUBECTL} get pods -n ${METAL3_CAPISYSTEMNAMESPACE} -o name | wc -l) -lt 1 ]; then\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:103
#, no-wrap
msgid ""
"  # https://github.com/rancher-sandbox/cluster-api-provider-rke2#setting-up-clusterctl\n"
"  mkdir -p ~/.cluster-api\n"
"  cat <<-EOF > ~/.cluster-api/clusterctl.yaml\n"
"\timages:\n"
"\t  all:\n"
"\t    repository: ${METAL3_CAPI_IMAGES}\n"
"\tEOF\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:104
#, no-wrap
msgid ""
"  # Try this command 3 times just in case, stolen from https://stackoverflow.com/a/33354419\n"
"  if ! (r=3; while ! clusterctl init \\\n"
"    --core \"cluster-api:v${METAL3_CAPICOREVERSION}\"\\\n"
"    --infrastructure \"metal3:v${METAL3_CAPIMETAL3VERSION}\"\\\n"
"    --bootstrap \"${METAL3_CAPIPROVIDER}:v${METAL3_CAPIRKE2VERSION}\"\\\n"
"    --control-plane \"${METAL3_CAPIPROVIDER}:v${METAL3_CAPIRKE2VERSION}\" ; do\n"
"            ((--r))||exit\n"
"            echo \"Something went wrong, let's wait 10 seconds and retry\"\n"
"            sleep 10;done) ; then\n"
"      echo \"clusterctl failed\"\n"
"      exit 1\n"
"  fi\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:105
#: asciidoc/product/atip-management-cluster.adoc:227
#, no-wrap
msgid ""
"  # Wait for capi-controller-manager\n"
"  while ! ${KUBECTL} wait --for condition=ready -n ${METAL3_CAPISYSTEMNAMESPACE} $(${KUBECTL} get pods -n ${METAL3_CAPISYSTEMNAMESPACE} -l cluster.x-k8s.io/provider=cluster-api -o name) --timeout=10s; do sleep 2 ; done\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:106
#: asciidoc/product/atip-management-cluster.adoc:228
#, no-wrap
msgid ""
"  # Wait for capm3-controller-manager, there are two pods, the ipam and the capm3 one, just wait for the first one\n"
"  while ! ${KUBECTL} wait --for condition=ready -n ${METAL3_CAPM3NAMESPACE} $(${KUBECTL} get pods -n ${METAL3_CAPM3NAMESPACE} -l cluster.x-k8s.io/provider=infrastructure-metal3 -o name | head -n1 ) --timeout=10s; do sleep 2 ; done\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:107
#: asciidoc/product/atip-management-cluster.adoc:229
#, no-wrap
msgid ""
"  # Wait for rke2-bootstrap-controller-manager\n"
"  while ! ${KUBECTL} wait --for condition=ready -n ${METAL3_RKE2BOOTSTRAPNAMESPACE} $(${KUBECTL} get pods -n ${METAL3_RKE2BOOTSTRAPNAMESPACE} -l cluster.x-k8s.io/provider=bootstrap-rke2 -o name) --timeout=10s; do sleep 2 ; done\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:108
#: asciidoc/product/atip-management-cluster.adoc:230
#, no-wrap
msgid ""
"  # Wait for rke2-control-plane-controller-manager\n"
"  while ! ${KUBECTL} wait --for condition=ready -n ${METAL3_RKE2CONTROLPLANENAMESPACE} $(${KUBECTL} get pods -n ${METAL3_RKE2CONTROLPLANENAMESPACE} -l cluster.x-k8s.io/provider=control-plane-rke2 -o name) --timeout=10s; do sleep 2 ; done\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:109
#: asciidoc/product/atip-management-cluster.adoc:231
#, no-wrap
msgid "fi\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:110
#: asciidoc/product/atip-management-cluster.adoc:232
#, no-wrap
msgid "# Clean up the lock cm\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:111
#: asciidoc/product/atip-management-cluster.adoc:233
#, no-wrap
msgid "${KUBECTL} delete configmap ${METAL3LOCKCMNAME} -n ${METAL3LOCKNAMESPACE}\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:112
msgid ""
"`rancher.sh`: contains the configuration for the `Rancher` component to be "
"used (no modifications needed)."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:115
#, no-wrap
msgid ""
"RANCHERLOCKNAMESPACE=\"default\"\n"
"RANCHERLOCKCMNAME=\"rancher-lock\"\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:116
#, no-wrap
msgid ""
"if [ -z \"${RANCHER_FINALPASSWORD}\" ]; then\n"
"  # If there is no final password, then finish the setup right away\n"
"  exit 0\n"
"fi\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:118
#, no-wrap
msgid ""
"catch() {\n"
"  if [ \"$1\" != \"0\" ]; then\n"
"    echo \"Error $1 occurred on $2\"\n"
"    ${KUBECTL} delete configmap ${RANCHERLOCKCMNAME} -n ${RANCHERLOCKNAMESPACE}\n"
"  fi\n"
"}\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:119
#, no-wrap
msgid ""
"# Get or create the lock to run all those steps just in a single node\n"
"# As the first node is created WAY before the others, this should be enough\n"
"# TODO: Investigate if leases is better\n"
"if [ $(${KUBECTL} get cm -n ${RANCHERLOCKNAMESPACE} ${RANCHERLOCKCMNAME} -o name | wc -l) -lt 1 ]; then\n"
"  ${KUBECTL} create configmap ${RANCHERLOCKCMNAME} -n ${RANCHERLOCKNAMESPACE} --from-literal foo=bar\n"
"else\n"
"  exit 0\n"
"fi\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:120
#, no-wrap
msgid ""
"# Wait for rancher to be deployed\n"
"while ! ${KUBECTL} wait --for condition=ready -n ${RANCHER_CHART_TARGETNAMESPACE} $(${KUBECTL} get pods -n ${RANCHER_CHART_TARGETNAMESPACE} -l app=rancher -o name) --timeout=10s; do sleep 2 ; done\n"
"until ${KUBECTL} get ingress -n ${RANCHER_CHART_TARGETNAMESPACE} rancher > /dev/null 2>&1; do sleep 10; done\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:121
#, no-wrap
msgid ""
"RANCHERBOOTSTRAPPASSWORD=$(${KUBECTL} get secret -n ${RANCHER_CHART_TARGETNAMESPACE} bootstrap-secret -o jsonpath='{.data.bootstrapPassword}' | base64 -d)\n"
"RANCHERHOSTNAME=$(${KUBECTL} get ingress -n ${RANCHER_CHART_TARGETNAMESPACE} rancher -o jsonpath='{.spec.rules[0].host}')\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:122
#, no-wrap
msgid ""
"# Skip the whole process if things have been set already\n"
"if [ -z $(${KUBECTL} get settings.management.cattle.io first-login -ojsonpath='{.value}') ]; then\n"
"  # Add the protocol\n"
"  RANCHERHOSTNAME=\"https://${RANCHERHOSTNAME}\"\n"
"  TOKEN=\"\"\n"
"  while [ -z \"${TOKEN}\" ]; do\n"
"    # Get token\n"
"    sleep 2\n"
"    TOKEN=$(curl -sk -X POST ${RANCHERHOSTNAME}/v3-public/localProviders/local?action=login -H 'content-type: application/json' -d \"{\\\"username\\\":\\\"admin\\\",\\\"password\\\":\\\"${RANCHERBOOTSTRAPPASSWORD}\\\"}\" | jq -r .token)\n"
"  done\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:123
#, no-wrap
msgid ""
"  # Set password\n"
"  curl -sk ${RANCHERHOSTNAME}/v3/users?action=changepassword -H 'content-type: application/json' -H \"Authorization: Bearer $TOKEN\" -d \"{\\\"currentPassword\\\":\\\"${RANCHERBOOTSTRAPPASSWORD}\\\",\\\"newPassword\\\":\\\"${RANCHER_FINALPASSWORD}\\\"}\"\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:124
#, no-wrap
msgid ""
"  # Create a temporary API token (ttl=60 minutes)\n"
"  APITOKEN=$(curl -sk ${RANCHERHOSTNAME}/v3/token -H 'content-type: application/json' -H \"Authorization: Bearer ${TOKEN}\" -d '{\"type\":\"token\",\"description\":\"automation\",\"ttl\":3600000}' | jq -r .token)\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:125
#, no-wrap
msgid ""
"  curl -sk ${RANCHERHOSTNAME}/v3/settings/server-url -H 'content-type: application/json' -H \"Authorization: Bearer ${APITOKEN}\" -X PUT -d \"{\\\"name\\\":\\\"server-url\\\",\\\"value\\\":\\\"${RANCHERHOSTNAME}\\\"}\"\n"
"  curl -sk ${RANCHERHOSTNAME}/v3/settings/telemetry-opt -X PUT -H 'content-type: application/json' -H 'accept: application/json' -H \"Authorization: Bearer ${APITOKEN}\" -d '{\"value\":\"out\"}'\n"
"fi\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:126
#, no-wrap
msgid ""
"# Clean up the lock cm\n"
"${KUBECTL} delete configmap ${RANCHERLOCKCMNAME} -n ${RANCHERLOCKNAMESPACE}\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:127
msgid ""
"`mgmt-stack-setup.service`: contains the configuration to create the systemd "
"service to run the scripts during the first boot (no modifications needed)."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:128
#, no-wrap
msgid ""
"[Unit]\n"
"Description=Setup Management stack components\n"
"Wants=network-online.target\n"
"# It requires rke2 or k3s running, but it will not fail if those services are not present\n"
"After=network.target network-online.target rke2-server.service k3s.service\n"
"# At least, the basic-setup.sh one needs to be present\n"
"ConditionPathExists=/opt/mgmt/bin/basic-setup.sh\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:129
#, no-wrap
msgid ""
"[Service]\n"
"User=root\n"
"Type=forking\n"
"# Metal3 can take A LOT to download the IPA image\n"
"TimeoutStartSec=1800\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:130
#, no-wrap
msgid ""
"ExecStartPre=/bin/sh -c \"echo 'Setting up Management components...'\"\n"
"# Scripts are executed in StartPre because Start can only run a single on\n"
"ExecStartPre=/opt/mgmt/bin/rancher.sh\n"
"ExecStartPre=/opt/mgmt/bin/metal3.sh\n"
"ExecStart=/bin/sh -c \"echo 'Finished setting up Management components'\"\n"
"RemainAfterExit=yes\n"
"KillMode=process\n"
"# Disable & delete everything\n"
"ExecStartPost=rm -f /opt/mgmt/bin/rancher.sh\n"
"ExecStartPost=rm -f /opt/mgmt/bin/metal3.sh\n"
"ExecStartPost=rm -f /opt/mgmt/bin/basic-setup.sh\n"
"ExecStartPost=/bin/sh -c \"systemctl disable mgmt-stack-setup.service\"\n"
"ExecStartPost=rm -f /etc/systemd/system/mgmt-stack-setup.service\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:131
#, no-wrap
msgid ""
"[Install]\n"
"WantedBy=multi-user.target\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:132
msgid "The `custom/scripts` folder contains the following files:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:133
msgid ""
"`99-alias.sh` script: contains the alias to be used by the management "
"cluster to load the kubeconfig file at first boot (no modifications needed)."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:134
#, no-wrap
msgid ""
"#!/bin/bash\n"
"echo \"alias k=kubectl\" >> /etc/profile.local\n"
"echo \"alias kubectl=/var/lib/rancher/rke2/bin/kubectl\" >> /etc/profile.local\n"
"echo \"export KUBECONFIG=/etc/rancher/rke2/rke2.yaml\" >> /etc/profile.local\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:135
msgid ""
"`99-mgmt-setup.sh` script: contains the configuration to copy the scripts "
"during the first boot (no modifications needed)."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:137
#: asciidoc/product/atip-management-cluster.adoc:210
#, no-wrap
msgid ""
"# Copy the scripts from combustion to the final location\n"
"mkdir -p /opt/mgmt/bin/\n"
"for script in basic-setup.sh rancher.sh metal3.sh; do\n"
"\tcp ${script} /opt/mgmt/bin/\n"
"done\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:138
#: asciidoc/product/atip-management-cluster.adoc:211
#, no-wrap
msgid ""
"# Copy the systemd unit file and enable it at boot\n"
"cp mgmt-stack-setup.service /etc/systemd/system/mgmt-stack-setup.service\n"
"systemctl enable mgmt-stack-setup.service\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:139
msgid ""
"`99-register.sh` script: contains the configuration to register the system "
"using the SCC registration code. The `$\\{SCC_ACCOUNT_EMAIL\\}` and `$"
"\\{SCC_REGISTRATION_CODE\\}` have to be set properly to register the system "
"with your account."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:141
#, no-wrap
msgid ""
"# Registration https://www.suse.com/support/kb/doc/?id=000018564\n"
"if ! which SUSEConnect > /dev/null 2>&1; then\n"
"\tzypper --non-interactive install suseconnect-ng\n"
"fi\n"
"SUSEConnect --email \"${SCC_ACCOUNT_EMAIL}\" --url \"https://scc.suse.com\" --regcode \"${SCC_REGISTRATION_CODE}\"\n"
msgstr ""

#. type: Title ====
#: asciidoc/product/atip-management-cluster.adoc:142
#, no-wrap
msgid "Kubernetes folder"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:143
msgid "The `kubernetes` folder contains the following subfolders:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:144
#, no-wrap
msgid ""
"...\n"
"├── kubernetes\n"
"│ ├── manifests\n"
"│ │ ├── rke2-ingress-config.yaml\n"
"│ │ ├── neuvector-namespace.yaml\n"
"│ │ ├── ingress-l2-adv.yaml\n"
"│ │ └── ingress-ippool.yaml\n"
"│ ├── helm\n"
"│ │ └── values\n"
"│ │     ├── rancher.yaml\n"
"│ │     ├── neuvector.yaml\n"
"│ │     ├── metal3.yaml\n"
"│ │     └── certmanager.yaml\n"
"│ └── config\n"
"│     └── server.yaml\n"
"...\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:145
msgid "The `kubernetes/config` folder contains the following files:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:146
msgid ""
"`server.yaml`: By default, the `CNI` plug-in installed by default is "
"`Cilium`, so you do not need to create this folder and file. Just in case "
"you need to customize the `CNI` plug-in, you can use the `server.yaml` file "
"under the `kubernetes/config` folder. It contains the following information:"
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-management-cluster.adoc:148
msgid ""
"This is an optional file to define certain Kubernetes customization, like "
"the CNI plug-ins to be used or many options you can check in the https://"
"docs.rke2.io/install/configuration[official documentation]."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:149
msgid "The `kubernetes/manifests` folder contains the following files:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:150
msgid ""
"`rke2-ingress-config.yaml`: contains the configuration to create the "
"`Ingress` service for the management cluster (no modifications needed)."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:151
#, no-wrap
msgid ""
"apiVersion: helm.cattle.io/v1\n"
"kind: HelmChartConfig\n"
"metadata:\n"
"  name: rke2-ingress-nginx\n"
"  namespace: kube-system\n"
"spec:\n"
"  valuesContent: |-\n"
"    controller:\n"
"      config:\n"
"        use-forwarded-headers: \"true\"\n"
"        enable-real-ip: \"true\"\n"
"      publishService:\n"
"        enabled: true\n"
"      service:\n"
"        enabled: true\n"
"        type: LoadBalancer\n"
"        externalTrafficPolicy: Local\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:152
msgid ""
"`neuvector-namespace.yaml`: contains the configuration to create the "
"`NeuVector` namespace (no modifications needed)."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:153
#, no-wrap
msgid ""
"apiVersion: v1\n"
"kind: Namespace\n"
"metadata:\n"
"  labels:\n"
"    pod-security.kubernetes.io/enforce: privileged\n"
"  name: neuvector\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:154
msgid ""
"`ingress-l2-adv.yaml`: contains the configuration to create the "
"`L2Advertisement` for the `MetalLB` component (no modifications needed)."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:155
#, no-wrap
msgid ""
"apiVersion: metallb.io/v1beta1\n"
"kind: L2Advertisement\n"
"metadata:\n"
"  name: ingress-l2-adv\n"
"  namespace: metallb-system\n"
"spec:\n"
"  ipAddressPools:\n"
"    - ingress-ippool\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:156
msgid ""
"`ingress-ippool.yaml`: contains the configuration to create the "
"`IPAddressPool` for the `rke2-ingress-nginx` component. The `$"
"\\{INGRESS_VIP\\}` has to be set properly to define the IP address reserved "
"to be used by the `rke2-ingress-nginx` component."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:157
#, no-wrap
msgid ""
"apiVersion: metallb.io/v1beta1\n"
"kind: IPAddressPool\n"
"metadata:\n"
"  name: ingress-ippool\n"
"  namespace: metallb-system\n"
"spec:\n"
"  addresses:\n"
"    - ${INGRESS_VIP}/32\n"
"  serviceAllocation:\n"
"    priority: 100\n"
"    serviceSelectors:\n"
"      - matchExpressions:\n"
"          - {key: app.kubernetes.io/name, operator: In, values: [rke2-ingress-nginx]}\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:158
msgid "The `kubernetes/helm/values` folder contains the following files:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:159
msgid ""
"`rancher.yaml`: contains the configuration to create the `Rancher` "
"component. The `$\\{INGRESS_VIP\\}` must be set properly to define the IP "
"address to be consumed by the `Rancher` component. The URL to access the "
"`Rancher` component will be `https://rancher-$\\{INGRESS_VIP\\}.sslip.io`."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:160
#, no-wrap
msgid ""
"hostname: rancher-${INGRESS_VIP}.sslip.io\n"
"bootstrapPassword: \"foobar\"\n"
"replicas: 1\n"
"global.cattle.psp.enabled: \"false\"\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:161
msgid ""
"`neuvector.yaml`: contains the configuration to create the `NeuVector` "
"component (no modifications needed)."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:162
#, no-wrap
msgid ""
"controller:\n"
"  replicas: 1\n"
"  ranchersso:\n"
"    enabled: true\n"
"manager:\n"
"  enabled: false\n"
"cve:\n"
"  scanner:\n"
"    enabled: false\n"
"    replicas: 1\n"
"k3s:\n"
"  enabled: true\n"
"crdwebhook:\n"
"  enabled: false\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:163
msgid ""
"`metal3.yaml`: contains the configuration to create the `Metal^3^` "
"component. The `$\\{METAL3_VIP\\}` must be set properly to define the IP "
"address to be consumed by the `Metal^3^` component."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:164
#, no-wrap
msgid ""
"global:\n"
"  ironicIP: ${METAL3_VIP}\n"
"  enable_vmedia_tls: false\n"
"  additionalTrustedCAs: false\n"
"metal3-ironic:\n"
"  global:\n"
"    predictableNicNames: \"true\"\n"
"  persistence:\n"
"    ironic:\n"
"      size: \"5Gi\"\n"
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-management-cluster.adoc:165
msgid ""
"The Media Server is an optional feature included in Metal^3^ (by default is "
"disabled). To use the Metal3 feature, you need to configure it on the "
"previous manifest.  To use the Metal^3^ media server, specify the following "
"variable:"
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-management-cluster.adoc:166
msgid ""
"add the `enable_metal3_media_server` to `true` to enable the media server "
"feature in the global section."
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-management-cluster.adoc:167
msgid ""
"include the following configuration about the media server where $"
"\\{MEDIA_VOLUME_PATH\\} is the path to the media volume in the media (e.g `/"
"home/metal3/bmh-image-cache`)"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:168
#, no-wrap
msgid ""
"metal3-media:\n"
"  mediaVolume:\n"
"    hostPath: ${MEDIA_VOLUME_PATH}\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:169
msgid ""
"An external media server can be used to store the images, and in the case "
"you want to use it with TLS, you will need to modify the following "
"configurations:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:170
msgid ""
"set to `true` the `additionalTrustedCAs` in the previous `metal3.yaml` file "
"to enable the additional trusted CAs from the external media server."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:171
msgid ""
"include the following secret configuration in the folder `kubernetes/"
"manifests/metal3-cacert-secret.yaml` to store the CA certificate of the "
"external media server."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:172
#, no-wrap
msgid ""
"apiVersion: v1\n"
"kind: Namespace\n"
"metadata:\n"
"  name: metal3-system\n"
"---\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:173
#, no-wrap
msgid ""
"apiVersion: v1\n"
"kind: Secret\n"
"metadata:\n"
"  name: tls-ca-additional\n"
"  namespace: metal3-system\n"
"type: Opaque\n"
"data:\n"
"  ca-additional.crt: {{ additional_ca_cert | b64encode }}\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:174
msgid ""
"The `additional_ca_cert` is the base64-encoded CA certificate of the "
"external media server. You can use the following command to encode the "
"certificate and generate the secret doing manually:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:175
#, no-wrap
msgid "kubectl -n meta3-system create secret generic tls-ca-additional --from-file=ca-additional.crt=./ca-additional.crt\n"
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-management-cluster.adoc:176
msgid ""
"`certmanager.yaml`: contains the configuration to create the `Cert-Manager` "
"component (no modifications needed)."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:177
#, no-wrap
msgid "installCRDs: \"true\"\n"
msgstr ""

#. type: Title ====
#: asciidoc/product/atip-management-cluster.adoc:178
#, no-wrap
msgid "Networking folder"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:179
msgid ""
"The `network` folder contains as many files as nodes in the management "
"cluster. In our case, we have only one node, so we have only one file called "
"`mgmt-cluster-node1.yaml`.  The name of the file must match the host name "
"defined in the `mgmt-cluster.yaml` definition file into the network/node "
"section described above."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:180
msgid ""
"If you need to customize the networking configuration, for example, to use a "
"specific static IP address (DHCP-less scenario), you can use the `mgmt-"
"cluster-node1.yaml` file under the `network` folder. It contains the "
"following information:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:181
msgid "`$\\{MGMT_GATEWAY\\}`: The gateway IP address."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:182
msgid "`$\\{MGMT_DNS\\}`: The DNS server IP address."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:183
msgid "`$\\{MGMT_MAC\\}`: The MAC address of the network interface."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:184
msgid "`$\\{MGMT_NODE_IP\\}`: The IP address of the management cluster."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:185
#, no-wrap
msgid ""
"routes:\n"
"  config:\n"
"  - destination: 0.0.0.0/0\n"
"    metric: 100\n"
"    next-hop-address: ${MGMT_GATEWAY}\n"
"    next-hop-interface: eth0\n"
"    table-id: 254\n"
"dns-resolver:\n"
"  config:\n"
"    server:\n"
"    - ${MGMT_DNS}\n"
"    - 8.8.8.8\n"
"interfaces:\n"
"- name: eth0\n"
"  type: ethernet\n"
"  state: up\n"
"  mac-address: ${MGMT_MAC}\n"
"  ipv4:\n"
"    address:\n"
"    - ip: ${MGMT_NODE_IP}\n"
"      prefix-length: 24\n"
"    dhcp: false\n"
"    enabled: true\n"
"  ipv6:\n"
"    enabled: false\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:186
msgid ""
"If you want to use DHCP to get the IP address, you can use the following "
"configuration (the `MAC` address must be set properly using the `$"
"\\{MGMT_MAC\\}` variable):"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:187
#, no-wrap
msgid ""
"## This is an example of a dhcp network configuration for a management cluster\n"
"## interfaces:\n"
"- name: eth0\n"
"  type: ethernet\n"
"  state: up\n"
"  mac-address: ${MGMT_MAC}\n"
"  ipv4:\n"
"    dhcp: true\n"
"    enabled: true\n"
"  ipv6:\n"
"    enabled: false\n"
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-management-cluster.adoc:188
msgid ""
"Depending on the number of nodes in the management cluster, you can create "
"more files like `mgmt-cluster-node2.yaml`, `mgmt-cluster-node3.yaml`, etc. "
"to configure the rest of the nodes."
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-management-cluster.adoc:189
msgid ""
"The `routes` section is used to define the routing table for the management "
"cluster."
msgstr ""

#. type: Title ===
#: asciidoc/product/atip-management-cluster.adoc:190
#, no-wrap
msgid "Image preparation for air-gap environments"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:191
msgid ""
"This section describes how to prepare the image for air-gap environments "
"showing only the differences from the previous sections. The following "
"changes to the previous section (xref:mgmt-cluster-image-preparation-"
"connected[Image preparation for connected environments]) are required to "
"prepare the image for air-gap environments:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:192
msgid ""
"The `mgmt-cluster.yaml` file must be modified to include the "
"`embeddedArtifactRegistry` section with the `images` field set to all "
"container images to be included into the EIB output image."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:193
msgid ""
"The `custom/scripts/99-register.sh` script must be removed when use an air-"
"gap environment."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:194
msgid ""
"The `custom/files/airgap-resources.tar.gz` file must be included in the "
"`custom/files` folder with all the resources needed to run the management "
"cluster in an air-gap environment."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:195
msgid ""
"The `custom/scripts/99-mgmt-setup.sh` script must be modified to extract and "
"copy the `airgap-resources.tar.gz` file to the final location."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:196
msgid ""
"The `custom/files/metal3.sh` script must be modified to use the local "
"resources included in the `airgap-resources.tar.gz` file instead of "
"downloading them from the internet."
msgstr ""

#. type: Title ====
#: asciidoc/product/atip-management-cluster.adoc:197
#, no-wrap
msgid "Directory structure for air-gap environments"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:198
msgid ""
"The directory structure for air-gap environments is the same as for "
"connected environments, with the differences explained as follows:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:199
#, no-wrap
msgid ""
"eib\n"
"|-- base-images\n"
"|   |-- SLE-Micro.x86_64-5.5.0-Default-SelfInstall-GM2.install.iso\n"
"|-- custom\n"
"|   |-- files\n"
"|   |   |-- airgap-resources.tar.gz\n"
"|   |   |-- basic-setup.sh\n"
"|   |   |-- metal3.sh\n"
"|   |   |-- mgmt-stack-setup.service\n"
"|   |   |-- rancher.sh\n"
"|   |-- scripts\n"
"|       |-- 99-alias.sh\n"
"|       |-- 99-mgmt-setup.sh\n"
"|-- kubernetes\n"
"|   |-- config\n"
"|   |   |-- server.yaml\n"
"|   |-- helm\n"
"|   |   |-- values\n"
"|   |       |-- certmanager.yaml\n"
"|   |       |-- metal3.yaml\n"
"|   |       |-- neuvector.yaml\n"
"|   |       |-- rancher.yaml\n"
"|   |-- manifests\n"
"|       |-- neuvector-namespace.yaml\n"
"|-- mgmt-cluster.yaml\n"
"|-- network\n"
"    |-- mgmt-cluster-network.yaml\n"
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-management-cluster.adoc:200
msgid ""
"The image `SLE-Micro.x86_64-5.5.0-Default-SelfInstall-GM2.install.iso` must "
"be downloaded from the https://scc.suse.com/[SUSE Customer Center] or the "
"https://www.suse.com/download/sle-micro/[SUSE Download page], and it must be "
"located under the `base-images` folder before starting with the process."
msgstr ""

#. type: Title ====
#: asciidoc/product/atip-management-cluster.adoc:203
#, no-wrap
msgid "Modifications in the definition file"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:204
msgid ""
"The `mgmt-cluster.yaml` file must be modified to include the "
"`embeddedArtifactRegistry` section with the `images` field set to all "
"container images to be included into the EIB output image. The `images` "
"field must contain the list of all container images to be included in the "
"output image. The following is an example of the `mgmt-cluster.yaml` file "
"with the `embeddedArtifactRegistry` section included:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:205
#, no-wrap
msgid ""
"apiVersion: 1.0\n"
"image:\n"
"  imageType: iso\n"
"  arch: x86_64\n"
"  baseImage: SLE-Micro.x86_64-5.5.0-Default-SelfInstall-GM2.install.iso\n"
"  outputImageName: eib-mgmt-cluster-image.iso\n"
"operatingSystem:\n"
"  isoConfiguration:\n"
"    installDevice: /dev/sda\n"
"  users:\n"
"  - username: root\n"
"    encryptedPassword: ${ROOT_PASSWORD}\n"
"  packages:\n"
"    packageList:\n"
"    - jq\n"
"    sccRegistrationCode: ${SCC_REGISTRATION_CODE}\n"
"kubernetes:\n"
"  version: ${KUBERNETES_VERSION}\n"
"  helm:\n"
"    charts:\n"
"      - name: cert-manager\n"
"        repositoryName: jetstack\n"
"        version: 1.14.2\n"
"        targetNamespace: cert-manager\n"
"        valuesFile: certmanager.yaml\n"
"        createNamespace: true\n"
"        installationNamespace: kube-system\n"
"      - name: longhorn-crd\n"
"        version: 103.3.0+up1.6.1\n"
"        repositoryName: rancher-charts\n"
"        targetNamespace: longhorn-system\n"
"        createNamespace: true\n"
"        installationNamespace: kube-system\n"
"      - name: longhorn\n"
"        version: 103.3.0+up1.6.1\n"
"        repositoryName: rancher-charts\n"
"        targetNamespace: longhorn-system\n"
"        createNamespace: true\n"
"        installationNamespace: kube-system\n"
"      - name: metal3-chart\n"
"        version: 0.7.1\n"
"        repositoryName: suse-edge-charts\n"
"        targetNamespace: metal3-system\n"
"        createNamespace: true\n"
"        installationNamespace: kube-system\n"
"        valuesFile: metal3.yaml\n"
"      - name: neuvector-crd\n"
"        version: 103.0.3+up2.7.6\n"
"        repositoryName: rancher-charts\n"
"        targetNamespace: neuvector\n"
"        createNamespace: true\n"
"        installationNamespace: kube-system\n"
"        valuesFile: neuvector.yaml\n"
"      - name: neuvector\n"
"        version: 103.0.3+up2.7.6\n"
"        repositoryName: rancher-charts\n"
"        targetNamespace: neuvector\n"
"        createNamespace: true\n"
"        installationNamespace: kube-system\n"
"        valuesFile: neuvector.yaml\n"
"      - name: rancher\n"
"        version: 2.8.4\n"
"        repositoryName: rancher-prime\n"
"        targetNamespace: cattle-system\n"
"        createNamespace: true\n"
"        installationNamespace: kube-system\n"
"        valuesFile: rancher.yaml\n"
"    repositories:\n"
"      - name: jetstack\n"
"        url: https://charts.jetstack.io\n"
"      - name: rancher-charts\n"
"        url: https://charts.rancher.io/\n"
"      - name: suse-edge-charts\n"
"        url: oci://registry.suse.com/edge\n"
"      - name: rancher-prime\n"
"        url: https://charts.rancher.com/server-charts/prime\n"
"    network:\n"
"      apiHost: ${API_HOST}\n"
"      apiVIP: ${API_VIP}\n"
"    nodes:\n"
"      - hostname: mgmt-cluster-node1\n"
"        initializer: true\n"
"        type: server\n"
"#     - hostname: mgmt-cluster-node2\n"
"#       initializer: true\n"
"#       type: server\n"
"#     - hostname: mgmt-cluster-node3\n"
"#       initializer: true\n"
"#       type: server\n"
"embeddedArtifactRegistry:\n"
"  images:\n"
"    - name: registry.rancher.com/rancher/backup-restore-operator:v4.0.2\n"
"    - name: registry.rancher.com/rancher/calico-cni:v3.27.0-rancher1\n"
"    - name: registry.rancher.com/rancher/cis-operator:v1.0.13\n"
"    - name: registry.rancher.com/rancher/coreos-kube-state-metrics:v1.9.7\n"
"    - name: registry.rancher.com/rancher/coreos-prometheus-config-reloader:v0.38.1\n"
"    - name: registry.rancher.com/rancher/coreos-prometheus-operator:v0.38.1\n"
"    - name: registry.rancher.com/rancher/flannel-cni:v0.3.0-rancher9\n"
"    - name: registry.rancher.com/rancher/fleet-agent:v0.9.4\n"
"    - name: registry.rancher.com/rancher/fleet:v0.9.4\n"
"    - name: registry.rancher.com/rancher/gitjob:v0.9.7\n"
"    - name: registry.rancher.com/rancher/grafana-grafana:7.1.5\n"
"    - name: registry.rancher.com/rancher/hardened-addon-resizer:1.8.20-build20240410\n"
"    - name: registry.rancher.com/rancher/hardened-calico:v3.27.3-build20240423\n"
"    - name: registry.rancher.com/rancher/hardened-cluster-autoscaler:v1.8.10-build20240124\n"
"    - name: registry.rancher.com/rancher/hardened-cni-plugins:v1.4.1-build20240325\n"
"    - name: registry.rancher.com/rancher/hardened-coredns:v1.11.1-build20240305\n"
"    - name: registry.rancher.com/rancher/hardened-dns-node-cache:1.22.28-build20240125\n"
"    - name: registry.rancher.com/rancher/hardened-etcd:v3.5.9-k3s1-build20240418\n"
"    - name: registry.rancher.com/rancher/hardened-flannel:v0.25.1-build20240423\n"
"    - name: registry.rancher.com/rancher/hardened-k8s-metrics-server:v0.7.1-build20240401\n"
"    - name: registry.rancher.com/rancher/hardened-kubernetes:v1.28.9-rke2r1-build20240416\n"
"    - name: registry.rancher.com/rancher/hardened-multus-cni:v4.0.2-build20240208\n"
"    - name: registry.rancher.com/rancher/hardened-node-feature-discovery:v0.14.1-build20230926\n"
"    - name: registry.rancher.com/rancher/hardened-whereabouts:v0.6.3-build20240208\n"
"    - name: registry.rancher.com/rancher/helm-project-operator:v0.2.1\n"
"    - name: registry.rancher.com/rancher/istio-kubectl:1.5.10\n"
"    - name: registry.rancher.com/rancher/jimmidyson-configmap-reload:v0.3.0\n"
"    - name: registry.rancher.com/rancher/k3s-upgrade:v1.28.9-k3s1\n"
"    - name: registry.rancher.com/rancher/klipper-helm:v0.8.3-build20240228\n"
"    - name: registry.rancher.com/rancher/klipper-lb:v0.4.7\n"
"    - name: registry.rancher.com/rancher/kube-api-auth:v0.2.1\n"
"    - name: registry.rancher.com/rancher/kubectl:v1.28.7\n"
"    - name: registry.rancher.com/rancher/library-nginx:1.19.2-alpine\n"
"    - name: registry.rancher.com/rancher/local-path-provisioner:v0.0.26\n"
"    - name: registry.rancher.com/rancher/machine:v0.15.0-rancher112\n"
"    - name: registry.rancher.com/rancher/mirrored-cluster-api-controller:v1.4.4\n"
"    - name: registry.rancher.com/rancher/nginx-ingress-controller:nginx-1.9.6-rancher1\n"
"    - name: registry.rancher.com/rancher/pause:3.6\n"
"    - name: registry.rancher.com/rancher/prom-alertmanager:v0.21.0\n"
"    - name: registry.rancher.com/rancher/prom-node-exporter:v1.0.1\n"
"    - name: registry.rancher.com/rancher/prom-prometheus:v2.18.2\n"
"    - name: registry.rancher.com/rancher/prometheus-auth:v0.2.2\n"
"    - name: registry.rancher.com/rancher/prometheus-federator:v0.3.4\n"
"    - name: registry.rancher.com/rancher/pushprox-client:v0.1.0-rancher2-client\n"
"    - name: registry.rancher.com/rancher/pushprox-proxy:v0.1.0-rancher2-proxy\n"
"    - name: registry.rancher.com/rancher/rancher-agent:v2.8.4\n"
"    - name: registry.rancher.com/rancher/rancher-csp-adapter:v3.0.1\n"
"    - name: registry.rancher.com/rancher/rancher-webhook:v0.4.5\n"
"    - name: registry.rancher.com/rancher/rancher:v2.8.4\n"
"    - name: registry.rancher.com/rancher/rke-tools:v0.1.96\n"
"    - name: registry.rancher.com/rancher/rke2-cloud-provider:v1.29.3-build20240412\n"
"    - name: registry.rancher.com/rancher/rke2-runtime:v1.28.9-rke2r1\n"
"    - name: registry.rancher.com/rancher/rke2-upgrade:v1.28.9-rke2r1\n"
"    - name: registry.rancher.com/rancher/security-scan:v0.2.15\n"
"    - name: registry.rancher.com/rancher/shell:v0.1.24\n"
"    - name: registry.rancher.com/rancher/system-agent-installer-k3s:v1.28.9-k3s1\n"
"    - name: registry.rancher.com/rancher/system-agent-installer-rke2:v1.28.9-rke2r1\n"
"    - name: registry.rancher.com/rancher/system-agent:v0.3.6-suc\n"
"    - name: registry.rancher.com/rancher/system-upgrade-controller:v0.13.1\n"
"    - name: registry.rancher.com/rancher/ui-plugin-catalog:1.3.0\n"
"    - name: registry.rancher.com/rancher/ui-plugin-operator:v0.1.1\n"
"    - name: registry.rancher.com/rancher/webhook-receiver:v0.2.5\n"
"    - name: registry.rancher.com/rancher/kubectl:v1.20.2\n"
"    - name: registry.rancher.com/rancher/mirrored-longhornio-csi-attacher:v4.4.2\n"
"    - name: registry.rancher.com/rancher/mirrored-longhornio-csi-provisioner:v3.6.2\n"
"    - name: registry.rancher.com/rancher/mirrored-longhornio-csi-resizer:v1.9.2\n"
"    - name: registry.rancher.com/rancher/mirrored-longhornio-csi-snapshotter:v6.3.2\n"
"    - name: registry.rancher.com/rancher/mirrored-longhornio-csi-node-driver-registrar:v2.9.2\n"
"    - name: registry.rancher.com/rancher/mirrored-longhornio-livenessprobe:v2.12.0\n"
"    - name: registry.rancher.com/rancher/mirrored-longhornio-backing-image-manager:v1.6.1\n"
"    - name: registry.rancher.com/rancher/mirrored-longhornio-longhorn-engine:v1.6.1\n"
"    - name: registry.rancher.com/rancher/mirrored-longhornio-longhorn-instance-manager:v1.6.1\n"
"    - name: registry.rancher.com/rancher/mirrored-longhornio-longhorn-manager:v1.6.1\n"
"    - name: registry.rancher.com/rancher/mirrored-longhornio-longhorn-share-manager:v1.6.1\n"
"    - name: registry.rancher.com/rancher/mirrored-longhornio-longhorn-ui:v1.6.1\n"
"    - name: registry.rancher.com/rancher/mirrored-longhornio-support-bundle-kit:v0.0.36\n"
"    - name: registry.suse.com/edge/cluster-api-provider-rke2-bootstrap:v0.2.6\n"
"    - name: registry.suse.com/edge/cluster-api-provider-rke2-controlplane:v0.2.6\n"
"    - name: registry.suse.com/edge/cluster-api-controller:v1.6.2\n"
"    - name: registry.suse.com/edge/cluster-api-provider-metal3:v1.6.0\n"
"    - name: registry.suse.com/edge/ip-address-manager:v1.6.0\n"
msgstr ""

#. type: Title ====
#: asciidoc/product/atip-management-cluster.adoc:206
#, no-wrap
msgid "Modifications in the custom folder"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:207
msgid ""
"The `custom/scripts/99-register.sh` script must be removed when using an air-"
"gap environment. As you can see in the directory structure, the `99-register."
"sh` script is not included in the `custom/scripts` folder."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:208
msgid ""
"The `custom/scripts/99-mgmt-setup.sh` script must be modified to extract and "
"copy the `airgap-resources.tar.gz` file to the final location. The following "
"is an example of the `99-mgmt-setup.sh` script with the modifications to "
"extract and copy the `airgap-resources.tar.gz` file:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:212
#, no-wrap
msgid ""
"# Extract the airgap resources\n"
"tar zxf airgap-resources.tar.gz\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:213
#, no-wrap
msgid ""
"# Copy the clusterctl binary to the final location\n"
"cp airgap-resources/clusterctl /opt/mgmt/bin/ && chmod +x /opt/mgmt/bin/clusterctl\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:214
#, no-wrap
msgid ""
"# Copy the clusterctl.yaml and override\n"
"mkdir -p /root/cluster-api\n"
"cp -r airgap-resources/clusterctl.yaml airgap-resources/overrides /root/cluster-api/\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:215
msgid ""
"The `custom/files/metal3.sh` script must be modified to use the local "
"resources included in the `airgap-resources.tar.gz` file instead of "
"downloading them from the internet. The following is an example of the "
"`metal3.sh` script with the modifications to use the local resources:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:226
#, no-wrap
msgid ""
"  # Try this command 3 times just in case, stolen from https://stackoverflow.com/a/33354419\n"
"  if ! (r=3; while ! /opt/mgmt/bin/clusterctl init \\\n"
"    --core \"cluster-api:v${METAL3_CAPICOREVERSION}\"\\\n"
"    --infrastructure \"metal3:v${METAL3_CAPIMETAL3VERSION}\"\\\n"
"    --bootstrap \"${METAL3_CAPIPROVIDER}:v${METAL3_CAPIRKE2VERSION}\"\\\n"
"    --control-plane \"${METAL3_CAPIPROVIDER}:v${METAL3_CAPIRKE2VERSION}\"\\\n"
"    --config /root/cluster-api/clusterctl.yaml ; do\n"
"            ((--r))||exit\n"
"            echo \"Something went wrong, let's wait 10 seconds and retry\"\n"
"            sleep 10;done) ; then\n"
"      echo \"clusterctl failed\"\n"
"      exit 1\n"
"  fi\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:234
msgid ""
"The `custom/files/airgap-resources.tar.gz` file must be included in the "
"`custom/files` folder with all the resources needed to run the management "
"cluster in an air-gap environment. This file must be prepared manually "
"downloading all resources and compressing them into this single file. The "
"`airgap-resources.tar.gz` file contains the following resources:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:235
#, no-wrap
msgid ""
"|-- clusterctl\n"
"|-- clusterctl.yaml\n"
"|-- overrides\n"
"    |-- bootstrap-rke2\n"
"    |   |-- v0.2.6\n"
"    |       |-- bootstrap-components.yaml\n"
"    |       |-- metadata.yaml\n"
"    |-- cluster-api\n"
"    |   |-- v1.6.2\n"
"    |       |-- core-components.yaml\n"
"    |       |-- metadata.yaml\n"
"    |-- control-plane-rke2\n"
"    |   |-- v0.2.6\n"
"    |       |-- control-plane-components.yaml\n"
"    |       |-- metadata.yaml\n"
"    |-- infrastructure-metal3\n"
"        |-- v1.6.0\n"
"            |-- cluster-template.yaml\n"
"            |-- infrastructure-components.yaml\n"
"            |-- metadata.yaml\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:236
msgid ""
"The `clusterctl.yaml` file contains the configuration to specify the images "
"location and the overrides to be used by the `clusterctl` tool. The "
"`overrides` folder contains `yaml` file manifests to be used instead of "
"downloading them from the internet."
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:237
#, no-wrap
msgid ""
"providers:\n"
"  # override a pre-defined provider\n"
"  - name: \"cluster-api\"\n"
"    url: \"/root/cluster-api/overrides/cluster-api/v1.6.2/core-components.yaml\"\n"
"    type: \"CoreProvider\"\n"
"  - name: \"metal3\"\n"
"    url: \"/root/cluster-api/overrides/infrastructure-metal3/v1.6.0/infrastructure-components.yaml\"\n"
"    type: \"InfrastructureProvider\"\n"
"  - name: \"rke2\"\n"
"    url: \"/root/cluster-api/overrides/bootstrap-rke2/v0.2.6/bootstrap-components.yaml\"\n"
"    type: \"BootstrapProvider\"\n"
"  - name: \"rke2\"\n"
"    url: \"/root/cluster-api/overrides/control-plane-rke2/v0.2.6/control-plane-components.yaml\"\n"
"    type: \"ControlPlaneProvider\"\n"
"images:\n"
"  all:\n"
"    repository: registry.suse.com/edge\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:238
msgid ""
"The `clusterctl` and the rest of the files included in the `overrides` "
"folder can be downloaded using the following curls commands:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:239
#, no-wrap
msgid ""
"# clusterctl binary\n"
"curl -L https://github.com/kubernetes-sigs/cluster-api/releases/download/1.6.2/clusterctl-linux-${GOARCH} -o /usr/local/bin/clusterct\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:240
#, no-wrap
msgid ""
"# boostrap-components (boostrap-rke2)\n"
"curl -L https://github.com/rancher-sandbox/cluster-api-provider-rke2/releases/download/v0.2.6/bootstrap-components.yaml\n"
"curl -L https://github.com/rancher-sandbox/cluster-api-provider-rke2/releases/download/v0.2.6/metadata.yaml\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:241
#, no-wrap
msgid ""
"# control-plane-components (control-plane-rke2)\n"
"curl -L https://github.com/rancher-sandbox/cluster-api-provider-rke2/releases/download/v0.2.6/control-plane-components.yaml\n"
"curl -L https://github.com/rancher-sandbox/cluster-api-provider-rke2/releases/download/v0.2.6/metadata.yaml\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:242
#, no-wrap
msgid ""
"# cluster-api components\n"
"curl -L https://github.com/kubernetes-sigs/cluster-api/releases/download/v1.6.2/core-components.yaml\n"
"curl -L https://github.com/kubernetes-sigs/cluster-api/releases/download/v1.6.2/metadata.yaml\n"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:243
#, no-wrap
msgid ""
"# infrastructure-components (infrastructure-metal3)\n"
"curl -L https://github.com/metal3-io/cluster-api-provider-metal3/releases/download/v1.6.0/infrastructure-components.yaml\n"
"curl -L https://github.com/metal3-io/cluster-api-provider-metal3/releases/download/v1.6.0/metadata.yaml\n"
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-management-cluster.adoc:244
msgid ""
"If you want to use different versions of the components, you can change the "
"version in the URL to download the specific version of the components."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:245
msgid ""
"With the previous resources downloaded, you can compress them into a single "
"file using the following command:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:246
#, no-wrap
msgid "tar -czvf airgap-resources.tar.gz clusterctl clusterctl.yaml overrides\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:248
msgid ""
"Once the directory structure is prepared following the previous sections "
"(for both, connected and air-gap scenarios), run the following command to "
"build the image:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-management-cluster.adoc:249
#, no-wrap
msgid ""
"podman run --rm --privileged -it -v $PWD:/eib \\\n"
" registry.suse.com/edge/edge-image-builder:1.0.2 \\\n"
" build --definition-file mgmt-cluster.yaml\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:250
msgid ""
"This creates the ISO output image file that, in our case, based on the image "
"definition described above, is `eib-mgmt-cluster-image.iso`."
msgstr ""

#. type: Title ===
#: asciidoc/product/atip-management-cluster.adoc:251
#, no-wrap
msgid "Provision the management cluster"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-management-cluster.adoc:252
msgid ""
"The previous image contains all components explained above, and it can be "
"used to provision the management cluster using a virtual machine or a bare-"
"metal server (using the virtual-media feature)."
msgstr ""

#. type: Title ==
#: asciidoc/product/atip-requirements.adoc:1
#, no-wrap
msgid "Requirements & Assumptions"
msgstr ""

#. type: Title ===
#: asciidoc/product/atip-requirements.adoc:2
#, no-wrap
msgid "Hardware"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-requirements.adoc:3
msgid ""
"The hardware requirements for the ATIP nodes are based on the following "
"components:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-requirements.adoc:4
msgid ""
"**Management cluster**: The management cluster contains components like `SLE "
"Micro`, `RKE2`, `Rancher Prime`, `Metal^3^`, and it is used to manage "
"several downstream clusters. Depending on the number of downstream clusters "
"to be managed, the hardware requirements for the server could vary."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-requirements.adoc:5
msgid "Minimum requirements for the server (`VM` or `Bare Metal`) are:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-requirements.adoc:6
msgid "RAM: 8 GB Minimum (we recommend at least 16 GB)"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-requirements.adoc:7
msgid "CPU: 2 Minimum (we recommend at least 4 CPU)"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-requirements.adoc:8
msgid ""
"**Downstream clusters**: The downstream clusters are the clusters deployed "
"on the ATIP nodes to run Telco workloads. Specific requirements are needed "
"to enable certain Telco capabilities like `SR-IOV`, `CPU Performance "
"Optimization`, etc."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-requirements.adoc:9
msgid ""
"SR-IOV: to attach VFs (Virtual Functions) in pass-through mode to CNFs/VNFs, "
"the NIC must support SR-IOV and VT-d/AMD-Vi be enabled in the BIOS."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-requirements.adoc:10
msgid ""
"CPU Processors: To run specific Telco workloads, the CPU Processor model "
"should be adapted to enable most of the features available in this reference "
"<<atip-features,table>>."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-requirements.adoc:11
msgid "Firmware requirements for installing with virtual media:"
msgstr ""

#. type: Table
#: asciidoc/product/atip-requirements.adoc:12
#, no-wrap
msgid ""
"| Server Hardware | BMC Model | Management\n"
"| Dell hardware\n"
"| 15th Generation\n"
"| iDRAC9\n"
"\n"
"| Supermicro hardware\n"
"| 01.00.25\n"
"| Supermicro SMC - redfish\n"
"\n"
"| HPE hardware\n"
"| 1.50\n"
"| iLO6\n"
msgstr ""

#. type: Title ===
#: asciidoc/product/atip-requirements.adoc:13
#, no-wrap
msgid "Network"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-requirements.adoc:14
msgid ""
"As a reference for the network architecture, the following diagram shows a "
"typical network architecture for a Telco environment:"
msgstr ""

#. type: Target for macro image
#: asciidoc/product/atip-requirements.adoc:15
#, no-wrap
msgid "product-atip-requirement1.png"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-requirements.adoc:16
msgid "The network architecture is based on the following components:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-requirements.adoc:17
msgid ""
"**Management network**: This network is used for the management of the ATIP "
"nodes. It is used for the out-of-band management. Usually, this network is "
"also connected to a separate management switch, but it can be connected to "
"the same service switch using VLANs to isolate the traffic."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-requirements.adoc:18
msgid ""
"**Control-plane network**: This network is used for the communication "
"between the ATIP nodes and the services that are running on them. This "
"network is also used for the communication between the ATIP nodes and the "
"external services, like the `DHCP` or `DNS` servers. In some cases, for "
"connected environments, the switch/router can handle traffic through the "
"Internet."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-requirements.adoc:19
msgid ""
"**Other networks**: In some cases, the ATIP nodes could be connected to "
"other networks for specific customer purposes."
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-requirements.adoc:20
msgid ""
"To use the directed network provisioning workflow, the management cluster "
"must have network connectivity to the downstream cluster server Baseboard "
"Management Controller (BMC) so that host preparation and provisioning can be "
"automated."
msgstr ""

#. type: Title ===
#: asciidoc/product/atip-requirements.adoc:21
#, no-wrap
msgid "Services (DHCP, DNS, etc.)"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-requirements.adoc:22
msgid ""
"Some external services like `DHCP`, `DNS`, etc. could be required depending "
"on the kind of environment where they are deployed:"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-requirements.adoc:23
msgid ""
"**Connected environment**: In this case, the ATIP nodes will be connected to "
"the Internet (via routing L3 protocols) and the external services will be "
"provided by the customer."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-requirements.adoc:24
msgid ""
"**Disconnected / air-gap environment**: In this case, the ATIP nodes will "
"not have Internet IP connectivity and additional services will be required "
"to locally mirror content required by the ATIP directed network provisioning "
"workflow."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-requirements.adoc:25
msgid ""
"**File server**: A file server is used to store the ISO images to be "
"provisioned on the ATIP nodes during the directed network provisioning "
"workflow. The `metal^3^` Helm chart can deploy a media server to store the "
"ISO images — check the following xref:metal3-media-server[section], but it "
"is also possible to use an existing local webserver."
msgstr ""

#. type: Title ===
#: asciidoc/product/atip-requirements.adoc:26
#, no-wrap
msgid "Disabling rebootmgr"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-requirements.adoc:27
msgid ""
"`rebootmgr` is a service which allows to configure a strategy for reboot "
"when the system has pending updates.  For Telco workloads, it is really "
"important to disable or configure properly the `rebootmgr` service to avoid "
"the reboot of the nodes in case of updates scheduled by the system, to avoid "
"any impact on the services running on the nodes."
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-requirements.adoc:28
msgid ""
"For more information about `rebootmgr`, see https://github.com/SUSE/"
"rebootmgr[rebootmgr GitHub repository]."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-requirements.adoc:29
msgid "Verify the strategy being used by running:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-requirements.adoc:30
#, no-wrap
msgid ""
"cat /etc/rebootmgr.conf\n"
"[rebootmgr]\n"
"window-start=03:30\n"
"window-duration=1h30m\n"
"strategy=best-effort\n"
"lock-group=default\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-requirements.adoc:31
msgid "and you could disable it by running:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-requirements.adoc:32
#, no-wrap
msgid "sed -i 's/strategy=best-effort/strategy=off/g' /etc/rebootmgr.conf\n"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip-requirements.adoc:33
msgid "or using the `rebootmgrctl` command:"
msgstr ""

#. type: delimited block -
#: asciidoc/product/atip-requirements.adoc:34
#, no-wrap
msgid "rebootmgrctl strategy off\n"
msgstr ""

#. type: delimited block =
#: asciidoc/product/atip-requirements.adoc:35
msgid ""
"This configuration to set the `rebootmgr` strategy can be automated using "
"the directed network provisioning workflow. For more information, check the "
"<<atip-automated-provisioning,ATIP Automated Provisioning documentation>>."
msgstr ""

#. type: Title =
#: asciidoc/product/atip.adoc:1
#, no-wrap
msgid "SUSE Adaptive Telco Infrastructure Platform (ATIP)"
msgstr ""

#. type: Plain text
#: asciidoc/product/atip.adoc:2
msgid ""
"SUSE Adaptive Telco Infrastructure Platform (`ATIP`) is a Telco-optimized "
"edge computing platform that enables telecom companies to innovate and "
"accelerate the modernization of their networks."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip.adoc:3
msgid ""
"ATIP is a complete Telco cloud stack for hosting CNFs such as 5G Packet Core "
"and Cloud RAN."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip.adoc:4
msgid ""
"Automates zero-touch rollout and lifecycle management of complex edge stack "
"configurations at Telco scale."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip.adoc:5
msgid ""
"Continuously assures quality on Telco-grade hardware, using Telco-specific "
"configurations and workloads."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip.adoc:6
msgid ""
"Consists of components that are purpose-built for the edge and hence have "
"smaller footprint and higher performance per Watt."
msgstr ""

#. type: Plain text
#: asciidoc/product/atip.adoc:7
msgid ""
"Maintains a flexible platform strategy with vendor-neutral APIs and 100% "
"open source."
msgstr ""
